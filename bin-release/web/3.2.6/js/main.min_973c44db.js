var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(a,r){function s(t){try{h(n.next(t))}catch(e){r(e)}}function o(t){try{h(n["throw"](t))}catch(e){r(e)}}function h(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(s,o)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],r=0}finally{a=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,r,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},Scene=function(t){function e(){var e=t.call(this)||this;return e.isRemove=!0,e.nav=!1,e.isnSpecialReturn=!1,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.initScene,e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,e.release,e),e}return __extends(e,t),e.prototype.initScene=function(){if(this.isRemove){var t=Util.createBitmapByName("bg_circle_png");this.addChildAt(t,-1),t.width=290,t.height=290,t.x=this.stage.stageWidth-200,t.y=400,t.anchorOffsetX=145,t.anchorOffsetY=145,egret.Tween.get(t,{loop:!0}).to({rotation:360},3e3),this.init(),this.isRemove=!1,0!=this.nav&&this.crteateNavButton(this.nav)}},e.prototype.crteateNavButton=function(t){var e=this;void 0===t&&(t="首页");var i=Util.createBitmapByName("nav_bg_png");i.width=180,i.height=56,i.x=this.stage.stageWidth-180,i.y=15,this.addChild(i);var n=new egret.TextField;n.text=t,n.size=28,this.navColor?n.textColor=this.navColor:n.textColor=16018466,n.width=180,n.height=i.height,n.textAlign=egret.HorizontalAlign.CENTER,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.x=i.x,n.y=i.y,i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){hideIFrame(),e.onBack()},this),this.addChild(n)},e.prototype.setBackground=function(t){void 0===t&&(t="bg_png");var e=Util.createBitmapByName(t);this.addChildAt(e,-2),e.width=this.stage.stageWidth,e.height=this.stage.stageHeight},e.prototype.updateScene=function(){},e.prototype.init=function(){},e.prototype.onBack=function(){if("首页"==this.nav){var t=new IndexScene;ViewManager.getInstance().changeScene(t)}else if(this.isnSpecialReturn){var e=new EquipmentScene;ViewManager.getInstance().changeScene(e)}else Util.log("TitleEvent.BACK"),ViewManager.getInstance().back()},e.prototype.release=function(){},e.prototype.remove=function(){this.removeChildren(),this.parent.removeChild(this),this.isRemove=!0},e}(eui.UILayer);__reflect(Scene.prototype,"Scene");var RoomNumber;!function(t){t[t.SIX=6]="SIX",t[t.TEN=10]="TEN"}(RoomNumber||(RoomNumber={}));var JoinType;!function(t){t[t.JOIN=1]="JOIN",t[t.OBSEVER=2]="OBSEVER"}(JoinType||(JoinType={}));var RoomStatus;!function(t){t[t.WAITTING=0]="WAITTING",t[t.PK=1]="PK"}(RoomStatus||(RoomStatus={}));var ReadyType;!function(t){t[t.UNREADY=1]="UNREADY",t[t.READYED=2]="READYED",t[t.UNJOIN=3]="UNJOIN"}(ReadyType||(ReadyType={}));var TeamType;!function(t){t[t.BLUE=2]="BLUE",t[t.GREEN=1]="GREEN"}(TeamType||(TeamType={}));var UserPositionType;!function(t){t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT"}(UserPositionType||(UserPositionType={}));var InviteStatus;!function(t){t[t.WATTING=2]="WATTING",t[t.INVITING=1]="INVITING",t[t.NOACCEPT=3]="NOACCEPT",t[t.ACCEPTED=4]="ACCEPTED",t[t.MATCHEND=5]="MATCHEND",t[t.OBSERVE=6]="OBSERVE",t[t.INVALID=7]="INVALID",t[t.INVALID_ERROR=8]="INVALID_ERROR",t[t.PK_END_WAIT=9]="PK_END_WAIT",t[t.PK_NO_ANSWER=10]="PK_NO_ANSWER",t[t.PK_REJECT=11]="PK_REJECT",t[t.PK_ERR_MSG=12]="PK_ERR_MSG"}(InviteStatus||(InviteStatus={}));var PkResult;!function(t){t[t.SUCCESS=1]="SUCCESS",t[t.FAIL=2]="FAIL",t[t.DRAW=3]="DRAW",t[t.INVALID=4]="INVALID"}(PkResult||(PkResult={}));var PkResultBackModel;!function(t){t[t.BACK=1]="BACK",t[t.BACK_PK=2]="BACK_PK",t[t.BACK_HOME=3]="BACK_HOME"}(PkResultBackModel||(PkResultBackModel={}));var PkModel;!function(t){t[t.AUTO=1]="AUTO",t[t.FRIEND=2]="FRIEND",t[t.ANSWER=3]="ANSWER",t[t.KNOW=4]="KNOW"}(PkModel||(PkModel={}));var PKTYPE;!function(t){t[t.PERSON=1]="PERSON",t[t.TEAM=2]="TEAM"}(PKTYPE||(PKTYPE={}));var MatchStatus;!function(t){t[t.MATCHING=1]="MATCHING",t[t.MATCHING_END=2]="MATCHING_END"}(MatchStatus||(MatchStatus={}));var WinnerStatus;!function(t){t[t.WIN=1]="WIN",t[t.DRAW=2]="DRAW",t[t.MVP=3]="MVP",t[t.LOSE=4]="LOSE",t[t.PKING=5]="PKING"}(WinnerStatus||(WinnerStatus={}));var CTitle=function(t){function e(e){var i=t.call(this)||this;return i.t=e,i}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(CTitle.prototype,"CTitle",["eui.UIComponent","egret.DisplayObject"]);var DataManager=function(t){function e(){var e=t.call(this)||this;return e.equipment=null,e.hasShowRanker=!1,e.pkData={},e}return __extends(e,t),e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.setCurrentBandge=function(t){this.bandge=t},e.prototype.getCurrentBandge=function(){return this.bandge},e.prototype.setUser=function(t){this.user=t},e.prototype.getUser=function(){return this.user},e.prototype.updateUser=function(t,e){this.user[t]=e},e.prototype.updateUserInfo=function(t){"undefined"!=typeof this.user&&(t.attrName=this.user.attrName,t.attrInfo=this.user.attrInfo),this.user=t},e.prototype.getEquipCategory=function(){},e.prototype.setSign=function(t){this.sign=t},e.prototype.getSign=function(){return this.sign},e.prototype.setPk=function(t){t.pkCode&&(this.pkData.pkCode=t.pkCode),t.pkType&&(this.pkData.pkType=t.pkType),t.pkUser&&(this.pkData.pkUser=t.pkUser)},e.prototype.setPkstart=function(t){this.pkData.status=1,this.pkData.type=t.type,this.pkData.questions=t.pkQuestions},e.prototype.setPkResult=function(t){var i=t.winUserId,n=PkResult.SUCCESS;0==i?n=PkResult.DRAW:i!=this.user.userId&&(n=PkResult.FAIL);var a=null;this.pkData&&this.pkData.pkUser&&(a=this.pkData.pkUser);var r={};r.status=n,r.sender=t[this.user.userId],a?r.receiver=t[a.userId]:r.receiver=null,console.log("setPkResult",r),this.pkData.result=r,Http.getInstance().post(Url.HTTP_USER_BASE_INFO,"",function(t){e.getInstance().updateUserInfo(t.data)})},e.prototype.setPkResult1=function(t){var e=t.winUserId,i=PkResult.SUCCESS;0==e?i=PkResult.DRAW:e!=this.user.userId&&(i=PkResult.FAIL);var n={};n.status=i;for(var a=0,r=t.pkUsers;a<r.length;a++){var s=r[a];s.userId==this.user.userId?n.sender={pkUser:s,pkResult:t.pkResults[s.userId]}:n.receiver={pkUser:s,pkResult:t.pkResults[s.userId]}}this.pkData.result=n},e.prototype.convertPkResult=function(t){var e=t.winUserId,i=PkResult.FAIL;0==e?i=PkResult.DRAW:e==this.user.userId&&(i=PkResult.SUCCESS),t.tipsCode>0&&(i=PkResult.INVALID);var n=(this.pkData.pkUser,{});return n.tipsMsg=t.tipsMsg,n.status=i,n.sender=t[t.sendUserId],n.receiver=t[t.acceptUserId],n},e.prototype.convertPkResult1=function(t){var e=t.winUserId,i=PkResult.FAIL;0==e?i=PkResult.DRAW:e==this.user.userId&&(i=PkResult.SUCCESS);var n=(this.pkData.pkUser,{});n.status=i;for(var a=0,r=t.pkUsers;a<r.length;a++){var s=r[a];s.userId==t.sendUserId?n.sender={pkUser:s,pkResult:t.pkResults[s.userId]}:n.receiver={pkUser:s,pkResult:t.pkResults[s.userId]}}return n},e.prototype.getPkResult=function(){return this.pkData.result},e.prototype.getPkData=function(){return this.pkData},e.prototype.removePkData=function(){this.pkData={}},e.prototype.setPkModel=function(t){this.pkModel=t},e.prototype.getPkModel=function(){return this.pkModel},e.prototype.test=function(){this.roomList={6:[{room:12341,roomId:"11212",status:1,roomNumber:6,"in":5,see:2},{room:12342,roomId:"11212",status:2,roomNumber:6,"in":5,see:2},{room:12343,roomId:"11212",status:1,roomNumber:6,"in":5,see:2},{room:12344,status:2,roomId:"11212",roomNumber:6,"in":5,see:2}],10:[{room:12345,roomId:"11212",status:1,roomNumber:10,"in":5,see:2},{room:12346,roomId:"11212",status:2,roomNumber:10,"in":5,see:2},{room:12347,roomId:"11212",status:1,roomNumber:10,"in":5,see:2},{room:12348,roomId:"11212",status:2,roomNumber:10,"in":5,see:2}]}},e.prototype.clearRoomData=function(){this.roomData=null},e.prototype.setRoomData=function(t,e,i,n,a){this.roomData=new Room,this.roomData.tableNo=t,this.roomData.roomType=e,this.roomData.roomNumber=i,this.roomData.joinType=n;for(var r={},s=1;i+1>s;s++){var o={};o.status=ReadyType.UNJOIN,o.userInfo=null,o.position=s,r[s]=o}for(var h in a){var l=a[h],o={},d=Number(h)+1;l&&d>0&&(o.team=l.team,o.position=l.index,o.userInfo=l.userInfo,o.status=l.ok?ReadyType.READYED:ReadyType.UNREADY,this.updateRoomSelfData(o),r[d]=o)}console.log("users",r),this.roomData.users=r},e.prototype.updateRoomSelfData=function(t){if(t.userInfo&&t.userInfo.userId==this.user.userId){var e=this.roomData.roomNumber/2,i=t.position>e?TeamType.BLUE:TeamType.GREEN,n={position:t.position,status:t.status,userId:this.user.userId,team:i};this.roomData.self=n}},e.prototype.getRoomData=function(){return this.roomData},e.prototype.getPkUsers=function(){return this.pkUsers},e.prototype.updateTeamUser=function(t){var e={},i=t.index;console.log("user",t),e.position=i,t.userInfo?(e.userInfo=t.userInfo,e.status=t.ok?ReadyType.READYED:ReadyType.UNREADY,this.updateRoomSelfData(e)):(e.userInfo=null,e.status=ReadyType.UNJOIN),this.roomData&&this.roomData.users&&(this.roomData.users[i]=e),console.log("updateTeamUser",e)},e.prototype.updateUserLeave=function(t){var e={},i=t.index;console.log("user",t),e.position=i,e.userInfo=null,e.status=ReadyType.UNJOIN,this.roomData&&this.roomData.users&&(this.roomData.users[i]=e),console.log("updateTeamUser",e)},e.prototype.updateTeamUserStatus=function(t,e){this.roomData&&this.roomData.users[t]&&(this.roomData.users[t].status=e?ReadyType.READYED:ReadyType.UNREADY)},e.prototype.setRoomSelfData=function(t){var e=t.index,i=this.roomData.roomNumber/2,n=e>i?TeamType.BLUE:TeamType.GREEN,a={position:e,status:ReadyType.READYED,userId:t.userId,team:n};this.roomData.self=a},e.prototype.getRoomSelfData=function(){return this.roomData.self},e.prototype.getRoomUser=function(t){return this.roomData?this.roomData.users[t]:null},e.prototype.updateRoomData=function(t){},e.prototype.updateTeamPkData=function(t){var e=this;if(this.roomData){var i={};if(i.questions=t.questions,this.roomData.roomType==PkModel.KNOW){var n=t.groups,a=function(t){var a=n[t],r=!1,s={};a.map(function(t){t&&(e.roomData.joinType==JoinType.JOIN&&e.roomData.self&&t.userId==e.roomData.self.userId&&(r=!0),s[t.team]=t.userInfo)}),r&&(i.groupId=t,i.users=s)};for(var r in n)a(r)}this.roomData.pkData=i,console.log("updateTeamPkData",this.roomData.pkData)}},e.prototype.updateTeamPersonPkResult=function(t){if(this.roomData){var e={};t.group.map(function(t){e[t.team]=t.totalScore});var i={winner:t.winTeam,score:e};this.roomData.pkData.result=i}},e.prototype.updateTeamPkResult=function(t){if(this.roomData){var e=0;t.teamScore[UserPositionType.LEFT]>t.teamScore[UserPositionType.RIGHT]?e=UserPositionType.LEFT:t.teamScore[UserPositionType.LEFT]<t.teamScore[UserPositionType.RIGHT]&&(e=UserPositionType.RIGHT),this.roomData.pkResult={winner:e,mvps:t.mvps,score:t.teamScore}}},e.prototype.updateTeamKonwResult=function(t){if(this.roomData){var e={score:t.teamScore,end:t.isOver};if(t.isOver){var i=0;t.teamScore[UserPositionType.LEFT]>t.teamScore[UserPositionType.RIGHT]?i=UserPositionType.LEFT:t.teamScore[UserPositionType.LEFT]<t.teamScore[UserPositionType.RIGHT]&&(i=UserPositionType.RIGHT),e.winner=i}var n={};t.groupProgress&&t.groupProgress.map(function(e){var i=t.groups[e];i.map(function(t){if(t){var e=0;switch(t.isWin){case 1:e=WinnerStatus.WIN;break;case 0:e=WinnerStatus.DRAW;break;case-1:e=WinnerStatus.LOSE}t.isMvp&&(e=WinnerStatus.MVP),n[t.userIndex]=e}})}),e.result=n,this.roomData.pkResult=e}},e.prototype.getTeamPkData=function(){return this.roomData?this.roomData.pkData:null},e}(egret.EventDispatcher);__reflect(DataManager.prototype,"DataManager");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){var t=ViewManager.getInstance().stage;this.width=t.stageWidth,this.height=t.stageHeight;var e=new egret.Shape;e.graphics.beginFill(0,1),e.graphics.drawRect(0,0,t.stageWidth,t.stageHeight),e.graphics.endFill(),e.$alpha=.1,this.addChild(e),this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=t.stageHeight-380,this.textField.width=t.stageWidth,this.textField.x=0,this.textField.height=100,this.textField.textAlign="center",this.textField.size=60,this.textField.textColor=8423572;var i=new eui.Group;i.width=t.stageWidth,i.y=300,this.addChild(i);var n="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",a="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nuniform sampler2D uSampler;\nuniform float customUniform;\nvoid main(void) {\nvec2 uvs = vTextureCoord.xy;\nvec4 fg = texture2D(uSampler, vTextureCoord);\nfg.rgb += sin(customUniform + uvs.x * 2. + uvs.y * 2.) * 0.2;\ngl_FragColor = fg * vColor;\n}",r=new egret.CustomFilter(n,a,{customUniform:0});this.filters=[r],this.addEventListener(egret.Event.ENTER_FRAME,function(){r.uniforms.customUniform+=.1,r.uniforms.customUniform>2*Math.PI&&(r.uniforms.customUniform=0)},this)},e.prototype.onProgress=function(t,e){this.textField.text=Math.ceil(t/e*100)+"%"},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),console.log("Config.APP_VERSION",Config.APP_VERSION),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,platform.login()];case 1:return i.sent(),[4,this.loadResource()];case 2:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 3:return t=i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),ViewManager.getInstance().stage=this.stage,[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),t=Util.getURLVar("code")||"1132",[4,RES.loadGroup(t)];case 2:return n.sent(),e=new LoadingUI,this.stage.addChild(e),this.loadTheme(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),removeLoading(),RES.loadGroup("music").then(function(){Util.playMusic("bg_mp3",!0)}),RES.loadGroup(t+"_tiku"),console.log("egret.Capabilities.os",egret.Capabilities.os),[3,5];case 4:return i=n.sent(),console.error(i),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var n=new eui.Theme("resource/default.thm.json",t.stage);n.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=localStorage.getItem("personalpk");if(t&&(t=JSON.parse(t),localStorage.removeItem("personalpk")),t)SocketX.getInstance().connectPersonPk(),SocketX.getInstance().addEventListener(NetEvent.ON_CONNENT,function(){DataManager.getInstance().setPk(t),DataManager.getInstance().setPkModel(PkModel.FRIEND),SocketX.getInstance().addEventListener(NetEvent.PK_OAUTH,function(e){DataManager.getInstance().setUser(e.data),setTimeout(function(){if(ViewManager.getInstance().hideLoading(),t.isOverTime){var e=new PkInviteScene(InviteStatus.PK_NO_ANSWER);ViewManager.getInstance().changeScene(e)}else{var e=new PkInviteScene(InviteStatus.ACCEPTED);ViewManager.getInstance().changeScene(e)}},2e3)}),SocketX.getInstance().addEventListener(NetEvent.GET_USERINFO,function(t){DataManager.getInstance().setPk(t.data)}),SocketX.getInstance().sendMsg(NetEvent.GET_USERINFO,{userId:t.pkUserId})},this);else{var e=new IndexScene;ViewManager.getInstance().changeScene(e)}},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,n){function a(t){e.call(n,t)}function r(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),i.call(n))}var s=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(n,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(n,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,r,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var TrainTitle=function(t){function e(e,i){var n=t.call(this)||this;return n.t1=e,n.t2=i,n}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(TrainTitle.prototype,"TrainTitle",["eui.UIComponent","egret.DisplayObject"]);var ViewManager=function(){function t(){this.views=[],this.isLoading=!1}return t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.getCurrentScene=function(){var t=this.views.length;return 0===t?null:this.views[t-1]},t.prototype.changeScene=function(t){var e=this;if(!t)return void console.error("场景不能为空！");if(this.isLoading)return void console.log(t);var i=this.getCurrentScene();if(i){this.isLoading=!0;var n=egret.Tween.get(i);n.to({alpha:1},10),n.wait(10),n.to({alpha:0},100),n.call(function(){i.parent.removeChild(i),e.stage.addChild(t),e.views.push(t),e.isLoading=!1},this)}else this.stage.addChild(t),this.views.push(t),this.isLoading=!1},t.prototype.jumpHome=function(){var t=this.getCurrentScene();console.log(t),t.parent.removeChild(t);var e=this.views[0];if("home"==e.name){e.updateScene(),this.views=[e],this.stage.addChild(e);var i=egret.Tween.get(e);i.to({alpha:1},100)}else this.views=[],e=new IndexScene,this.stage.addChild(e),this.views.push(e)},t.prototype.back=function(t){var e=this;void 0===t&&(t=1);var i=this.views.length;if(Util.log("切换上级页面！"),i>t){var n=this.views[i-1],a=this.views[i-t-1],r=egret.Tween.get(n);r.to({alpha:0},100),r.wait(50),r.call(function(){n.parent.removeChild(n),e.stage.addChild(a),a.updateScene();var i=egret.Tween.get(a);i.to({alpha:1},100);for(var r=0;t>r;r++)e.views.pop()},this)}},t.prototype.backByName=function(t){var e=-1;for(var i in this.views){var n=this.views[i];if(n.name==t){e=i;break}}var a=this.views.length,r=this.views[a-1];if(r.parent.removeChild(r),e>-1){var s=this.views[e],o=egret.Tween.get(s);o.to({alpha:1},100),this.stage.addChild(s),s.updateScene(),this.views=this.views.slice(0,e),this.views.push(s)}else{this.views=[];var s=void 0;switch(t){case"pkmodel":var h=1,l=DataManager.getInstance().getPkModel();(l==PkModel.KNOW||l==PkModel.ANSWER)&&(h=2),s=new PkModelScene(h);break;default:s=new PkListScene}this.stage.addChild(s),this.views.push(s)}},t.prototype.showLoading=function(t){if(this.loadingView)this.loadingView.setText(t);else{var e=new AlertLoading(t);this.loadingView=e,this.stage.addChild(e)}},t.prototype.hideLoading=function(){this.loadingView&&(this.stage.removeChild(this.loadingView),this.loadingView=null)},t}();__reflect(ViewManager.prototype,"ViewManager");var Confirm=function(t){function e(e,i,n){void 0===i&&(i="确认"),void 0===n&&(n="取消");var a=t.call(this)||this;return a.text=e,a.leftButtonText=i,a.rightButtonText=n,a.init(),a}return __extends(e,t),e.prototype.init=function(){var t=this,e=ViewManager.getInstance().stage,i=Util.createBitmapByName("mask_png");i.y=0,i.x=0,i.alpha=.5,i.width=e.stageWidth,i.height=e.stageHeight,this.addChild(i);var n=new egret.TextField;this.addChild(n),n.width=700,n.x=e.stageWidth/2-350,n.textAlign=egret.HorizontalAlign.CENTER,n.size=32,n.bold=!0,n.text=this.text,n.lineSpacing=20,n.y=e.stageHeight/2-100;var a=e.stageHeight/2+n.textHeight,r=new XButton(this.leftButtonText);r.width=330,r.x=e.stageWidth/2-345,r.y=a,this.addChild(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new ConfirmEvent(ConfirmEvent.CONFIRM_BUTTON_YES);t.dispatchEvent(e),t.parent.removeChild(t)},this);var s=new XButton(this.rightButtonText);s.width=330,s.x=e.stageWidth/2+15,s.y=a,this.addChild(s),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new ConfirmEvent(ConfirmEvent.CONFIRM_BUTTON_NO);t.dispatchEvent(e),t.parent.removeChild(t)},this)},e}(eui.Group);__reflect(Confirm.prototype,"Confirm");var ConfirmEvent=function(t){function e(e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),t.call(this,e,i,n)||this}return __extends(e,t),e.CONFIRM_BUTTON_YES="CONFIRM_BUTTON_YES",e.CONFIRM_BUTTON_NO="CONFIRM_BUTTON_NO",e}(egret.Event);__reflect(ConfirmEvent.prototype,"ConfirmEvent");var EquipItem=function(t){function e(e){var i=t.call(this)||this;return i.data=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=ViewManager.getInstance().stage,e=(t.width-690)/2,i=Util.createBitmapByName("equip_bg_png");i.x=e,this.addChild(i);var n=new egret.TextField;this.data.title.length>=16?n.text=this.data.title.substr(0,14)+"...":n.text=this.data.title,n.size=32,n.width=500,n.textColor=6778489,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.x=e+40,n.lineSpacing=40,this.addChild(n);var a=Util.createBitmapByName("user_line_png");a.width=510,a.x=n.x,a.y=50,this.addChild(a),i.height=n.textHeight+10,n.height=i.height,this.height=i.height},e}(eui.Group);__reflect(EquipItem.prototype,"EquipItem");var LevelView=function(t){function e(e){var i=t.call(this)||this;return i.WIDTH=168,i.IMGS=[["bg_level_pass_png","point_pass_png"],["bg_level_cur_png","point_cur_png"],["bg_level_nopass_png","point_nopass_png"]],i.levelData=e,i.init(),i}return __extends(e,t),e.prototype.setStatus=function(t){var e=this.IMGS[t];this.bg.texture=RES.getRes(e[0]),this.point.texture=RES.getRes(e[1])},e.prototype.init=function(){this.width=this.WIDTH;var t=this.IMGS[this.levelData.status],e=Util.createBitmapByName(t[0]);e.width=168,e.height=221,e.alpha=.8,this.bg=e,this.addChild(e);var i=50,n=new egret.TextField;n.width=this.WIDTH,n.text=this.levelData.name,n.y=i,n.textColor=4280932,n.textAlign=egret.HorizontalAlign.CENTER,n.size=24,this.addChild(n),i+=45;var a=new egret.Shape;a.graphics.lineStyle(3,14540253),a.graphics.moveTo(25,i-10),a.graphics.lineTo(this.WIDTH-25,i-10),a.graphics.endFill(),a.alpha=.8,this.addChild(a),i+=10;var r=new egret.TextField;r.width=this.WIDTH,r.text=this.levelData.flag,r.y=i-6,r.textColor=4280932,r.textAlign=egret.HorizontalAlign.CENTER,this.addChild(r);var s=Util.createBitmapByName(t[1]);if(s.width=100,s.x=this.WIDTH/2-50,s.y=165,this.addChild(s),this.levelData.status<=LevelStatus.Cur){var o=Util.getWaterShader();s.filters=[o],this.addEventListener(egret.Event.ENTER_FRAME,function(){o.uniforms.time+=.02,o.uniforms.time>1&&(o.uniforms.time=0)},this)}},e}(eui.Group);__reflect(LevelView.prototype,"LevelView");var LevelStatus;!function(t){t[t.Pass=0]="Pass",t[t.Cur=1]="Cur",t[t.No=2]="No"}(LevelStatus||(LevelStatus={}));var LineInfo=function(t){function e(e){var i=t.call(this)||this;return i.text=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){ViewManager.getInstance().stage;this.width=650,this.anchorOffsetX=325,this.x=375;var t=Util.createBitmapByName("result_line_top_png");t.width=450,this.addChild(t);var e=new egret.TextField;this.textField=e,e.text=this.text,e.width=420,e.size=26;var i=50*e.numLines;this.height=i,e.textAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.x=115,e.lineSpacing=10,e.y=20,this.addChild(e);var n=Util.createBitmapByName("result_line_bottom_png");n.x=190,n.y=i-20,this.bottomLine=n,this.addChild(n)},e.prototype.setText=function(t){this.textField&&(this.textField.text=t)},e.prototype.setTextFlow=function(t){this.textField&&(this.textField.textFlow=t),this.height=this.textField.textHeight+30,this.bottomLine.y=this.height-25,console.log("this.height:",this.height)},e}(eui.Group);__reflect(LineInfo.prototype,"LineInfo");var Notice=function(t){function e(e){var i=t.call(this)||this;return i.seleted=0,i.notices=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=ViewManager.getInstance().stage;this.mask=new egret.Rectangle(0,0,t.stageWidth,80);var e=Util.createBitmapByName("icon_notice_png");e.x=30,e.y=29,this.addChild(e);var i=Util.createBitmapByName("bottom_info_png");i.x=t.width-56,i.y=29,this.addChild(i);var n=new egret.TextField;n.height=90,n.size=30,n.textColor=Config.COLOR_GREY,n.width=t.stageWidth-200,n.x=100,n.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(n),this.text1=n,this.notices.length>0&&(n.text=this.notices[0].showMsg),this.notices.length>1&&this.startAni()},e.prototype.startAni=function(){var t=this;this.tw=egret.Tween.get(this.text1,{loop:!0}),this.tw.to({y:80},200,egret.Ease.backOut).call(function(){t.text1.text=t.notices[t.seleted].showMsg}).to({y:0},100,egret.Ease.backIn).call(function(){e()}).wait(3e3);var e=function(){t.seleted++,t.seleted>=t.notices.length&&(t.seleted=0)}},e}(eui.Group);__reflect(Notice.prototype,"Notice");var PkItem=function(t){function e(e){var i=t.call(this)||this;return i.data=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=ViewManager.getInstance().stage;this.width=690,this.height=230,this.anchorOffsetX=this.width/2,this.x=t.stageWidth/2;var e=Util.createBitmapByName("equip_bg_png");e.width=this.width,e.height=this.height,this.addChild(e);var i=Util.createBitmapByName(this.data.icon);i.width=this.data.iconWidth,i.anchorOffsetX=i.width/2,i.anchorOffsetY=70,i.x=180,i.y=this.height/2,this.addChild(i);var n=new egret.TextField;n.text=this.data.title,n.width=this.width/2-50,n.height=this.height,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.x=this.width/2,n.size=40,this.addChild(n)},e}(eui.Group);__reflect(PkItem.prototype,"PkItem");var PkUser=function(t){function e(e,i,n){void 0===i&&(i="left"),void 0===n&&(n=null);var a=t.call(this)||this;return a.userinfo=e,a.type=i,a.score=n,a.init(),a}return __extends(e,t),e.prototype.init=function(){var t="pk_user_bg_left_png",e=11255569;"right"==this.type&&(t="pk_user_bg_right_png",e=1470657),this.color=e;var i=Util.createBitmapByName(t),n=240,a=283;this.score&&(a=340),this.height=a,this.width=n,i.width=n,i.height=a,this.addChild(i);var r=Util.createBitmapByName("icon_border_png");r.width=164,r.height=164,r.x=38,r.y=30,this.addChild(r);var s=this.userinfo?"icon_2_jpg":"user_unknow_jpg",o=Util.createBitmapByName(s);o.width=150,o.height=140,o.x=r.x+7,o.y=r.y+12,this.addChild(o),this.userinfo&&Util.setUserImg(this.userinfo.avatar,o);var h=new egret.Shape;this.addChild(h);var l=h.graphics;l.beginFill(16711680),l.moveTo(o.x,o.y+15),l.lineTo(o.x,o.y+o.height),l.lineTo(o.x+o.width,o.y+o.height),l.lineTo(o.x+o.width,o.y),l.lineTo(o.x+15,o.y),l.lineTo(o.x,o.y+15),l.endFill(),o.mask=h;var d=new egret.TextField;if(d.text=this.userinfo?this.userinfo.nickName:"???",d.width=200,d.wordWrap=!1,d.multiline=!1,d.x=20,d.textAlign=egret.HorizontalAlign.CENTER,d.y=o.y+180,d.size=28,this.addChild(d),this.score){var c=Util.createBitmapByName("user_line_png");c.width=i.width,c.y=d.y+60,this.addChild(c);var g=new egret.Shape;g.graphics.beginFill(e),g.graphics.moveTo(0,c.y-10),g.graphics.lineTo(0,c.y+10),g.graphics.lineTo(80,c.y+10),g.graphics.lineTo(80,c.y-10),g.graphics.lineTo(0,c.y-10),g.graphics.moveTo(160,c.y-10),g.graphics.lineTo(160,c.y+10),g.graphics.lineTo(240,c.y+10),g.graphics.lineTo(240,c.y-10),g.graphics.lineTo(160,c.y-10),g.graphics.endFill(),this.addChild(g),c.mask=g;var u=new egret.TextField;u.text=this.score,u.textColor=0,u.width=i.width,u.height=50,u.anchorOffsetY=25,u.y=c.y,u.textAlign=egret.HorizontalAlign.CENTER,u.verticalAlign=egret.VerticalAlign.MIDDLE,u.size=30,this.addChild(u),this.scoreText=u}},e.prototype.addPkTime=function(t){var e=new egret.TextField;e.text=t,e.textColor=this.color,e.width=this.width,e.size=40,e.bold=!0,e.textAlign=egret.HorizontalAlign.CENTER,e.y=this.height+10,this.addChild(e)},e.prototype.setScore=function(t){this.scoreText.text=t},e}(eui.Group);__reflect(PkUser.prototype,"PkUser");var TeamUser=function(t){function e(e,i,n){void 0===i&&(i=UserPositionType.LEFT),void 0===n&&(n={width:250,height:185});var a=t.call(this)||this;return a.canClick=!0,a.userinfo=e||{},a.type=i,a.rect=n,a.init(),a}return __extends(e,t),e.prototype.init=function(){var t="pk_user_bg_left_png",e=11255569;this.type===UserPositionType.RIGHT&&(t="pk_user_bg_right_png",e=1470657),this.color=e;var i=Util.createBitmapByName(t),n=this.rect.width,a=this.rect.height;this.height=a,this.width=n,i.width=n,i.height=a,this.addChild(i);var r=Util.createBitmapByName("icon_border_png");r.width=115,r.height=115,r.x=(this.width-r.width)/2,r.y=10,this.addChild(r);var s="icon_1_jpg";this.userinfo.nickName&&(s="icon_2_jpg");var o=Util.createBitmapByName(s);o.width=100,o.height=100,o.x=r.x+7,o.y=r.y+7,this.addChild(o),Util.setUserImg(this.userinfo.avatar,o),this.icon=o,o.touchEnabled=!0;var h=new egret.Shape;this.addChild(h);var l=h.graphics;l.beginFill(16711680),l.moveTo(o.x,o.y+10),l.lineTo(o.x,o.y+o.height),l.lineTo(o.x+o.width,o.y+o.height),l.lineTo(o.x+o.width,o.y),l.lineTo(o.x+10,o.y),l.lineTo(o.x,o.y+10),l.endFill(),o.mask=h;var d=new egret.TextField;d.text=this.userinfo.nickName,d.width=200,d.wordWrap=!1,d.multiline=!1,d.x=(this.width-d.width)/2,d.textAlign=egret.HorizontalAlign.CENTER,d.y=o.y+r.height,d.size=26,this.addChild(d),this.nameText=d;var c=Util.createBitmapByName("ready_png");c.width=35,c.height=35,this.type==UserPositionType.LEFT?c.x=210:c.x=20,c.y=77,this.readyImg=c,this.addChild(c),this.readyImg.visible=!1},e.prototype.addUserEventListener=function(t,e){var i=this;
this.icon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.canClick){var n=(new Date).getTime();i.clickTime&&n-i.clickTime<1e3||(i.clickTime=n,t.bind(e)(i.userinfo))}},this)},e.prototype.resetClick=function(){this.canClick=!0,this.clickTime=0},e.prototype.setDisableClick=function(){this.canClick=!1},e.prototype.updateUser=function(t){this.userinfo=t;var e=RES.getRes("icon_1_jpg");this.icon.texture=e,null==t?(this.nameText.text="",this.readyImg.visible=!1,this.resetClick()):(this.nameText.text=t.nickName,Util.setUserImg(t.avatar,this.icon))},e.prototype.setReady=function(){this.readyImg.visible=!0},e.prototype.setWinnerStatus=function(t){if(this.status!=t){this.status=t,this.resultImg&&(this.resultImg.parent.removeChild(this.resultImg),this.resultImg=null);var e={1:"result_win_png",2:"result_draw_png",3:"result_mvp_png"},i=e[t];if(i){var n=Util.createBitmapByName(i);n.width=100,n.height=100,n.anchorOffsetX=100,n.x=this.width,this.addChild(n),this.resultImg=n}if(t===WinnerStatus.LOSE){var a=Util.grayFliter();this.filters=[a]}}},e}(eui.Group);__reflect(TeamUser.prototype,"TeamUser");var LiteTeamUser=function(t){function e(e,i){void 0===i&&(i=UserPositionType.LEFT);var n=t.call(this)||this;return n.userinfo=e,n.type=i,n.init(),n}return __extends(e,t),e.prototype.init=function(){var t="pk_user_bg_left_png",e=11255569;this.type===UserPositionType.RIGHT&&(t="pk_user_bg_right_png",e=1470657),this.color=e;var i=Util.createBitmapByName(t),n=105,a=133;this.height=a,this.width=n,i.width=n,i.height=a,this.addChild(i);var r=Util.createBitmapByName("icon_border_png");r.width=85,r.height=85,r.x=10,r.y=10,this.addChild(r);var s=Util.createBitmapByName("icon_2_jpg");s.width=75,s.height=75,s.x=r.x+5,s.y=r.y+5,this.addChild(s),this.userinfo&&this.userinfo.avatar&&Util.setUserImg(this.userinfo.avatar,s);var o=new egret.Shape;this.addChild(o);var h=o.graphics;h.beginFill(16711680),h.moveTo(s.x,s.y+5),h.lineTo(s.x,s.y+s.height),h.lineTo(s.x+s.width,s.y+s.height),h.lineTo(s.x+s.width,s.y),h.lineTo(s.x+5,s.y),h.lineTo(s.x,s.y+5),h.endFill(),s.mask=o;var l=new egret.TextField;l.width=105,l.wordWrap=!1,l.multiline=!1,l.textAlign=egret.HorizontalAlign.CENTER,l.y=s.y+80,l.size=22,this.userinfo&&this.userinfo.nickName&&(l.text=this.userinfo.nickName),this.addChild(l)},e}(eui.Group);__reflect(LiteTeamUser.prototype,"LiteTeamUser");var Radar=function(t){function e(e,i,n){var a=t.call(this)||this;return a.data=e,a.shape=new egret.Shape,a.addChild(a.shape),a.drawRadar(i,n),a}return __extends(e,t),e.prototype.drawRadar=function(t,e){var i=this.data.length,n=t/2,a=[10,8,6],r=this.shape.graphics,s=[];for(var o in a){var h=0,l=0,d=a[o];10==d?r.lineStyle(3,5425626):r.lineStyle(2,10801619,1,!0,egret.StageScaleMode.FIXED_WIDTH,egret.CapsStyle.ROUND,egret.JointStyle.ROUND,1,[6,6]);for(var c=0;i>c;c++){var g=2*Math.PI/i*c,u=n+Math.cos(g)*n*(d/10),p=n+Math.sin(g)*n*(d/10);10==d&&s.push({x:u,y:p}),0==c?(h=u,l=p,r.moveTo(u,p),console.log(u,p)):r.lineTo(u,p)}r.lineTo(h,l),r.endFill()}r.lineStyle(2,11656156,1,!0,egret.StageScaleMode.FIXED_WIDTH,egret.CapsStyle.ROUND,egret.JointStyle.ROUND,1,[6,6]);for(var v in s)r.moveTo(t/2,e/2),r.lineTo(s[v].x,s[v].y);r.endFill(),r.lineStyle(3,10801619);var T=0,f=0;r.beginFill(10801619,.5);for(var c=0;i>c;c++){var g=2*Math.PI/i*c,u=n+Math.cos(g)*n*this.data[c].rate,p=n+Math.sin(g)*n*this.data[c].rate;0==c?(T=u,f=p,r.moveTo(u,p)):r.lineTo(u,p)}r.lineTo(T,f),r.endFill();for(var v in s){var m=new egret.TextField;m.text=this.data[v].name,m.textColor=Config.COLOR_ORANGE,m.size=32;var y=s[v].x,_=s[v].y;140>y?y-=90:y>160?y+=20:y-=30,0==_&&(_-=80),300==_&&(_+=20),m.x=y,m.y=_-15,("2"==v||"3"==v||"4"==v)&&(m.textAlign=egret.HorizontalAlign.RIGHT,m.width=200,m.x=y-135),this.addChild(m)}for(var c=0;i>c;c++){r.lineStyle(3,13933178),r.beginFill(13933178,.5);var g=2*Math.PI/i*c,u=n+Math.cos(g)*n*this.data[c].rate,p=n+Math.sin(g)*n*this.data[c].rate;r.drawArc(u,p,4,0,2*Math.PI),r.endFill()}},e}(egret.Sprite);__reflect(Radar.prototype,"Radar");var RadarPanel=function(t){function e(e,i){var n=t.call(this)||this;return n.t=e,n.pp=i,n}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.share.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new SharePanel;e.pp.addChild(t)},this),this.savePic.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSaveImg,this)},e.prototype.onSaveImg=function(){var t=new AlertPanel("提示:请自行截图保存图片");this.pp.addChild(t)},e}(eui.Component);__reflect(RadarPanel.prototype,"RadarPanel",["eui.UIComponent","egret.DisplayObject"]);var RankerPanel=function(t){function e(e){var i=t.call(this)||this;return i.ranks=e,i.init(),i}return __extends(e,t),e.prototype.loadBg=function(){var t=ViewManager.getInstance().stage,e=Util.createBitmapByName("mask_png");e.y=0,e.x=0,e.width=t.stageWidth,e.height=t.stageHeight,this.addChild(e)},e.prototype.init=function(){var t=this;this.loadBg();var e=ViewManager.getInstance().stage,i=new eui.Panel;i.title="战队月排名";var n=(e.stageHeight-1e3)/2;i.width=700,i.height=1e3,i.y=e.stageHeight/2,i.x=e.stageWidth/2,i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.scaleX=0,i.scaleY=0,egret.Tween.get(i).to({scaleX:1,scaleY:1},300,egret.Ease.backInOut),this.addChild(i);var a=new eui.Group;a.height=5e3,a.width=700,i.addChild(a);var r=this.ranks,s=50;n=0;for(var o=0,h=r;o<h.length;o++){var l=h[o],d=new RankItemTeamTemplate(l,!1);d.x=s,d.y=n,a.addChild(d),n+=140}var c=new eui.Scroller;c.height=800,c.width=660,c.y=150,c.x=20,c.viewport=a,i.addChild(c);var g=Util.createBitmapByName("dialog_close_x_png");i.addChild(g),g.x=i.width-80,g.y=-10,g.touchEnabled=!0,g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("close"),Util.playMusic("model_select_mp3"),eui.UIEvent.dispatchUIEvent(t,eui.UIEvent.CLOSING,!0,!0),t.parent.removeChild(t),i.close()},this)},e}(eui.Group);__reflect(RankerPanel.prototype,"RankerPanel");var RankItem=function(t){function e(e,i){void 0===i&&(i=600);var n=t.call(this)||this;return n.width=i,n.rankData=e,n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=this;this.height=130;var e;if(e=1==this.rankData.serialNo?Util.createBitmapByName("rank_item1_bg_png"):Util.createBitmapByName("rank_item_bg_png"),e.width=this.width,e.height=this.height,this.addChild(e),this.rankData.serialNo<4){var i=Util.createBitmapByName("cup"+this.rankData.serialNo+"_png");i.width=28,i.height=27,i.x=this.width-40,i.y=40,this.addChild(i)}var n=Util.createBitmapByName("rank_number_bg_png");n.width=59,n.height=59,n.x=-30,n.y=20,this.addChild(n);var a=new egret.TextField;a.text=this.rankData.serialNo+"",a.size=28,a.x=-25,a.y=25,a.height=50,a.width=50,a.verticalAlign=egret.VerticalAlign.MIDDLE,a.textAlign=egret.HorizontalAlign.CENTER,this.addChild(a);var r=new egret.TextField;1==this.rankData.type?r.text=this.rankData.teamName+"-"+this.rankData.userName:r.text=this.rankData.teamName,r.size=30,r.height=60,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.textAlign=egret.HorizontalAlign.CENTER,r.width=this.width,r.y=10,this.addChild(r);var s=Util.createBitmapByName("dialog_line_png");s.x=138,s.y=70,s.width=323,this.addChild(s);var o=new egret.TextField;1==this.rankData.type?o.textFlow=new Array({text:"个人积分:"},{text:this.rankData.score+"",style:{textColor:16018466,size:32}}):o.textFlow=new Array({text:"战队积分:"},{text:this.rankData.teamScore+"",style:{textColor:16018466,size:32}}),o.size=30,o.height=60,o.verticalAlign=egret.VerticalAlign.MIDDLE,o.textAlign=egret.HorizontalAlign.CENTER,o.width=this.width,o.y=72,this.addChild(o),2==this.rankData.type&&this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new TeamRankScene(t.rankData.teamId);ViewManager.getInstance().changeScene(e)},this)},e}(eui.Group);__reflect(RankItem.prototype,"RankItem");var AlertPanel=function(t){function e(e,i){void 0===e&&(e=" "),void 0===i&&(i=!1);var n=t.call(this)||this;return n.title="",n.isGray=!1,n.title=e,n.isGray=i,n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=this,e=ViewManager.getInstance().stage,i=Util.createBitmapByName("mask_png");i.y=0,i.x=0,i.width=e.stageWidth,i.height=e.stageHeight,this.addChild(i);var n=new eui.Panel;n.skinName="resource/eui_skins/AlertPanelSkin.exml",n.title=this.title,n.width=680,n.height=235,n.y=(e.stageHeight-235)/2,n.x=e.stageWidth/2,this.addChild(n),n.closeButton.visible=!1,this.isGray&&(n.filters=[Util.grayFliter()]);var a=Util.createBitmapByName("dialog_close_png");n.addChild(a),a.x=n.width-10,a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("close"),Util.playMusic("model_select_mp3"),t.parent.removeChild(t),n.close()},this),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.scaleX=0,n.scaleY=0,egret.Tween.get(n).to({scaleX:1,scaleY:1},300,egret.Ease.backInOut),a.anchorOffsetX=n.closeButton.width/2,a.anchorOffsetY=n.closeButton.height/2,egret.Tween.get(a,{loop:!0}).to({rotation:360},3e3),n.addEventListener(eui.UIEvent.CLOSING,function(){t.parent.removeChild(t)},this)},e}(eui.Group);__reflect(AlertPanel.prototype,"AlertPanel");var RankItemTeamTemplate=function(t){function e(e,i){var n=t.call(this)||this;return n.teamName=e.teamName,n.serialNo=e.serialNo,n.achiRate=e.achiRate+"%",n.rankData=e,n.isDrill=i,n}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.rankData.serialNo>9&&(this.labserialNo.x-=8),1==this.rankData.serialNo?this.bigImg.source="rank_item1_bg_png":this.bigImg.source="rank_item_bg_png",this.rankData.serialNo<4?this.cup.source="cup"+this.rankData.serialNo+"_png":this.cup.visible=!1,this.isDrill&&this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new TeamRankScene(e.rankData.teamId);ViewManager.getInstance().changeScene(t)},this)},e}(eui.Component);__reflect(RankItemTeamTemplate.prototype,"RankItemTeamTemplate",["eui.UIComponent","egret.DisplayObject"]);var RankItemTemplate=function(t){function e(e){var i=t.call(this)||this;return i.teamName=e.teamName,i.userName=e.userName,i.serialNo=e.serialNo,i.score=e.score,i.achiRate=e.achiRate+"%",i.rankData=e,i}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rankData.serialNo>9&&(this.labserialNo.x-=8),1==this.rankData.serialNo?this.bigImg.source="rank_item1_bg_png":this.bigImg.source="rank_item_bg_png",this.rankData.serialNo<4?this.cup.source="cup"+this.rankData.serialNo+"_png":this.cup.visible=!1},e}(eui.Component);__reflect(RankItemTemplate.prototype,"RankItemTemplate",["eui.UIComponent","egret.DisplayObject"]);var ResultAlert=function(t){function e(e,i,n,a){var r=t.call(this)||this;return r.type=e,r.error=i,r.order=n,r.score=a,r.init(),r}return __extends(e,t),e.prototype.init=function(){this.width=240,this.height=120;var t="left_bg_png",e="green_flag_png",i=[10,80,145],n=0,a=2;this.type==UserPositionType.RIGHT&&(t="right_bg_png",e="blue_flag_png",n=2,a=0);var r=Util.createBitmapByName(t);r.width=this.width,r.height=this.height,r.alpha=.5,this.addChild(r);var s=Util.createBitmapByName(e);s.x=i[n],s.y=25,this.addChild(s);var o=new egret.TextField;o.text=this.order,o.size=24,o.height=54,o.verticalAlign=egret.VerticalAlign.MIDDLE,o.textAlign=egret.HorizontalAlign.CENTER,o.width=70,o.x=s.x,o.y=s.y,this.addChild(o);var h="answer_error_png";this.error&&(h="answer_ok_png");var l=Util.createBitmapByName(h);l.x=i[1],l.y=35,this.addChild(l);var d=new egret.TextField;d.text=this.score,d.size=35,d.height=this.height,d.verticalAlign=egret.VerticalAlign.MIDDLE,d.width=70,d.x=i[a],0==a&&(d.x=i[a]+20),this.addChild(d)},e}(eui.Group);__reflect(ResultAlert.prototype,"ResultAlert");var NoScoreAlert=function(t){function e(e){var i=t.call(this)||this;return i.text=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){this.width=345,this.height=139,this.x=(ViewManager.getInstance().stage.stageWidth-this.width)/2,this.y=ViewManager.getInstance().stage.stageHeight/2+200;var t=Util.createBitmapByName("alert_team_error_png");t.width=this.width,t.height=this.height,this.addChild(t);var e=new egret.TextField;e.width=this.width-40,e.height=this.height-20,e.x=20,e.y=10,e.textAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(e),e.text=this.text},e}(eui.Group);__reflect(NoScoreAlert.prototype,"NoScoreAlert");var MvpAlert=function(t){function e(e){void 0===e&&(e=TeamType.GREEN);var i=t.call(this)||this;return i.type=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){this.width=120,this.height=125;var t="green_mvp_bg_png",e=0;this.type==TeamType.BLUE&&(t="blue_mvp_bg_png",e=13);var i=Util.createBitmapByName(t);i.width=this.width,i.height=this.height,this.addChild(i);var n=Util.createBitmapByName("result_mvp_png");n.x=e,n.y=10,n.width=98,n.height=98,this.addChild(n)},e}(eui.Group);__reflect(MvpAlert.prototype,"MvpAlert");var SearchInput=function(t){function e(e){var i=t.call(this)||this;return i.keywords=e,i}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btnSearch.touchEnabled=!0,this.btnSearch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=e.txtInput.text;if(""==i){var n=new AlertPanel("请输入查询关键字");n.x=0-e.x,n.y=0-e.y,t.prototype.addChildAt.call(e,n,100)}else{var a=new EquipSearch(i);ViewManager.getInstance().changeScene(a)}},this)},e}(eui.Component);__reflect(SearchInput.prototype,"SearchInput",["eui.UIComponent","egret.DisplayObject"]);var SharePanel=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this,e=ViewManager.getInstance().stage,i=Util.createBitmapByName("mask_png");i.y=0,i.x=0,i.width=e.stageWidth,i.height=e.stageHeight,this.addChild(i);var n=Util.createBitmapByName("share_arrow_png");n.width=250,n.x=e.stageWidth-290,this.addChild(n);var a;"Android"==egret.Capabilities.os?(a=Util.createBitmapByName("share_tips_android_jpg"),a.width=e.stageWidth,a.height=.634*e.stageWidth):(a=Util.createBitmapByName("share_tips_jpg"),a.width=e.stageWidth,a.height=.876*e.stageWidth),a.y=e.stageHeight-a.height,this.addChild(a),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Util.playMusic("model_select_mp3"),t.parent.removeChild(t)},this)},e}(eui.Group);__reflect(SharePanel.prototype,"SharePanel");var AlertLoading=function(t){function e(e){void 0===e&&(e="");var i=t.call(this)||this;return i.text=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){this.height=150,this.width=400;var t=ViewManager.getInstance().stage,e=Util.createBitmapByName("mask_png");this.maskView=e,e.alpha=.5,e.width=this.width,e.x=t.stageWidth/2,e.y=t.stageHeight/2,e.anchorOffsetX=this.width/2,e.anchorOffsetY=this.height/2,this.addChildAt(e,100);var i=Util.createBitmapByName("loading_png");this.addChildAt(i,101),i.width=64,i.height=64,i.x=t.stageWidth/2,i.y=t.stageHeight/2-20,i.anchorOffsetX=32,i.anchorOffsetY=32,egret.Tween.get(i,{loop:!0}).to({rotation:360},2500);var n=new egret.TextField;this.loadingText=n,n.text=this.text,n.size=28,n.x=t.stageWidth/2,n.y=t.stageHeight/2+30,n.anchorOffsetX=this.width/2-10,n.width=this.width-20,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.textAlign=egret.HorizontalAlign.CENTER,n.lineSpacing=10,this.height=n.textHeight+150,e.height=this.height;var a=new egret.Shape;a.graphics.beginFill(16711680,1),a.graphics.drawRoundRect(t.stageWidth/2-200,t.stageHeight/2-75,this.width,this.height,10,10),a.graphics.endFill(),this.addChild(a),this.mask=a,this.addChild(n)},e.prototype.setText=function(t){this.text=t,this.loadingText.text=this.text},e}(eui.Group);__reflect(AlertLoading.prototype,"AlertLoading");var Sign=function(t){function e(){var e=t.call(this)||this;e.WEEK=["MON","TUE","WED","THU","FRI","SAT","SUN"],e.MONTH=["January","February","March","April","May","June","July","August","September","October","November","December"],e.signed=[1,4],e.signData=DataManager.getInstance().getSign();for(var i=e.signData.signStr.split(""),n=[],a=1,r=0,s=i;r<s.length;r++){var o=s[r];o>0&&n.push(a),a++}return console.log("signedData:",n),e.signed=n,e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=this,e=ViewManager.getInstance().stage,i=Util.createBitmapByName("mask_png");i.touchEnabled=!0,i.y=0,i.x=0,i.width=e.stageWidth,i.height=e.stageHeight,this.addChild(i);var n=new eui.Panel;n.title="每日自动签到",n.horizontalCenter=0,n.verticalCenter=0,this.addChild(n),this.panel=n,n.height=1e3,n.width=700,n.y=e.stageHeight/2,n.x=e.stageWidth/2,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2,n.scaleX=0,n.scaleY=0,egret.Tween.get(n).to({scaleX:1,scaleY:1},300,egret.Ease.backInOut);var a=Util.createBitmapByName("dialog_close_png");n.addChild(a);var r=Util.createBitmapByName("dialog_close_x_png");n.addChild(r),r.x=n.width-80,r.y=-10,a.x=n.width-10,a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("close"),Util.playMusic("model_select_mp3"),eui.UIEvent.dispatchUIEvent(t,eui.UIEvent.CLOSING,!0,!0),t.parent.removeChild(t),n.close()},this),a.anchorOffsetX=49.5,a.anchorOffsetY=49.5,egret.Tween.get(a,{loop:!0}).to({rotation:360},3e3),this.creatCalender(),this.createSignText(top)},e.prototype.createSignText=function(t){var e=new eui.Group;e.y=t+300,this.panel.addChild(e);var i=new egret.TextField;i.text=""+this.signData.signtTotal,i.width=250,i.x=65,i.size=32,i.y=1,i.textAlign=egret.HorizontalAlign.LEFT,e.addChild(i);var n=new egret.TextField;n.text="天 累计签到",n.size=21,n.x=100,n.y=9,n.width=250,n.textAlign=egret.HorizontalAlign.LEFT,e.addChild(n);var a=new egret.TextField;a.text=""+this.signData.signAllTotal,a.size=32,a.width=250,a.x=240,a.y=1,a.textAlign=egret.HorizontalAlign.RIGHT,e.addChild(a);var r=new egret.TextField;r.text="人 今日签到",r.x=450,r.width=250,r.size=21,r.y=9,r.textAlign=egret.HorizontalAlign.CENTER,e.addChild(r);var s=DataManager.getInstance().getUser(),o=ViewManager.getInstance().stage,h=new egret.TextField;h.text="你已持续达标"+s.contSignTotal+"天",h.width=380,h.x=(o.stageWidth-380)/2,h.y=90,h.size=40,h.textColor=15395091,e.addChild(h)},e.prototype.creatCalender=function(){var t=new eui.Group;t.y=180,this.panel.addChild(t);var e=88,i=70,n=45,a=(new Date).getMonth(),r=new egret.TextField;r.x=n+10,r.text=this.MONTH[a],r.size=60,r.y=20,t.addChild(r);var s=Util.createBitmapByName("icon_calendar_png");s.x=n+528+25,s.y=20,s.width=46,s.height=50,t.addChild(s);for(var o=0;o<this.WEEK.length;o++){console.log(o);var h=new egret.TextField;h.text=this.WEEK[o],h.y=110,h.x=n+o*e,h.width=e,h.textAlign=egret.HorizontalAlign.CENTER,h.size=24,t.addChild(h)}var l=new Date,d=l.getDate(),c=l.getMonth();l.setMonth(c+1),l.setDate(0);var g=l.getDate();l.setDate(1);var u=l.getDay(),p=u+g;console.log(g,p);for(var o=(Math.ceil(p/7),0);p>o;o++)if(o>=u){var v=o-u+1,T=0;this.signed.indexOf(v)>-1&&(T=1),d==v&&(T=2);var f=new SignItem(v,T);f.x=n+o%7*e,f.y=Math.ceil((o+1)/7)*i+70,t.addChild(f)}var m=100+Math.ceil(p/7)*i,y=Util.createBitmapByName("user_line_png");y.y=m+70,y.x=60,t.addChild(y),this.createSignText(m)},e}(egret.DisplayObjectContainer);__reflect(Sign.prototype,"Sign");var SignItem=function(t){function e(e,i){void 0===i&&(i=0);var n=t.call(this)||this;return n.W=88,n.H=70,n.sign=0,n.text=e,n.sign=i,n.width=n.W,n.height=n.H,n.init(),n}return __extends(e,t),e.prototype.init=function(){if(this.sign>0){var t=Util.createBitmapByName("sign_mask_png");t.width=t.height=64,t.x=(this.W-t.width)/2,t.y=(this.H-t.height)/2,this.addChild(t);var e=Util.createBitmapByName("sign_icon_png");e.width=39,e.height=38;var i=t.x,n=this.H-e.height;if(e.x=i,e.y=n,this.addChild(e),2==this.sign){e.x=i-30,e.y=n+20;var a=new egret.Shape;a.graphics.beginFill(15658734),a.graphics.drawCircle(0,0,32),a.graphics.endFill(),this.addChild(a),a.x=this.W/2,a.y=this.H/2,a.alpha=.5,e.mask=a,egret.Tween.get(e).to({x:i,y:n},3e3,egret.Ease.backInOut)}}var r=new egret.TextField;r.text=this.text,r.width=this.W,r.height=this.H,r.size=28,r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(r)},e}(egret.DisplayObjectContainer);__reflect(SignItem.prototype,"SignItem");var Button=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(eui.Button);__reflect(Button.prototype,"Button");var Title=function(t){function e(e){var i=t.call(this)||this;return i.title=e,i.height=80,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=ViewManager.getInstance().stage,e=new egret.TextField;this.addChild(e),this.titleText=e,e.text=this.title,e.width=t.stageWidth,e.height=this.height,e.textColor=15952929,e.textAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE},e.prototype.updateTitle=function(t){this.titleText.textFlow=t},e}(eui.Group);__reflect(Title.prototype,"Title");var Topic=function(t){function e(e,i){void 0===i&&(i=600);var n=t.call(this)||this;return n.options={},n.canSelected=!0,n.subject=e,n.width=i,n.subject.type==TopicType.BLANK?n.initBlank():n.init(),n}return __extends(e,t),e.prototype.init=function(){var t=(ViewManager.getInstance().stage,new egret.TextField);t.y=5,t.width=this.width,t.textColor=4280932;var e=this.subject.title;this.subject.type==TopicType.MULTIPLE&&(e+="(多选题)"),this.title=t,t.text=e,t.lineSpacing=10,t.textAlign=egret.HorizontalAlign.CENTER,this.addChild(t);for(var i=t.textHeight+30,n=0,a=this.subject.options;n<a.length;n++){var r=a[n];if(r.name&&r.name.length>=1){var s=new TopicItem(r,this.width);s.y=i,s.x=20,this.addChild(s),this.options[r.flag]=s,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSelect(r.flag),this),i+=s.height+30}}this.height=i+100},e.prototype.onSelect=function(t){var e=this;return function(){if(Util.playMusic("model_select_mp3"),e.canSelected)for(var i in e.options){var n=e.options[i];if(i==t)if(e.subject.type==TopicType.MULTIPLE){e.selected||(e.selected=[]);var a=e.selected.indexOf(t);a>-1?(e.selected.splice(a,1),n.setStatus(TopicItem.STATUS_NORMAL)):(e.selected.push(t),n.setStatus(TopicItem.STATUS_SELECTED))}else e.selected=t,n.setStatus(TopicItem.STATUS_SELECTED);else{if(e.subject.type==TopicType.MULTIPLE)continue;n.reset()}}}},e.prototype.initBlank=function(){ViewManager.getInstance().stage;this.width=600;var t=new egret.TextField;t.width=600,this.title=t,t.lineSpacing=10,t.y=10,t.lineSpacing=10,this.addChild(t);var e=this.subject.title.split("__"),i=[];this.textFlow=i;for(var n=0,a=0,r=e;a<r.length;a++){var s=r[a];i.push({text:s}),0==n&&i.push({text:"         ",style:{underline:!0,size:30}}),n++}t.textFlow=i;var o=new egret.TextField;this.addChild(o),o.text="",o.width=1,o.height=1,o.y=100,o.alpha=.01,o.type=egret.TextFieldType.INPUT,o.addEventListener(egret.FocusEvent.FOCUS_IN,function(t){console.log("input set FOCUS")},this),o.addEventListener(egret.FocusEvent.FOCUS_OUT,function(t){},this),o.addEventListener(egret.Event.CHANGE,function(e){this.selected=o.text,this.textFlow[1]={text:"  "+o.text+"  ",style:{underline:!0,size:30}},t.textFlow=this.textFlow},this),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){console.log("input set FOCUS_OUT"),o.setFocus()},this);var h=new egret.TextField;h.text="点击横线处输入答案",h.textColor=10066329,h.width=this.width,h.y=300,h.textAlign=egret.HorizontalAlign.CENTER,this.addChild(h)},e.prototype.getSelect=function(){return this.selected?this.subject.type==TopicType.MULTIPLE?this.selected.join(""):this.selected:null},e.prototype.setSelectedStatus=function(t){switch(this.subject.type){case TopicType.SINGLE:this.options[this.selected].setStatus(t);break;case TopicType.MULTIPLE:var e=this.subject.result.split(",");for(var i in this.options){var n=this.options[i];Util.inArray(i,this.selected)?Util.inArray(i,e)?n.setStatus(TopicItem.STATUS_OK):n.setStatus(TopicItem.STATUS_ERROR):Util.inArray(i,e)&&n.setStatus(TopicItem.STATUS_CORRECT)}break;case TopicType.BLANK:switch(t){case TopicItem.STATUS_OK:this.textFlow[1].style.textColor=Config.COLOR_YELLOW,this.title.textFlow=this.textFlow;break;case TopicItem.STATUS_ERROR:this.textFlow[1].style.textColor=16711680,this.title.textFlow=this.textFlow}}},e.prototype.setDisableSeleced=function(){this.canSelected=!1},e.prototype.getSelectResult=function(){switch(console.log("this.selected",this.selected),this.subject.type){case TopicType.SINGLE:case TopicType.BLANK:return this.selected==this.subject.result?!0:!1;case TopicType.MULTIPLE:var t=this.subject.result.split(",");return t.sort().toString()==this.selected.sort().toString()?!0:!1}},e.prototype.getQAttrId=function(){return this.subject.qattrid},e.prototype.setCorrectItem=function(){this.options[this.subject.result].setStatus(TopicItem.STATUS_CORRECT)},e}(eui.Group);__reflect(Topic.prototype,"Topic");var TopicType;!function(t){t[t.SINGLE=1]="SINGLE",t[t.MULTIPLE=2]="MULTIPLE",t[t.BLANK=3]="BLANK"}(TopicType||(TopicType={}));var TopicItem=function(t){function e(i,n){void 0===n&&(n=600);var a=t.call(this)||this;a.BG_RES=["option_normal_png","option_select_png","option_error_png","option_ok_png","option_ok_png"],a.ICON_RES={2:"icon_err_png",3:"icon_ok_png"},a.RECT={width:560,height:93},a.width=n,a.option=i,a.status=e.STATUS_NORMAL,a.touchEnabled=!0;var r=Math.ceil(a.option.name.length/12);return a.line=r,a.height=a.RECT.height+25*(r-1),a.init(),a}return __extends(e,t),e.prototype.initBg=function(){var t=Util.createBitmapByName(this.BG_RES[this.status]);t.width=this.width-40,t.height=this.height,this.bg=t,this.addChild(t);var i=new egret.Bitmap;i.width=36,i.height=36,i.x=10,i.y=(this.RECT.height-i.height)/2,this.icon=i,this.addChild(i),(this.status==e.STATUS_OK||this.status==e.STATUS_ERROR)&&(this.icon.texture=RES.getRes(this.ICON_RES[this.status]))},e.prototype.onTap=function(){this.setStatus(e.STATUS_SELECTED)},e.prototype.reset=function(){this.setStatus(e.STATUS_NORMAL)},e.prototype.setStatus=function(t){this.status!=t&&(this.status=t,this.bg.texture=RES.getRes(this.BG_RES[t]),t==e.STATUS_SELECTED?this.text.textColor=16777215:this.text.textColor=Config.COLOR_GREY,t==e.STATUS_OK||t==e.STATUS_ERROR?(this.icon.visible=!0,this.icon.texture=RES.getRes(this.ICON_RES[t]),this.text.textColor=Config.COLOR_ORANGE):this.icon.visible=!1)},e.prototype.init=function(){this.initBg();var t=new egret.TextField;t.text=this.option.name,t.width=this.width-120,t.lineSpacing=10;var e=28;t.size=e,t.x=60,t.height=this.height,t.textAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.textColor=4280932,this.text=t,this.addChild(t)},e.prototype.release=function(){this.removeChildren()},e.STATUS_NORMAL=0,e.STATUS_SELECTED=1,e.STATUS_ERROR=2,e.STATUS_OK=3,e.STATUS_CORRECT=4,e}(egret.DisplayObjectContainer);__reflect(TopicItem.prototype,"TopicItem");var Blanks=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(eui.Group);__reflect(Blanks.prototype,"Blanks");var TrainSummary=function(t){function e(e,i){var n=t.call(this)||this;return n.t1=e,n.t2=i,n}return __extends(e,t),e.prototype.partAdded=function(e,i){t.prototype.partAdded.call(this,e,i)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(eui.Component);__reflect(TrainSummary.prototype,"TrainSummary",["eui.UIComponent","egret.DisplayObject"]);var UserInfo=function(t){function e(e){var i=t.call(this)||this;if(i.type=UserType.home,i.isinit=!1,i.timer=null,i.setting={1:{height:426,width:636,range:55,icon:190},2:{height:360,width:636,range:40,icon:260},3:{height:500,width:636,range:40,icon:260}},i.type=e,i.userinfo=DataManager.getInstance().getUser(),i.userinfo)i.init();else{var n=new egret.Timer(500,5);n.addEventListener(egret.TimerEvent.TIMER,i.timerFunc,i),i.timer=n}return i}return __extends(e,t),e.prototype.timerFunc=function(){this.isinit||(this.userinfo=DataManager.getInstance().getUser(),this.userinfo&&this.init())},e.prototype.refresh=function(){console.log("更新用户数据"),this.removeChildren(),this.userinfo=DataManager.getInstance().getUser(),this.init()},e.prototype.init=function(){this.isinit=!0,this.timer&&this.timer.stop();var t=ViewManager.getInstance().stage,e=this.setting[this.type],i=Util.createBitmapByName("info_bg_png");i.width=725,i.x=0,i.y=25,this.addChild(i);var n=new eui.Group;if(n.width=e.width-64,n.height=e.height-64,n.x=64,n.y=64,this.addChild(n),this.group=n,this.initRight(),this.initLeft(),this.type==UserType.score){var a=this.userinfo.trainResult,r=Math.round(100*a.trainCorrectCount/a.trainTotalCount),s=new TrainSummary(a.trainTotalCount+"道题",r+"%");s.x=(t.stageWidth-564)/2,s.y=560,this.addChild(s)}},e.prototype.initLeft=function(){var t=this.setting[this.type],e=this.group.width/4-10-t.icon/2,i=new eui.Group;i.width=t.icon,i.height=t.icon,i.x=e,i.y=10,this.group.addChild(i);var n=Util.createBitmapByName("icon_2_jpg");n.width=70,n.height=70,n.x=75,n.y=0,i.addChild(n),Util.setUserImg(this.userinfo.avatar,n);var a=new egret.Shape;a.graphics.beginFill(255),a.graphics.drawCircle(110,35,35),a.graphics.endFill(),i.addChild(a),n.mask=a;var r=Util.createBitmapByName("user_pic_border_png");r.width=73,r.height=73,r.x=75,r.y=0,i.addChild(r);var s=["icon_xin_png","icon_bai_png","icon_da_png"],o=Math.ceil(this.userinfo.lv/20)-1,h=Util.grayFliter(),l=0,d=1;console.log("初始化用户界面");for(var c=0,g=s;c<g.length;c++){var u=g[c],p=Util.createBitmapByName(u);p.x=l,p.y=100,this.group.addChild(p),l+=75,d>o&&(p.filters=[h]),d++}var v=new egret.TextField;v.text=this.userinfo.lvName,v.textColor=4477796,v.size=60,v.x=e,v.y=190,this.group.addChild(v);var T=new egret.TextField;if(T.text=this.userinfo.nickName,T.width=t.icon-20,T.height=60,T.wordWrap=!1,T.multiline=!1,T.x=0,T.textColor=16018466,T.textAlign=egret.HorizontalAlign.LEFT,T.y=260,T.size=50,i.addChild(T),this.type==UserType.center){var f=new egret.Shape;f.graphics.lineStyle(2,0),f.graphics.moveTo(this.group.width/2,0),f.graphics.lineTo(this.group.width/2,this.group.height-20),f.graphics.endFill(),this.group.addChild(f)}},e.prototype.initRight=function(){var t=this.group.width/2+32,e=16018466;(this.type==UserType.home||this.type==UserType.score)&&(t=this.group.width/2+12);var i=0,n=this.setting[this.type].range,a=new egret.TextField;if(a.textFlow=[{text:"个人积分：",style:{size:30,textColor:e}},{text:""+this.userinfo.score,style:{size:40,textColor:e}},{text:" 分",style:{size:30,textColor:e}}],a.x=t+20,a.y=i-20,a.size=30,a.textColor=e,this.group.addChild(a),this.type==UserType.home||this.type==UserType.score){i+=n;var r=new egret.TextField;r.x=t+70,r.y=i+42,r.textFlow=[{text:"个人达标率：",style:{size:30,textColor:e}},{text:""+this.userinfo.personAchiRate,style:{size:40,textColor:e}},{text:" %",style:{size:30,textColor:e}}],this.group.addChild(r);var s=new egret.TextField;s.textFlow=[{text:"团队达标率：",style:{size:30,textColor:e}},{text:""+this.userinfo.teamAchiRate,style:{size:40,textColor:e}},{text:" %",style:{size:30,textColor:e}}],s.x=t+70,s.y=i+163,this.group.addChild(s)}i+=n;var o=new egret.TextField;o.textFlow=[{text:"连续达标天数：",style:{size:30,textColor:e}},{text:""+this.userinfo.contSignTotal,style:{size:40,textColor:e}},{text:"天",style:{size:30,textColor:e}}],o.x=t+20,o.y=i+240,o.size=30,o.textColor=16018466,this.group.addChild(o)},e}(eui.Group);__reflect(UserInfo.prototype,"UserInfo");var UserType;!function(t){t[t.home=2]="home",t[t.center=1]="center",t[t.score=3]="score"}(UserType||(UserType={}));var VProgress=function(t){function e(e,i){void 0===e&&(e=1),void 0===i&&(i=10);var n=t.call(this)||this;return n.config={1:{bg:"v_progress_bg_png",thumb:"v_progress_thumb_png"},2:{bg:"v_progress_bg2_png",thumb:"v_progress_thumb2_png"}},n.type=e,n.max=i,n.init(),n}return __extends(e,t),e.prototype.init=function(){this.width=26,this.height=600;var t=Util.createBitmapByName(this.config[this.type].bg);t.width=this.width,t.height=this.height,this.addChild(t);
var e=Util.createBitmapByName(this.config[this.type].thumb);e.fillMode=egret.BitmapFillMode.REPEAT,e.height=250,e.y=t.height-e.height,this.addChild(e);var i=new egret.Shape;i.graphics.beginFill(16711680,1),i.graphics.drawRoundRect(0,0,26,600,26,26),i.graphics.endFill(),this.addChild(i),e.mask=i,this.thumb=e},e.prototype.setRate=function(t){var e=this.height*t/this.max;this.thumb.height=e,this.thumb.y=this.height-e},e}(eui.Group);__reflect(VProgress.prototype,"VProgress");var ButtonType;!function(t){t[t.NOMAL=1]="NOMAL",t[t.YELLOW=2]="YELLOW"}(ButtonType||(ButtonType={}));var XButton=function(t){function e(e,i){void 0===i&&(i=ButtonType.NOMAL);var n=t.call(this)||this;switch(n.yellowSkin='<e:Skin class="skins.ButtonSkin"  states="up,down,disabled" minHeight="79" minWidth="336" xmlns:e="http://ns.egret.com/eui" xmlns:w="http://ns.egret.com/wing" height="79">\n <e:Image width="100%" height="100%" alpha.disabled="0.5" fillMode="scale" source="button_bg_png" scale9Grid="68,31,188,35"/>\n    <e:Label id="labelDisplay" top="13" bottom="12" left="16" right="14" size="28" textColor="0xFFFFFF" verticalAlign="middle" textAlign="center" height="60" fontFamily="SimHei" anchorOffsetX="0" anchorOffsetY="0"/>\n    <e:Image id="iconDisplay" horizontalCenter="-124" verticalCenter="-11.5" width="24" height="24"/>\n</e:Skin>',i){case ButtonType.NOMAL:n.skinName="resource/eui_skins/Button.exml";break;case ButtonType.YELLOW:n.skinName=n.yellowSkin}return n.addEventListener(egret.Event.ADDED_TO_STAGE,function(){var t=Util.getLightFliter(16711680);n.iconDisplay.filters=[t]},n),n.labelDisplay.text=e,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Util.playMusic("model_select_mp3")},n),n}return __extends(e,t),e.prototype.setType=function(t){switch(t){case ButtonType.NOMAL:this.skinName="resource/eui_skins/Button.exml";break;case ButtonType.YELLOW:this.skinName=this.yellowSkin}},e}(eui.Button);__reflect(XButton.prototype,"XButton");var NetEvent=function(){function t(){}return t.ON_CONNENT="connect",t.DIS_CONNENT="disconnect",t.RE_CONNENT="reconnect",t.PK_IN_ROOM="opend",t.PK_OAUTH="oauth",t.PK_MATCH="match",t.CACEL_MATCH="closematch",t.MATCH_TIMER_END="matchend",t.PK_START="startpk",t.PK_ANSWER="answerpk",t.PK_PROGRESS="progressbar",t.PK_END="endpk",t.PK_INVITE="invitepk",t.PK_ACCEPT="acceptpk",t.GET_USERINFO="userinfo",t.PK_RECORDS="pklogs",t.PK_INFO="pklog",t.TEAM_ROOMLIST_USER_UPDATE="tablebroadcast",t.TEAM_ROOM_LIST="tablelist",t.TEAM_JOIN_IN="jointable",t.TEAM_JOIN_BROADCAST="jointablebroadcast",t.TEAM_LEAVE_ROOM="leavetable",t.TEAM_LEAVE_ROOM_BROADCAST="leavetablebroadcast",t.TEAM_PK_READY="ready",t.TEAM_READY_BROADCAST="readybroadcast",t.TEAM_READY_JOIN="team_ready_join",t.TEAM_CHANGE_POSITION="tochangepos",t.TEAM_CHANGE_POSITION_REPLY="dochangepos",t.TEAM_CHANGE_POSITION_BROADCAST="changeposbroadcast",t.TEAM_COUNT_DOWN_BROADCAST="countdownbroadcast",t.TEAM_PK_START="startpk",t.TEAM_PK_SUBMIT="answerpk",t.TEAM_PK_SUBMIT_BROADCAST="answerpkbroadcast",t.TEAM_PK_NEXT_BROADCAST="answernextbroadcast",t.TEAM_END_PK="endpkbroadcast",t.TEAM_PK_KNOW_RESULT="checkpk",t}();__reflect(NetEvent.prototype,"NetEvent");var UserEvent=function(t){function e(e,i,n){return void 0===i&&(i=!1),void 0===n&&(n=!1),t.call(this,e,i,n)||this}return __extends(e,t),e.UPDATE_USER_EVENT="UPDATE_USER_EVENT",e}(egret.Event);__reflect(UserEvent.prototype,"UserEvent");var SceneEvent=function(){function t(){}return t}();__reflect(SceneEvent.prototype,"SceneEvent");var TitleEvent=function(t){function e(e,i,n){void 0===i&&(i=!1),void 0===n&&(n=!1);var a=t.call(this,e,i,n)||this;return a.title="",a}return __extends(e,t),e.BACK="BACK",e.CHANGE_TITLE="CHANGE_TITLE",e}(egret.Event);__reflect(TitleEvent.prototype,"TitleEvent");var Answers=function(){function t(){}return t}();__reflect(Answers.prototype,"Answers");var ShareType;!function(t){t[t.NORMAL=1]="NORMAL",t[t.USER_INFO=2]="USER_INFO",t[t.TRAIN_RESULT=3]="TRAIN_RESULT",t[t.PK_BATTLE=4]="PK_BATTLE",t[t.PK_KNOW=5]="PK_KNOW",t[t.PK_ANSWER=5]="PK_ANSWER",t[t.PK_INVITE_FRIEND=10]="PK_INVITE_FRIEND"}(ShareType||(ShareType={}));var Config=function(){function t(){}return t.APP_VERSION="0.0.1",t.HOST="http://127.0.0.1",t.PORT="8000",t.COLOR_GREY=4676717,t.COLOR_ORANGE=16018466,t.COLOR_YELLOW=11255569,t.COLOR_BLUE=1405127,t.DEBUG=!0,t}();__reflect(Config.prototype,"Config");var Room=function(){function t(){}return t}();__reflect(Room.prototype,"Room");var Subject=function(){function t(){}return t}();__reflect(Subject.prototype,"Subject");var TOptions=function(){function t(){}return t}();__reflect(TOptions.prototype,"TOptions");var User=function(){function t(){}return t}();__reflect(User.prototype,"User");var Http=function(){function t(){this.token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIwLCJpYXQiOjE1NTA1ODU4ODgsImV4cCI6MTU1MDY3MjI4OH0.XeDCRzT4WGo-JgUx13PeR76dcYGHw8IUL-hQmhA1P5k"}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.get=function(t,e){var i=(Util.getHost(),new egret.HttpRequest);i.responseType=egret.HttpResponseType.TEXT,i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.setRequestHeader("Accept","*/*");var n=localStorage.getItem("token");return n||(n=this.token),i.setRequestHeader("token",n),i.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this),t+="?"+Util.urlEncode(e,null),Util.log("url",t),i.open(t,egret.HttpMethod.GET),i.send(e),i.addEventListener(egret.Event.COMPLETE,this.onComplete,this),i},t.prototype.postTest=function(t,e,i){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.setRequestHeader("Accept","application/json");var a=localStorage.getItem("token");a||(a=this.token),n.setRequestHeader("token",a),n.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this),n.open(t,egret.HttpMethod.POST);var r=Util.urlEncode(e,null);return n.send(r),n.addEventListener(egret.Event.COMPLETE,this.onComplete(i),this),n},t.prototype.post=function(t,e,i){var n=Config.DEBUG?Util.getConfig("host"):Util.getHost();t=n+t;var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.setRequestHeader("Accept","application/json");var r=localStorage.getItem("token");r||(r=this.token),a.setRequestHeader("token",r),a.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onGetIOError,this),a.open(t,egret.HttpMethod.POST);var s=Util.urlEncode(e,null);return a.send(s),a.addEventListener(egret.Event.COMPLETE,this.onComplete(i),this),a},t.prototype.onComplete=function(t){return function(e){var i=e.currentTarget;console.log('"get data :',i.response);var n=JSON.parse(i.response);if(n.errno>10){if(1001==n.errno)return void(window.location.href=window.location.origin+window.location.pathname);var a=new AlertPanel("提示:"+n.errmsg);return void ViewManager.getInstance().getCurrentScene().addChild(a)}t&&t(n)}},t.prototype.onGetIOError=function(t){Util.log("onGetIOError",t)},t}();__reflect(Http.prototype,"Http");var Url=function(){function t(){}return t.HTTP_JSSDK_CONFIG="/game/index/jssdkconfig",t.HTTP_GAME_INIT="/game/api/index/init",t.HTTP_SIGN="/game/api/index/sign",t.HTTP_TEAM_RANK="/game/api/index/teamrank",t.HTTP_NOTICE="/game/api/index/notice",t.HTTP_BANNNER="/game/api/index/adbanner",t.HTTP_SHARE_UPLOAD="/game/api/index/doshare",t.HTTP_EQUIP_CATEGROY="/game/api/cms/category",t.HTTP_EQUIP_LIST="/game/api/cms/list",t.HTTP_EQUIP_SEARCH="/game/api/cms/search",t.HTTP_EQUIP_DETAIL="/game/api/cms/details",t.HTTP_USER_INFO="/game/api/user/info",t.HTTP_USER_BASE_INFO="/game/api/user/baseinfo",t.HTTP_TRAIN_START="/game/api/train/start",t.HTTP_TRAIN_SUBMIT="/game/api/train/submitquestion",t.HTTP_TRAIN_END="/game/api/train/end",t.HTTP_TRAIN_REPORT="/game/api/train/report",t.HTTP_FAVOR_SUBJECT="/game/api/train/collectquestion",t.HTTP_FAVOR_LIST="/game/api/collect/index",t.HTTP_TEAM_RANK_LIST="/game/api/rank/team",t.HTTP_PERSON_RANK_LIST="/game/api/rank/personal",t.HTTP_TEAM_PERSON_RANK_LIST="/game/api/rank/personalteam",t.HTTP_PK_SOCKET="http://xujiagui.vicp.cc:12631/proom",t}();__reflect(Url.prototype,"Url");var SocketX=function(){function t(){this.token="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOjIwLCJpYXQiOjE1NDgzMDU4NjEsImV4cCI6MTU0ODM5MjI2MX0.yYz1cwYudv5yMo_r90n6gYRW-wv5PJvFxrrHGYnZ2KE",this.isconnect=!1,this.lastMatch=0,this.callbacks={}}return t.prototype.close=function(){this.socket&&this.socket.connect&&(console.log(this.socket.connect),this.socket.close(),this.callbacks=[],this.isconnect=!1,this.socket=null)},t.prototype.connect=function(t){var e=this;if(void 0===t&&(t=PKTYPE.PERSON),console.log("调用connect接口"),!this.socket||!this.socket.connect){ViewManager.getInstance().showLoading("数据加载中...");var i=Config.DEBUG?"http://xujiagui.vicp.cc:12631":Util.getHost(),n=i+"/proom";t==PKTYPE.TEAM&&(n=i+"/troom");var a=connectSocket(n);console.log("开始连接websocket:",n),this.socket=a,a.on(NetEvent.ON_CONNENT,function(){e.isconnect=!0,console.log("链接成功！");var t=localStorage.getItem("token");Config.DEBUG&&(t=e.token),e.sendMsg(NetEvent.PK_OAUTH,{token:t})}),this.addEventListener(NetEvent.PK_OAUTH,function(t){ViewManager.getInstance().hideLoading()},this,"socket"),this.addEventListener(NetEvent.RE_CONNENT,function(){},this),this.addEventListener(NetEvent.DIS_CONNENT,function(){},this)}},t.prototype.connectPersonPk=function(){this.connect(PKTYPE.PERSON),this.addEventListener(NetEvent.PK_MATCH,this.onMatch,this),this.addEventListener(NetEvent.PK_END,this.pkEnd,this);var t=0;this.addEventListener(NetEvent.PK_START,function(e){var i=+new Date;if(i-t>2e3){DataManager.getInstance().setPkstart(e.data);var n=new BattleScene;ViewManager.getInstance().changeScene(n),t=i}},this)},t.prototype.connectTeamPk=function(){this.connect(PKTYPE.TEAM),this.socket.on(NetEvent.TEAM_JOIN_BROADCAST,function(t){})},t.prototype.pkEnd=function(t){var e=DataManager.getInstance().getPkData();if(!e.pkCode)return void console.log("已清除不需要跳转结果页面");if(t.data.tipsCode>0)if(t.data.tipsCode==InviteStatus.WATTING){var i=new PkInviteScene(InviteStatus.WATTING);ViewManager.getInstance().changeScene(i)}else{var i=new PkInviteScene(InviteStatus.PK_ERR_MSG,t.data.tipsMsg);ViewManager.getInstance().changeScene(i)}else{DataManager.getInstance().setPkResult(t.data);var n=DataManager.getInstance().getPkResult(),i=new PkResultScene(n,PkResultBackModel.BACK_PK);ViewManager.getInstance().changeScene(i),Http.getInstance().post(Url.HTTP_USER_BASE_INFO,"",function(t){DataManager.getInstance().updateUserInfo(t.data)})}},t.prototype.onMatch=function(t){console.log("onMatch",t);var e=+new Date;if(e-this.lastMatch>2e3){DataManager.getInstance().setPk(t.data);var i=new PkInviteScene(InviteStatus.MATCHEND);ViewManager.getInstance().changeScene(i),this.lastMatch=e}},t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.prototype.addEventListener=function(t,e,i,n){var a=this;void 0===i&&(i=null),void 0===n&&(n=null);var r=!1,s=t;n&&(s=n+"_"+t),this.callbacks[s]&&(r=!0),this.callbacks[t]=function(n){return console.log(t,n),n&&n.code>0?showAlertButton(n.msg,"返回竞技场目录",function(){ViewManager.getInstance().backByName("pklist")}):void(i?e.bind(i)(n):e(n))},r||(console.log("register listener event: "+t),this.socket.on(t,function(e){a.callbacks[t]&&a.callbacks[t](e)}))},t.prototype.sendMsg=function(t,e){console.log("sendMsg",{key:t,msg:e}),this.socket.emit(t,e)},t.prototype.removeEventListener=function(t){this.callbacks[t]=null},t}();__reflect(SocketX.prototype,"SocketX");var AnalysisScene=function(t){function e(e,i){var n=t.call(this)||this;return n.subject=e,n.title=i,n}return __extends(e,t),e.prototype.init=function(){t.prototype.setBackground.call(this);var e=80,i=Util.createBitmapByName("title_tmfx_png");i.y=e,i.x=(this.stage.width-509)/2,this.addChild(i),e+=200;var n=new egret.TextField;n.text="题目:"+this.subject.title,n.lineSpacing=10,n.width=650,n.y=e,n.x=34,n.bold=!0,n.textColor=4280932,this.addChild(n),e+=n.textHeight+50;var a=new egret.TextField;a.text=this.subject.content,a.width=650,a.x=(this.stage.stageWidth-650)/2,a.y=e,a.lineSpacing=10,a.textColor=4280932,this.addChild(a),e+=a.textHeight+100;var r=new XButton("返回题目");r.width=300,r.x=(this.stage.stageWidth-r.width)/2,r.y=this.stage.stageHeight-200,this.addChild(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.getInstance().back()},this)},e}(Scene);__reflect(AnalysisScene.prototype,"AnalysisScene");var AnswerScene=function(t){function e(e,i,n){void 0===i&&(i=1),void 0===n&&(n=null);var a=t.call(this)||this;return a.curIdx=1,a.errorStatus=!1,a.isNext=!1,a.errors=[],a.answers=e,a.type=i,a.levelData=n,a}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this),this.start=+new Date,2==this.type&&(this.nav="返回"),console.log("答题界面");var i=50,n=new TrainTitle(this.levelData.flag,this.levelData.name);if(n.y=i,n.x=(this.stage.width-212)/2-20,this.addChild(n),i+=180,1==this.type){var a=new eui.ProgressBar;a.maximum=10,a.minimum=1,a.width=600,a.height=22,this.addChild(a),a.y=i,a.x=this.stage.width/2-250,a.value=this.curIdx,this._progress=a;var r=new egret.Shape;r.graphics.beginFill(16711680,1),r.graphics.drawRoundRect(a.x,i,600,22,22,22),r.graphics.endFill(),this.addChild(r),a.thumb.mask=r}i+=50;var s=new egret.TextField;s.width=this.stage.width,s.text="Q"+this.curIdx,s.textColor=15952929,s.textAlign=egret.HorizontalAlign.CENTER,s.y=i,this.numberText=s,this.addChild(s),i+=60;var o=this.answers.questions[this.curIdx-1].qid,h=Util.getTrain(o);if(h){this.curSubject=h;var l=new eui.Group;l.height=5e3,l.y=10,this.topicGroup=l;var d=new Topic(h);this.topic=d,this.topicY=i,l.addChild(d);var c=new eui.Scroller;if(c.width=600,c.x=this.stage.stageWidth/2-300,c.height=this.stage.stageHeight-600,c.y=i,c.viewport=l,this.addChild(c),this.scroller=c,i=this.stage.stageHeight-250,1==this.type){var g=new XButton("加入收藏");g.y=i,g.width=273,g.x=(this.stage.stageWidth-600)/2;var u=this.answers.questions[this.curIdx-1].isCollect,p="favor_png";u&&(p="favor_fill_png");var v=Util.createBitmapByName(p);v.width=24,v.height=24,v.x=25,v.y=15,this.favorIcon=v,g.addChild(v),g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.answers.questions[e.curIdx-1].isCollect;if(t){var i=e.answers.questions[e.curIdx-1].qid;Http.getInstance().post(Url.HTTP_FAVOR_SUBJECT,{qid:i,type:2},function(t){p="favor_png",v.texture=RES.getRes(p),e.answers.questions[e.curIdx-1].isCollect=!1})}else{var i=e.answers.questions[e.curIdx-1].qid;Http.getInstance().post(Url.HTTP_FAVOR_SUBJECT,{qid:i,type:1},function(t){p="favor_fill_png",v.texture=RES.getRes(p),e.answers.questions[e.curIdx-1].isCollect=!0})}},this),this.addChild(g)}else{var g=new XButton("删除");g.y=i,g.width=273,g.x=(this.stage.stageWidth-600)/2,this.addChild(g),g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=e.answers.questions[e.curIdx-1].qid;Http.getInstance().post(Url.HTTP_FAVOR_SUBJECT,{qid:t,type:2},function(t){return e.answers.questions.splice(e.curIdx-1,1),0==e.answers.questions.length?void ViewManager.getInstance().back():(e.curIdx>=e.answers.questions.length&&(e.curIdx=e.answers.questions.length-1),void e.next())})},this)}var T=new XButton("提交");this.commitButton=T,T.y=i,T.x=this.stage.stageWidth/2+300-273,T.width=273,this.addChild(T),T.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=!1;if(e.curIdx==e.answers.questions.length&&(t=!0),t&&e.isNext)1==e.type?Http.getInstance().post(Url.HTTP_TRAIN_END,{lifecycleid:e.answers.lifecycleId},function(t){DataManager.getInstance().updateUserInfo(t.data.userBase);var i={result:t.data,errors:e.errors,levelData:e.levelData,lifecycleid:e.answers.lifecycleId},n=new ResultScene(i);ViewManager.getInstance().changeScene(n)}):ViewManager.getInstance().back();else if(e.isNext)e.next();else{console.log("提交");var i=e.topic.getSelect();if(!i){var n=new AlertPanel("请选择答案！");return void e.addChild(n)}var a=e.answers.questions[e.curIdx-1].qid,r=e.topic.getSelectResult(),s=+new Date,o=(s-e.start)/1e3,h={levelid:e.levelData.levelid,lifecycleid:e.answers.lifecycleId,qid:a,serialno:e.curIdx,qattrid:e.curSubject.qattrid,reply:i,iscorrect:r?1:0,useTime:o};Http.getInstance().post(Url.HTTP_TRAIN_SUBMIT,h,function(i){e.topic.setDisableSeleced(),e.analysisButton.visible=!0,r?(Util.playMusic("answer_ok_mp3"),e.topic.setSelectedStatus(TopicItem.STATUS_OK)):(e.topic.setSelectedStatus(TopicItem.STATUS_ERROR),Util.playMusic("answer_err3_mp3"),e.errors.push(a)),console.log("this.errors",e.errors);var n="下一题";t&&(n="结束"),T.labelDisplay.text=n,e.isNext=!0})}},this),i+=90;var f=Util.createBitmapByName("icon_tmfx_png");f.y=80,f.width=53,f.height=50,f.x=this.stage.stageWidth-120,f.touchEnabled=!0,this.addChild(f),this.analysisButton=f,f.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new AnalysisScene(e.curSubject,"题目分析");console.log(e.curSubject,"cur"),ViewManager.getInstance().changeScene(t)},this),1==this.type&&(f.visible=!1)}},e.prototype.next=function(){this.start=+new Date,this.commitButton.labelDisplay.text="提交",this.isNext=!1,this.curIdx=this.curIdx+1,this.numberText.text="Q"+this.curIdx,this._progress&&(this._progress.value=this.curIdx);var t=this.answers.questions[this.curIdx-1].qid,e=Util.getTrain(t);if(e){if(this.curSubject=e,this.favorIcon){var i=this.answers.questions[this.curIdx-1].isCollect,n="favor_png";i&&(n="favor_fill_png"),this.favorIcon.texture=RES.getRes(n)}this.topicGroup.removeChild(this.topic);var a=new Topic(e);this.topic=a,this.topicGroup.addChild(a),1==this.type&&(this.analysisButton.visible=!1),this.scroller.viewport.scrollV=0}},e}(Scene);__reflect(AnswerScene.prototype,"AnswerScene");var EquipList=function(t){function e(e){var i=t.call(this)||this;return i.config=e,i.nav="返回",i}return __extends(e,t),e.prototype.init=function(){t.prototype.setBackground.call(this);var e=Util.createBitmapByName("equip_top_"+this.config.type+"_png");e.width=this.stage.stageWidth,e.x=0,e.y=0,this.addChild(e),this.changeTypeList(this.config)},e.prototype.changeTypeList=function(t){var e=this;Http.getInstance().post(Url.HTTP_EQUIP_LIST,{catid:t.type},function(i){var n=new eui.Group;n.height=5e3,n.width=e.stage.stageWidth,e.addChild(n);var a=Util.createBitmapByName("equip_bg_"+t.type+"1_png");a.width=559,a.height=396,a.y=400,a.x=(e.stage.stageWidth-559)/2,e.addChild(a);var r=new egret.TextField;r.text=t.name,r.size=41,12==t.type?r.textColor=16018466:r.textColor=16777215,r.x=(e.stage.stageWidth-559)/2+40,r.y=420,e.addChild(r);var s=40;if(null!=i.data)for(var o=i.data,h=0,l=o;h<l.length;h++){var d=l[h],c=new EquipItem(d);c.y=s,s+=c.height+30,c.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onSeeItemDetail(d),e),n.addChild(c)}else{var g=new egret.TextField;g.text="暂无结果",g.width=e.stage.stageWidth,g.textAlign=egret.HorizontalAlign.CENTER,g.y=600,g.textColor=6778489,e.addChild(g)}n.height=s+400;var u=new eui.Scroller;u.width=530,u.height=300,u.y=470,u.x=60,u.viewport=n,e.addChild(u);var p=new egret.TextField;p.text="注：点击进入资讯具体内容页面",p.width=e.stage.stageWidth,p.textAlign=egret.HorizontalAlign.CENTER,p.y=e.stage.stageHeight-360,p.textColor=6778489,e.addChild(p)})},e.prototype.onSeeItemDetail=function(t){return function(e){t.url&&t.url.toLowerCase().trim().endsWith(".pdf")?window.location.href=t.url:Http.getInstance().post(Url.HTTP_EQUIP_DETAIL,{conid:t.contentId},function(t){var e=new Base64,i=e.decode(t.data.contentTxt);Util.onStopMusic(),showIFrame('<div style="margin-top:50px">'+i+"</div>","返回列表")})}},e}(Scene);__reflect(EquipList.prototype,"EquipList");var EquipmentScene=function(t){function e(){var e=t.call(this)||this;return e.configs=[{icon:"",bg:"",name:"搜索结果",type:0},{icon:"",bg:"equip_bg_1_png",name:"最新内容",type:11},{icon:"",bg:"equip_bg_2_png",name:"疾病档案",type:12},{icon:"",bg:"equip_bg_3_png",name:"产品资料",type:13},{icon:"",bg:"equip_bg_4_png",name:"竞品分析",type:14}],Util.setTitle("装备库"),e.nav="首页",e}return __extends(e,t),e.prototype.init=function(){t.prototype.setBackground.call(this),this.initList()},e.prototype.initList=function(){for(var t=ViewManager.getInstance().stage,e=230,i=(t.width-614)/2,n=function(t){if(0==t.type)return"continue";var n=new eui.Group;n.width=614,n.x=i,n.y=e,a.addChild(n);var r=Util.createBitmapByName(t.bg);n.addChild(r),e+=210,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Util.playMusic("model_select_mp3");var e=new EquipList(t);ViewManager.getInstance().changeScene(e)},a)},a=this,r=0,s=this.configs;r<s.length;r++){var o=s[r];n(o)}var h=new SearchInput("");h.x=(this.stage.stageWidth-614)/2,h.y=120,this.addChild(h)},e}(Scene);__reflect(EquipmentScene.prototype,"EquipmentScene");var EquipSearch=function(t){function e(e){var i=t.call(this)||this;return i.nav="返回",i.isnSpecialReturn=!0,i.keywords=e,i}return __extends(e,t),e.prototype.init=function(){t.prototype.setBackground.call(this);var e=Util.createBitmapByName("equip_top_0_png");e.width=this.stage.stageWidth,e.height=314,e.x=0,e.y=0,this.addChild(e),this.changeTypeList()},e.prototype.changeTypeList=function(){var t=this;Http.getInstance().post(Url.HTTP_EQUIP_SEARCH,{keywords:this.keywords},function(e){var i=80,n=new eui.Group;n.height=5e3,n.width=t.stage.stageWidth,t.addChild(n);var a=Util.createBitmapByName("equip_bg_21_png");a.width=559,a.height=396,a.y=400+i,a.x=(t.stage.stageWidth-559)/2,t.addChild(a);var r=new egret.TextField;r.text="搜索结果",r.textColor=16018466,r.size=41,r.x=(t.stage.stageWidth-559)/2+40,r.y=420+i,t.addChild(r);var s=40;if(null!=e.data)for(var o=e.data,h=0,l=o;h<l.length;h++){var d=l[h],c=new EquipItem(d);c.y=s,s+=c.height+30,c.addEventListener(egret.TouchEvent.TOUCH_TAP,t.onSeeItemDetail(d),t),n.addChild(c)}else{var g=new egret.TextField;g.text="暂无结果",g.width=t.stage.stageWidth,g.textAlign=egret.HorizontalAlign.CENTER,g.y=600,g.textColor=6778489,t.addChild(g)}n.height=s+400;var u=new eui.Scroller;u.width=530,u.height=300,u.y=470+i,u.x=60,u.viewport=n,t.addChild(u);var p=new egret.TextField;p.text="注：点击进入资讯具体内容页面",p.width=t.stage.stageWidth,p.textAlign=egret.HorizontalAlign.CENTER,p.y=t.stage.stageHeight-360,p.textColor=6778489,t.addChild(p);var v=new SearchInput(t.keywords);v.x=(t.stage.stageWidth-614)/2,v.y=380,t.addChild(v)})},e.prototype.onSeeItemDetail=function(t){return function(e){t.url&&t.url.toLowerCase().trim().endsWith(".pdf")?window.location.href=t.url:Http.getInstance().post(Url.HTTP_EQUIP_DETAIL,{conid:t.contentId},function(t){var e=new Base64,i=e.decode(t.data.contentTxt);Util.onStopMusic(),showIFrame('<div style="margin-top:50px">'+i+"</div>","返回列表")})}},e}(Scene);__reflect(EquipSearch.prototype,"EquipSearch");var EquipViewScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this),Util.setTitle("装备库"),this.nav="返回",Http.getInstance().post(Url.HTTP_EQUIP_DETAIL,{conid:this.contentId},function(t){var i=ViewManager.getInstance().stage,n=new eui.Group;n.y=60,n.width=i.width,e.addChild(n);var a=new egret.TextField;a.text=t.data.title,a.textColor=16018466,a.size=60,a.width=e.stage.stageWidth,a.textAlign=egret.HorizontalAlign.CENTER,a.y=100,n.addChild(a);var r=new Base64,s=r.decode(t.data.contentTxt);Util.onStopMusic();var o=new egret.TextField;o.textFlow=(new egret.HtmlTextParser).parser(s),o.textColor=6778489,o.width=e.stage.stageWidth,o.textAlign=egret.HorizontalAlign.CENTER,o.y=180,n.addChild(o)})},e}(Scene);__reflect(EquipViewScene.prototype,"EquipViewScene");var ErrorScene=function(t){function e(e){var i=t.call(this)||this;return i.curIdx=1,i.errors=e,i}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this);var i=80,n=Util.createBitmapByName("title_error_png");n.y=i,n.x=(this.stage.width-509)/2,this.addChild(n),i+=150;var a=new egret.TextField;a.text="本次共错误"+this.errors.length+"题",a.textColor=4280932,a.width=650,a.x=30,a.y=i,a.size=36,this.addChild(a),i+=60;var r=Util.getTrain(this.errors[this.curIdx-1]);if(r){var s=new egret.TextField;s.text=this.curIdx+"."+r.title,s.width=650,s.lineSpacing=10,s.x=34,s.y=i,s.textColor=Config.COLOR_GREY,this.title=s,this.addChild(s),i+=s.textHeight+50;var o=new egret.TextField;o.text=r.content,o.width=650,o.x=50,o.y=i,o.lineSpacing=10,o.textColor=Config.COLOR_GREY,this.addChild(o),this.content=o;var h=new XButton("下一题");h.width=this.stage.stageWidth/2-30,h.x=20,h.y=this.stage.stageHeight-250,this.addChild(h),h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.next()},this),this.nextButton=h;var l=new XButton("继续训练");l.width=this.stage.stageWidth/2-30,l.x=this.stage.stageWidth/2+10,l.y=this.stage.stageHeight-250,this.addChild(l),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.getInstance().back(3)},this),this.curIdx>=this.errors.length&&(this.nextButton.visible=!1)}},e.prototype.next=function(){if(this.curIdx!=this.errors.length){this.curIdx=this.curIdx+1;var t=Util.getTrain(this.errors[this.curIdx-1]);if(t){this.title.text=this.curIdx+"."+t.title,this.content.y=this.title.y+this.title.textHeight+50,this.content.text=t.content;for(var e="",i=0,n=t.options;i<n.length;i++){var a=n[i];if(a.flag==t.result){e=a.name;break}}this.curIdx>=this.errors.length&&(this.nextButton.visible=!1)}}},e}(Scene);__reflect(ErrorScene.prototype,"ErrorScene");var FavorScene=function(t){function e(e){var i=t.call(this)||this;return i.favors=e,i}return __extends(e,t),e.prototype.init=function(){t.prototype.setBackground.call(this),Util.setTitle("我的收藏"),this.nav="返回";for(var e=(ViewManager.getInstance().stage,100),i=0,n=this.favors;i<n.length;i++){var a=n[i],r=void 0;switch(a.attrVal){case"产品信息":r=Util.createBitmapByName("favor_title_cpxx_png");break;case"竞品分析":r=Util.createBitmapByName("favor_title_jpfx_png");break;case"市场策略":r=Util.createBitmapByName("favor_title_sccl_png");break;case"疾病信息":r=Util.createBitmapByName("favor_title_jbxx_png");break;case"作用机制":r=Util.createBitmapByName("favor_title_zyjz_png");break;default:r=Util.createBitmapByName("favor_title_lcyj_png")}r.x=(this.stage.width-596)/2,r.y=e,this.addChild(r),e+=160,r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.train(a),!0)}},e.prototype.train=function(t){var e=this;return function(){Http.getInstance().post(Url.HTTP_TRAIN_START,{type:2,tid:t.qattrId},function(i){if(i.data.length>0){var n=new Answers;n.lifecycleId=t.qattrId,n.questions=i.data;var a=t;a.name=t.attrVal,a.flag="";var r=new AnswerScene(n,2,a);ViewManager.getInstance().changeScene(r)}else{var s=new AlertPanel("提示:暂无收藏！");e.addChild(s)}})}},e}(Scene);__reflect(FavorScene.prototype,"FavorScene");var IndexScene=function(t){function e(){var e=t.call(this)||this;return e.name="home",e}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this,"bg_white_png"),console.log("加载首页"),Http.getInstance().post(Url.HTTP_USER_INFO,"",function(t){console.log("callback",t);var i=t.data;DataManager.getInstance().setUser(i),Util.setTitle("艾乐明-"+i.teamName);var n=new UserInfo(UserType.home);n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new UserScene;ViewManager.getInstance().changeScene(t)},e),n.x=0,n.y=126,e.userView=n,e.addChild(n),e.createLayout()})},e.prototype.createLayout=function(){var t=this,e=ViewManager.getInstance().stage;this.initActivityImg();for(var i=e.width/2+15,n=[{name:"",icon:"",bg:"model_bg_1_png",x:42,y:650,key:1},{name:"",icon:"",bg:"model_bg_2_png",x:i,y:650,key:2},{name:"",icon:"",bg:"model_bg_3_png",x:42,y:890,key:3},{name:"",icon:"",bg:"model_bg_4_png",x:i,y:890,key:4}],a=e.width/2-40,r=Util.grayFliter(),s=0,o=n;s<o.length;s++){var h=o[s],l=new eui.Group;l.width=a,l.x=h.x,l.y=h.y,l.height=204,this.addChild(l);var d=Util.createBitmapByName(h.bg);d.width=315,d.height=204,3==h.key&&(d.filters=[r]),l.addChild(d),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouch(h.key),this),l.touchEnabled=!0;var c=Util.createBitmapByName(h.icon);c.x=50,c.y=30,l.addChild(c);var g=new egret.TextField;g.text=h.name,g.size=40,g.x=180,g.y=80,l.addChild(g)}var u=Util.getConfig("bandge");console.log("config",u),Http.getInstance().post(Url.HTTP_NOTICE,{},function(i){var n=new Notice(i.data),a=e.height-80;n.y=a,t.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("跳转详情页");var t=new RuleScene;ViewManager.getInstance().changeScene(t)},t)}),Http.getInstance().post(Url.HTTP_GAME_INIT,"",function(e){e.data.isNeedSign?(t.signFalg=!1,Http.getInstance().post(Url.HTTP_SIGN,{},function(e){console.log("data",e),DataManager.getInstance().setSign(e.data),Http.getInstance().post(Url.HTTP_USER_BASE_INFO,"",function(e){DataManager.getInstance().updateUserInfo(e.data),t.userView.refresh()});var i=new Sign;t.addChildAt(i,100),t.sign=i,i.addEventListener(eui.UIEvent.CLOSING,function(){t.sign=null,t.signFalg||t.showRanker()},t);var n=new egret.Timer(5e3,1);n.addEventListener(egret.TimerEvent.TIMER,function(){t.signFalg=!0,t.sign&&(t.removeChild(t.sign),t.showRanker())},t),n.start()})):t.showRanker()});var p=window.location.href.split("#")[0];Http.getInstance().post(Url.HTTP_JSSDK_CONFIG,{showurl:p},function(t){configSdk(t.data),setTimeout(function(){Util.registerShare(null,ShareType.NORMAL)},1e3)})},e.prototype.showRanker=function(){var t=this;DataManager.getInstance().hasShowRanker||Http.getInstance().post(Url.HTTP_TEAM_RANK_LIST,{page:1,size:3},function(e){var i=new RankerPanel(e.data);t.ranker=i,t.addChildAt(i,99),DataManager.getInstance().hasShowRanker=!0;var n=new egret.Timer(1e4,1);i.addEventListener(eui.UIEvent.CLOSING,function(){t.ranker=null},t),n.addEventListener(egret.TimerEvent.TIMER,function(){t.ranker&&t.removeChild(i)},t),n.start()})},e.prototype.onTouch=function(t){var e=this;return function(i){switch(console.log("touch",t,i),Util.playMusic("model_select_mp3"),t){case 1:var n=new TrainScene;ViewManager.getInstance().changeScene(n);break;case 2:var a=new RankScene;ViewManager.getInstance().changeScene(a);break;case 3:var r=new AlertPanel("该功能暂未开放");e.addChild(r);break;case 4:var s=new EquipmentScene;ViewManager.getInstance().changeScene(s)}}},e.prototype.initActivityImg=function(){var t=ViewManager.getInstance().stage,e=Util.createBitmapByName("top_ad_png");e.width=t.stageWidth,e.height=106,this.addChild(e)},e.prototype.updateScene=function(){this.userView.refresh(),Util.setTitle("艾乐明-"+DataManager.getInstance().getUser().teamName)},e.prototype.onLoadComplete=function(t){this._bitmapText=new egret.BitmapText,this._bitmapText.font=t,this._bitmapText.x=50,this._bitmapText.y=200,this._bitmapText.text="每日战队排行表彰 训练场",this.addChild(this._bitmapText)},e.prototype.onButtonClick=function(){console.log("点击按钮");var t=new TestScene;ViewManager.getInstance().changeScene(t)},e}(Scene);__reflect(IndexScene.prototype,"IndexScene");var RankScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.currentIdx=1,e.teamRank=[],e.personRank=[],e.size=20,e.teamPage=1,e.personPage=1,e}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this),this.nav="首页",this.initTitle(),Http.getInstance().post(Url.HTTP_PERSON_RANK_LIST,{page:this.personPage,size:this.size},function(t){e.personRank=t.data,t.data.length==e.size?e.personPage+=1:e.personPage=-1,e.initRanker()}),Http.getInstance().post(Url.HTTP_TEAM_RANK_LIST,{page:this.teamPage,size:this.size},function(t){t.data.length==e.size?e.teamPage+=1:e.teamPage=-1,e.teamRank=t.data})},e.prototype.loadMoreData=function(){var t=this;1==this.currentIdx&&this.personPage>0&&Http.getInstance().post(Url.HTTP_PERSON_RANK_LIST,{page:this.personPage,size:this.size},function(e){e.data.length==t.size?t.personPage+=1:t.personPage=-1,t.personRank.concat(e.data);for(var i=(t.stage.stageWidth-555)/2,n=t.scrollView.viewport.contentHeight,a=0,r=e.data;a<r.length;a++){var s=r[a];s.type=t.currentIdx;var o=new RankItemTemplate(s);o.x=i,o.y=n,n+=210,t.groupView.addChild(o)
}}),2==this.currentIdx&&this.teamPage>0&&Http.getInstance().post(Url.HTTP_TEAM_RANK_LIST,{page:this.teamPage,size:this.size},function(e){e.data.length==t.size?t.teamPage+=1:t.teamPage=-1,t.teamRank.concat(e.data);for(var i=(t.stage.stageWidth-555)/2,n=t.scrollView.viewport.contentHeight,a=0,r=e.data;a<r.length;a++){var s=r[a];s.type=t.currentIdx;var o=new RankItemTeamTemplate(s,!0);o.x=i,o.y=n,n+=210,t.groupView.addChild(o)}})},e.prototype.initRanker=function(){var t=this,e=(this.stage.stageWidth/2-315,new eui.Group);this.groupView=e,e.width=630;var i=this.personRank;2==this.currentIdx&&(i=this.teamRank);for(var n=10,a=0,r=i;a<r.length;a++){var s=r[a],o=void 0;o=1==this.currentIdx?new RankItemTemplate(s):new RankItemTeamTemplate(s,!0),o.x=(this.stage.stageWidth-555)/2,o.y=n,n+=210,e.addChild(o)}var h=new eui.Scroller;h.width=this.stage.stageWidth,h.height=700,h.y=280,h.viewport=e,this.addChild(h),this.scrollView=h,h.addEventListener(eui.UIEvent.CHANGE_END,function(){h.viewport.scrollV+800>=h.viewport.contentHeight&&t.loadMoreData()},this);var l=Util.createBitmapByName("icon_down_png");l.anchorOffsetX=66,l.y=1050,l.x=this.stage.stageWidth/2,this.addChild(l),l.touchEnabled=!0,l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.viewport.scrollV+=200},this)},e.prototype.onChangeType=function(t){if(this.currentIdx!=t){var e="rank_title_unselect_png",i="rank_title_select_png";1==t?(e="rank_title_select_png",i="rank_title_unselect_png",this.selfText.textColor=48854,this.teamText.textColor=16777215):(this.selfText.textColor=16777215,this.teamText.textColor=48854),this.teamTitleBg.texture=RES.getRes(i),this.selfTitleBg.texture=RES.getRes(e),this.groupView.removeChildren(),this.scrollView.stopAnimation(),this.scrollView.viewport.scrollV=0;var n=(this.stage.stageWidth/2-315,0);this.currentIdx=t;var a=this.personRank;2==t&&(a=this.teamRank);for(var r=0,s=a;r<s.length;r++){var o=s[r],h=void 0;h=1==this.currentIdx?new RankItemTemplate(o):new RankItemTeamTemplate(o,!0),h.x=(this.stage.stageWidth-555)/2,h.y=n,n+=210,this.groupView.addChild(h)}}},e.prototype.initTitle=function(){var t=this,e=Util.createBitmapByName("blue_small_bg_png");e.width=696,e.height=1080,e.x=(this.stage.width-696)/2,e.y=80,this.addChild(e);var i="rank_title_select_png",n="rank_title_unselect_png",a=160,r=251,s=65,o=this.stage.stageWidth/2-r;2==this.currentIdx&&(i="rank_title_unselect_png",n="rank_title_select_png");var h=Util.createBitmapByName(i);this.addChild(h),h.x=o,h.y=a,h.width=240,h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onChangeType(1)},this),this.selfTitleBg=h,this.selfText=new egret.TextField,this.selfText.text="个人月排名",this.selfText.width=r,this.selfText.height=s,this.selfText.verticalAlign=egret.VerticalAlign.MIDDLE,this.selfText.textAlign=egret.HorizontalAlign.LEFT,this.selfText.textColor=48854,this.selfText.x=o+20,this.selfText.y=a,this.addChild(this.selfText);var l=Util.createBitmapByName(n);l.x=this.stage.stageWidth/2,l.y=a,this.addChild(l),l.touchEnabled=!0,l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onChangeType(2)},this),this.teamTitleBg=l,this.teamText=new egret.TextField,this.teamText.text="战队月排名",this.teamText.width=r,this.teamText.height=s,this.teamText.verticalAlign=egret.VerticalAlign.MIDDLE,this.teamText.textAlign=egret.HorizontalAlign.LEFT,this.teamText.x=this.stage.stageWidth/2+20,this.teamText.y=a,this.addChild(this.teamText)},e}(Scene);__reflect(RankScene.prototype,"RankScene");var ResultScene=function(t){function e(e){var i=t.call(this)||this;return i.result=e.result,i.errors=e.errors,i.levelData=e.levelData,i.lifecycleid=e.lifecycleid,i}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this),this.nav="首页";var i=50,n=new TrainTitle(this.levelData.flag,this.levelData.name);n.y=i,n.x=(this.stage.stageWidth-212)/2-20,this.addChild(n);var a,r;this.result.isPass?(a=Util.createBitmapByName("train_success_png"),r="pass_mp3"):(a=Util.createBitmapByName("train_fail_png"),r="nopass_mp3"),a.width=671,a.height=337,a.x=(this.stage.stageWidth-671)/2,a.y=250,this.addChild(a),Util.playMusic(r),Http.getInstance().post(Url.HTTP_USER_BASE_INFO,"",function(t){DataManager.getInstance().updateUserInfo(t.data)});var s=Math.round(100*this.result.correct/(this.result.correct+this.result.error)),o=this.createScoreView("正确率:"+s+"%");if(o.y=a.y+a.height+100,this.addChild(o),this.result.addScore){var h=this.createScoreView("积分:+"+this.result.addScore);h.y=o.y+80,this.addChild(h)}i=this.stage.stageHeight-350;var l=new XButton("+ 继续练习");if(l.width=273,l.y=i,l.x=(this.stage.stageWidth-671)/2,this.addChild(l),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=DataManager.getInstance().getCurrentBandge(),e=new TrainLevelScene(t);ViewManager.getInstance().changeScene(e)},this),this.result.error>0){var d=new XButton("错题分析");d.width=273,d.y=i,d.x=this.stage.stageWidth/2+335.5-273,this.addChild(d),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new ErrorScene(e.errors);ViewManager.getInstance().changeScene(t)},this)}var c=new XButton("炫耀成绩");c.width=273,this.result.error>0?(c.y=i+90,c.x=(this.stage.stageWidth/2+30)/2):(c.y=i,c.x=this.stage.stageWidth/2+10),this.addChild(c),c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Http.getInstance().post(Url.HTTP_TRAIN_REPORT,{lifecircle:e.lifecycleid},function(t){DataManager.getInstance().updateUserInfo(t.data.userBase),DataManager.getInstance().updateUser("trainResult",t.data.trainResult);var e=new ScoreScene;ViewManager.getInstance().changeScene(e)})},this)},e.prototype.createScoreView=function(t){var e=new eui.Group;e.width=630,e.height=90,e.x=(this.stage.stageWidth-630)/2;var i=new egret.TextField;i.text=t,i.textColor=16018466,i.width=275,i.textAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,i.x=165,i.y=5,i.size=40,e.addChild(i);var n=Util.createBitmapByName("line_1_png");return n.x=i.x,n.y=i.y+i.height,e.addChild(n),e},e.prototype.onBack=function(){ViewManager.getInstance().jumpHome()},e}(Scene);__reflect(ResultScene.prototype,"ResultScene");var RuleScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.setBackground.call(this),this.nav="返回",this.navColor=16777215;var e=ViewManager.getInstance().stage,i=Util.createBitmapByName("mask_png");i.y=0,i.x=0,i.width=e.stageWidth,i.height=e.stageHeight,this.addChild(i);var n=Util.createBitmapByName("rule_title_png");n.width=602,n.y=120,n.x=(e.stageWidth-602)/2,this.addChild(n);var a=Util.createBitmapByName("small_grey_bg_png");a.y=240,a.x=(e.stageWidth-602)/2-30,this.addChild(a);var r=new eui.Group;r.width=this.stage.stageWidth;var s=new RuleText;r.addChild(s);var o=new eui.Scroller;o.width=700,o.height=this.stage.stageHeight-620,o.y=300,o.anchorOffsetX=375,o.x=this.stage.stageWidth/2+10,o.viewport=r,this.addChild(o)},e}(Scene);__reflect(RuleScene.prototype,"RuleScene");var RuleText=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=(ViewManager.getInstance().stage,new egret.TextField);t.width=600,t.x=65,t.textColor=13225940,t.size=28,t.lineSpacing=20,t.fontFamily="微软雅黑",t.textFlow=[{text:" \n"},{text:" 一. 基本规则 \n",style:{size:35,bold:!0}},{text:"1. 排名规则 \n",style:{size:30,bold:!0}},{text:"a.个人排名:根据个人达标率进行先后排名，当达标率相同时，按照个人积分排名，积分高的排名靠前 \n"},{text:"b.团队排名:根据团队达标率进行先后排名，当达标率相同时，按照团队积分排名，积分高的排名靠前  \n\n"},{text:"2. 如何获得积分 \n",style:{size:30,bold:!0}},{text:"a.每日签到一次,获得5积分,积分获得上限每日1次\n"},{text:"b.在训练场中完成一关获得20积分，积分获得上限为每日1次\n"},{text:"c.所有积分在每月最后一天清零\n"},{text:"3. 如何获得等级称号 \n",style:{size:30,bold:!0}},{text:"a.完成三大训练场“艾”“乐”“明”中各20个关卡，可分别点亮“艾”“乐”“明”三个徽章，并解锁下一个训练场\n"},{text:"b.在每个训练场中，每通过一个关卡，将解锁下一个关卡，并获得相应的等级称号\n"},{text:"\n"},{text:"\n"},{text:"二.  训练场规则 \n",style:{size:35,bold:!0}},{text:"a.每一关卡含10道随机习题，完成10题并点击提交后，可查看本次训练的正确率\n"},{text:"b.正确率达到100%，才可通关并解锁下一关。要知道，训练可没有捷径能走！\n"},{text:"c.答题过程中可收藏题目，在“训练场-我的收藏”中可查看\n"},{text:"\n"},{text:"\n"},{text:"**本平台规则由艾乐明品牌组制定，并拥有最终解释权\n"}],this.addChild(t),this.height=t.textHeight},e}(eui.Group);__reflect(RuleText.prototype,"RuleText");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function n(n){e.call(i,n,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?n(a):RES.getResAsync(t,n,this)}else RES.getResByUrl(t,n,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var ScoreScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this),this.nav="首页";var i=50,n=Util.createBitmapByName("title_report_png");n.y=i,n.x=(this.stage.width-370)/2,this.addChild(n);var a=new UserInfo(UserType.score);a.x=0,a.y=180,this.addChild(a);var r=330,s=(this.stage.stageWidth-700)/2;i=this.stage.stageHeight-200;var o=new XButton("保存图片");o.y=i,o.width=r,o.x=s,this.addChild(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new AlertPanel("提示:请自行截图保存图片");e.addChild(t)},this),s+=r+40;var h=new XButton("分享");h.y=i,h.width=r,h.x=s,this.addChild(h),h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new SharePanel;e.addChild(t)},this),this.registerShare()},e.prototype.registerShare=function(){var t=DataManager.getInstance().getUser(),e=t.trainResult,i=Math.round(100*e.trainCorrectCount/e.trainTotalCount);Util.registerShare(this.shareGroup,ShareType.TRAIN_RESULT,t.nickName,i+"%")},e.prototype.onBack=function(){ViewManager.getInstance().jumpHome()},e}(Scene);__reflect(ScoreScene.prototype,"ScoreScene");var TeamRankScene=function(t){function e(e){var i=t.call(this)||this;return i.personRank=[],i.size=20,i.personPage=1,i.teamid=e,i}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this),this.nav="返回";var i=Util.createBitmapByName("blue_small_bg_png");i.width=696,i.height=1080,i.x=(this.stage.width-696)/2,i.y=80,this.addChild(i);var n=new CTitle("队内月排行");n.y=160,n.x=(this.stage.stageWidth-283)/2,this.addChild(n),Http.getInstance().post(Url.HTTP_TEAM_PERSON_RANK_LIST,{tid:this.teamid,page:this.personPage,size:this.size},function(t){e.personRank=t.data,t.data.length==e.size?e.personPage+=1:e.personPage=-1,e.initRanker()})},e.prototype.initRanker=function(){var t=this,e=this.stage.stageWidth/2-315,i=Util.createBitmapByName("user_border_png");i.width=630,i.height=830,i.x=e,i.y=250,this.addChild(i);var n=new eui.Group;this.groupView=n,n.width=630;for(var a=this.personRank,r=10,s=0,o=a;s<o.length;s++){var h=o[s];h.type=1;var l=new RankItemTemplate(h);l.x=(this.stage.stageWidth-555)/2,l.y=r,n.addChild(l),r+=210}var d=new eui.Scroller;d.width=this.stage.stageWidth,d.height=700,d.y=280,d.viewport=n,this.addChild(d),this.scrollView=d,d.addEventListener(eui.UIEvent.CHANGE_END,function(){d.viewport.scrollV+800>=d.viewport.contentHeight&&t.loadMoreData()},this);var c=Util.createBitmapByName("icon_down_png");c.anchorOffsetX=66,c.y=1050,c.x=this.stage.stageWidth/2,this.addChild(c),c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.viewport.scrollV+=200},this)},e.prototype.loadMoreData=function(){var t=this;this.personPage>0&&Http.getInstance().post(Url.HTTP_TEAM_PERSON_RANK_LIST,{tid:this.teamid,page:this.personPage,size:this.size},function(e){e.data.length==t.size?t.personPage+=1:t.personPage=-1,t.personRank.concat(e.data);for(var i=t.stage.stageWidth/2-315,n=t.scrollView.viewport.contentHeight,a=0,r=e.data;a<r.length;a++){var s=r[a];s.type=1;var o=new RankItem(s,500);o.x=i+65,o.y=n,t.groupView.addChild(o),n+=o.height+10}})},e}(Scene);__reflect(TeamRankScene.prototype,"TeamRankScene");var TestScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){var t=[{name:"欣百达",rate:.5},{name:"临床研究",rate:.6},{name:"竞品",rate:.4},{name:"CLBP",rate:.8},{name:"OA",rate:.5},{name:"疼痛",rate:.7}],e=new Radar(t,300,300);e.x=100,e.y=500,this.addChild(e);var i=new eui.Button;i.label="返回",i.horizontalCenter=0,i.verticalCenter=0,this.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onButtonClick,this)},e.prototype.onButtonClick=function(){console.log("点击按钮"),ViewManager.getInstance().back()},e}(Scene);__reflect(TestScene.prototype,"TestScene");var TrainLevelScene=function(t){function e(e){var i=t.call(this)||this;return i.levelViews=[],i.POINTS=[{x:120,y:85},{x:470,y:385},{x:120,y:685},{x:470,y:985},{x:120,y:1285},{x:470,y:1585},{x:120,y:1885},{x:470,y:2185},{x:120,y:2485},{x:470,y:2785},{x:120,y:3085},{x:470,y:3385},{x:120,y:3685},{x:470,y:3985},{x:120,y:4285},{x:470,y:4585},{x:120,y:4885},{x:470,y:5185},{x:120,y:5485},{x:470,y:5785}],i.bandge=e,i}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this),this.currentLevel=DataManager.getInstance().getUser().lv,this.nav="返回";var i=ViewManager.getInstance().stage,n=new eui.Group;n.height=5e3,n.width=i.stageWidth,this.addChild(n);var a=new eui.Group;a.width=424,a.height=6100,a.x=163,this.lineGroup=a,n.addChild(a);var r=0,s=0,o=function(t){var i=h.POINTS[t];r=i.y;var a=h.bandge.levels[t];h.currentLevel<a.key?a.status=LevelStatus.No:h.currentLevel==a.key?a.status=LevelStatus.Cur:a.status=LevelStatus.Pass;var o=new LevelView(a);o.x=i.x,o.y=i.y,h.levelViews[t]=o,n.addChild(o),o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Util.playMusic("model_select_mp3"),e.currentLevel>=a.key)Http.getInstance().post(Url.HTTP_TRAIN_START,{type:1,tid:o.levelData.levelid},function(t){if(t.data.questions.length>0){var i=new Answers;i.lifecycleId=t.data.lifecycleId,i.questions=t.data.questions;var n=new AnswerScene(i,1,o.levelData);ViewManager.getInstance().changeScene(n)}else{var a=new AlertPanel("提示:请先通关前面的关卡后再来哦");e.addChild(a)}});else{var t=new AlertPanel("提示:请先通关前面的关卡后再来哦");e.addChild(t)}},h);var l=void 0;19>s&&(s%2==1?(l=Util.createBitmapByName("train_line_left_png"),l.x=i.x+110-305,l.y=i.y+135):(l=Util.createBitmapByName("train_line_right_png"),l.x=i.x+170,l.y=i.y+135),n.addChild(l)),s++},h=this;for(var l in this.POINTS)o(l);var d=new eui.Scroller;d.width=this.stage.stageWidth,d.height=this.stage.stageHeight-200,d.y=100,d.viewport=n,this.addChild(d)},e.prototype.updateScene=function(){this.removeChildren(),this.init(),this.crteateNavButton("返回")},e}(Scene);__reflect(TrainLevelScene.prototype,"TrainLevelScene");var TrainScene=function(t){function e(){var e=t.call(this)||this;return e.bandge=Util.getConfig("bandge"),e.nav="首页",Util.setTitle("训练场"),e}return __extends(e,t),e.prototype.init=function(){var e=this;t.prototype.setBackground.call(this,"bg_train_png");var i=ViewManager.getInstance().stage,n=new eui.Group;n.y=60,n.width=i.width,this.addChild(n),this.list=n;for(var a=50,r=(i.width-708)/2,s=DataManager.getInstance().getUser(),o=Util.grayFliter(),h=0,l=this.bandge;h<l.length;h++){var d=l[h],c=Util.createBitmapByName("equip_bg_png");c.x=r,c.y=a,this.list.addChild(c);var g=Util.createBitmapByName(d.fontImg);g.width=162,g.x=(i.width-138)/2,g.y=a,this.list.addChild(g),a+=270,c.touchEnabled=!0,d.start>s.lv?(c.filters=[o],g.filters=[o],c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Util.playMusic("model_select_mp3");var t=new AlertPanel("提示:请先通关前面的关卡后再来哦！");e.addChild(t)},this)):c.addEventListener(egret.TouchEvent.TOUCH_TAP,this.initLevelView(d),this)}var u=Util.createBitmapByName("myfavor_png");u.width=365,u.y=i.stageHeight-250,u.x=(i.width-365)/2,this.addChild(u),u.touchEnabled=!0,u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;Http.getInstance().post(Url.HTTP_FAVOR_LIST,"",function(e){if(e.data&&e.data.length>0){var i=new FavorScene(e.data);ViewManager.getInstance().changeScene(i)}else{var n=new AlertPanel("提示:暂无收藏！");t.addChild(n)}})},this)},e.prototype.initLevelView=function(t){return this.selected=t,function(){Util.playMusic("model_select_mp3"),DataManager.getInstance().setCurrentBandge(t);var e=new TrainLevelScene(t);ViewManager.getInstance().changeScene(e)}},e}(Scene);__reflect(TrainScene.prototype,"TrainScene");var UserScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){t.prototype.setBackground.call(this,"bg_white_png"),Util.setTitle("个人中心"),this.nav="首页";var e=new eui.Group;this.addChild(e),this.shareGroup=e;var i=ViewManager.getInstance().stage,n=new UserInfo(UserType.home);n.x=0,n.y=80,e.addChild(n);var a=DataManager.getInstance().getUser(),r=new RadarPanel(a.attrName,this);r.x=(this.stage.stageWidth-660)/2,r.y=590,e.addChild(r);var s=DataManager.getInstance().getUser().attrInfo,o=new Radar(s,300,300);o.x=i.width/2-150,o.y=700,e.addChild(o),this.registerShare()},e.prototype.registerShare=function(){var t=DataManager.getInstance().getUser();Util.registerShare(this.shareGroup,ShareType.USER_INFO,t.nickName,t.lvName)},e}(Scene);__reflect(UserScene.prototype,"UserScene");var BattleScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.index=0,e.TIMER=15,e}return __extends(e,t),e.prototype.initData=function(){var t=this;this.timeNumber=this.TIMER,SocketX.getInstance().addEventListener(NetEvent.PK_PROGRESS,this.updateProgress,this),SocketX.getInstance().addEventListener(NetEvent.PK_ANSWER,function(t){if(t.data.tipsCode==InviteStatus.PK_END_WAIT){var e=new PkInviteScene(InviteStatus.PK_END_WAIT);ViewManager.getInstance().changeScene(e)}},this);var e=new egret.Timer(1e3,this.TIMER+10);this.timer=e,e.addEventListener(egret.TimerEvent.TIMER,function(){if(t.timeNumber--,t.timeText.text=t.timeNumber,0==t.timeNumber){if(e.stop(),!t.canSubmit)return;t.submitNull()}},this),e.start()},e.prototype.init=function(){var t=this;this.width=750,this.anchorOffsetX=375,this.x=this.stage.stageWidth/2,this.initData();var e=DataManager.getInstance().getUser();this.userInfo=e;var i=new PkUser(e);i.y=100,this.addChild(i);var n=DataManager.getInstance().getPkData();this.pkData=n;var a=new PkUser(n.pkUser,"right");a.y=100,a.anchorOffsetX=243,a.x=this.stage.stageWidth,this.addChild(a);var r=Util.createBitmapByName("pk_vs_png");r.anchorOffsetX=128,r.anchorOffsetY=86,r.x=375,r.y=240,this.addChild(r);var s=new VProgress(1,this.pkData.questions.length);s.x=30,s.y=500,this.addChild(s),s.setRate(0),this.selfProgress=s;var o=new VProgress(2,this.pkData.questions.length);o.x=690,o.y=500,this.addChild(o),o.setRate(0),this.otherProgress=o,4==n.type&&n.pkUser&&this.otherProgress.setRate(this.pkData.questions.length);var h=new egret.TextField;h.text=""+this.TIMER,h.width=100,h.height=100,h.anchorOffsetX=50,h.anchorOffsetY=50,h.y=240,h.x=375,h.textAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.size=40,this.addChild(h),this.timeText=h;var l=this.pkData.questions[this.index].id,d=Util.getTrain(l);if(d){var c=new eui.Group;c.width=600;var g=new egret.TextField;g.width=600,g.text="Q"+(this.index+1),g.textColor=Config.COLOR_YELLOW,g.textAlign=egret.HorizontalAlign.CENTER,c.addChild(g),this.numberText=g;var u=new Topic(d);this.topic=u,u.y=50,c.addChild(u),this.topicGroup=c;var p=new eui.Scroller;p.width=600,p.height=this.stage.stageHeight-650,p.y=450,p.x=75,p.viewport=c,this.scroller=p,this.addChild(p),this.canSubmit=!0;var v=new XButton("提交");v.width=450,v.x=150,this.submitButton=v,v.y=this.stage.stageHeight-150,this.addChild(v),v.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.canSubmit){var e=t.topic.getSelect();if(!e){var i=new AlertPanel("请选择答案！");return void t.addChild(i)}var n=t.topic.getSelectResult();t.submitResult(n,e),t.topic.setDisableSeleced()}},this)}},e.prototype.submitResult=function(t,e){var i=this;this.canSubmit=!1;var n=this.topic.getQAttrId(),a=this.TIMER-this.timeNumber,r={userId:this.userInfo.userId,pkCode:this.pkData.pkCode,type:this.pkData.pkType,qid:this.pkData.questions[this.index].id,qattrId:n,reply:e,isCorrect:t?1:0,useTime:a};SocketX.getInstance().sendMsg(NetEvent.PK_ANSWER,r),t?(Util.playMusic("answer_ok_mp3"),this.topic.setSelectedStatus(TopicItem.STATUS_OK)):(this.topic.setSelectedStatus(TopicItem.STATUS_ERROR),Util.playMusic("answer_err3_mp3")),this.submitButton.visible=!1,this.selfProgress.setRate(this.index+1),this.index<this.pkData.questions.length-1&&setTimeout(function(){i.next()},3e3)},e.prototype.submitNull=function(){this.canSubmit=!1;var t=this.topic.getQAttrId(),e=this.TIMER-this.timeNumber,i={userId:this.userInfo.userId,pkCode:this.pkData.pkCode,type:this.pkData.pkType,qid:this.pkData.questions[this.index].id,qattrId:t,reply:"null",isCorrect:0,useTime:e};SocketX.getInstance().sendMsg(NetEvent.PK_ANSWER,i),Util.playMusic("answer_err3_mp3"),this.selfProgress.setRate(this.index+1),this.index<this.pkData.questions.length-1&&this.next()},e.prototype.next=function(){this.canSubmit=!0,this.submitButton.visible=!0,this.index++,this.numberText.text="Q"+(this.index+1),this.timeNumber=this.TIMER,this.timer.reset(),this.timeText.text=this.timeNumber,this.timer.start(),this.topicGroup.removeChild(this.topic);var t=this.pkData.questions[this.index].id,e=Util.getTrain(t);if(e){var i=new Topic(e);i.y=50,this.topic=i,this.topicGroup.addChild(i),this.scroller.viewport.scrollV=0}},e.prototype.updateProgress=function(t){this.otherProgress.setRate(t.data.seriaNo)},e}(Scene);__reflect(BattleScene.prototype,"BattleScene");var PkInviteScene=function(t){function e(e,i){void 0===i&&(i=null);var n=t.call(this)||this;return n.type=e,n.msg=i,n}return __extends(e,t),e.prototype.init=function(){this.width=750,this.anchorOffsetX=375,this.x=this.stage.stageWidth/2;var t=DataManager.getInstance().getUser();console.log(t,"useringo");var e=new PkUser(t);e.y=100,this.addChild(e);var i=DataManager.getInstance().getPkData(),n=new PkUser(i?i.pkUser:null,"right");n.y=100,n.anchorOffsetX=243,n.x=750,this.addChild(n);var a=Util.createBitmapByName("pk_vs_png");a.anchorOffsetX=128,a.anchorOffsetY=86,a.width=255,a.height=172,a.x=375,a.y=240,this.addChild(a);var r=new egret.TextField;switch(this.type){case InviteStatus.INVITING:case InviteStatus.NOACCEPT:r.text="等待对手加入";break;default:r.text="VS"}r.width=300,r.height=100,r.anchorOffsetX=150,r.anchorOffsetY=50,r.y=240,r.x=375,r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.size=34,this.addChild(r);var s=new eui.Group;switch(this.width=750,s.y=600,this.buttonGroup=s,this.addChild(s),this.type){case InviteStatus.INVITING:this.inviting();break;case InviteStatus.NOACCEPT:this.noAccept();break;case InviteStatus.WATTING:this.waiting();break;case InviteStatus.ACCEPTED:this.accepted();break;case InviteStatus.MATCHEND:this.matchEnd();break;case InviteStatus.OBSERVE:this.observe();break;case InviteStatus.INVALID:this.invalid();break;case InviteStatus.PK_ERR_MSG:this.errorMsg();break;case InviteStatus.INVALID_ERROR:this.invalidError();break;case InviteStatus.PK_END_WAIT:this.pkEnd();break;case InviteStatus.PK_NO_ANSWER:this.pkNoAnswer();break;case InviteStatus.PK_REJECT:this.pkReject()}},e.prototype.inviting=function(){var t=new egret.TextField;t.text="00:60",t.width=750,t.textAlign=egret.HorizontalAlign.CENTER,t.y=400,this.addChild(t);var i=60,n=new egret.Timer(1e3,60);this.timer=n,n.addEventListener(egret.TimerEvent.TIMER,function(){i--,10>i?t.text="00:0"+i:t.text="00:"+i},this),n.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){t.text="00:00"},this),n.start(),SocketX.getInstance().addEventListener(NetEvent.PK_ACCEPT,function(t){switch(DataManager.getInstance().setPk(t.data),t.data.tipsCode){case 0:var i=new e(InviteStatus.MATCHEND);ViewManager.getInstance().changeScene(i);break;case 10:var n=new e(InviteStatus.NOACCEPT);ViewManager.getInstance().changeScene(n)}});var a=new LineInfo("等待好友60s进入");a.y=50,this.buttonGroup.addChild(a)},e.prototype.noAccept=function(){var t=new egret.TextField;t.text="您的好友正忙,请下次再邀请TA吧！",t.width=350,t.textColor=Config.COLOR_YELLOW,t.textAlign=egret.HorizontalAlign.CENTER,t.x=200,t.y=-50,this.buttonGroup.addChild(t);var e=5,i=new LineInfo(e+"秒后进入离线答题模式！");i.y=50,this.buttonGroup.addChild(i)},e.prototype.matchEnd=function(){var t=DataManager.getInstance().getPkData(),e="匹配成功";t&&t.pkUser||(e="离线PK");var i=new egret.TextField;i.text=e,i.width=350,i.textColor=Config.COLOR_YELLOW,i.size=40,i.textAlign=egret.HorizontalAlign.CENTER,i.x=200,i.y=-50,this.buttonGroup.addChild(i);var n=5,a=new LineInfo(n+"秒后进入游戏");a.y=50,this.buttonGroup.addChild(a)},e.prototype.observe=function(){this.nav="首页";var t=new LineInfo("对局进行中");t.y=50,this.buttonGroup.addChild(t)},e.prototype.invalid=function(){this.nav="首页";var t=new LineInfo("本局无效\n友谊的小船荡啊荡，\nbut 你们却都没答题!");t.y=50,this.buttonGroup.addChild(t)},e.prototype.errorMsg=function(){this.nav="首页";var t=new LineInfo(this.msg);t.y=50,this.buttonGroup.addChild(t)},e.prototype.invalidError=function(){this.nav="返回";var t=new LineInfo("本局无效\n棋逢对手，满盘皆错！\n两位赶快去温习一下再来挑战吧！");t.y=50,this.buttonGroup.addChild(t)},e.prototype.pkNoAnswer=function(){this.nav="首页";var t=new LineInfo("您的好友24小时内未应答\n请确认TA是否被外星人绑架了");t.y=50,this.buttonGroup.addChild(t)},e.prototype.pkReject=function(){this.nav="首页";var t=new LineInfo("您的好友拒绝了您的邀请\n并向您发送了一波爱心");t.y=50,this.buttonGroup.addChild(t)},e.prototype.pkEnd=function(){this.nav="首页";var t=new LineInfo("Skr! \n你的对手还在苦思答题中~\n请稍候。");t.y=50,this.buttonGroup.addChild(t)},e.prototype.onBack=function(){switch(this.type){case InviteStatus.PK_ERR_MSG:DataManager.getInstance().removePkData(),ViewManager.getInstance().backByName("pkmodel");break;default:ViewManager.getInstance().jumpHome()}},e.prototype.waiting=function(){var t=new egret.TextField;t.text="等待对手24小时进入PK",t.width=750,t.size=40,t.textAlign=egret.HorizontalAlign.CENTER,t.y=-100,this.buttonGroup.addChild(t);var e=new XButton("返回PK模式目录");e.width=450,e.x=150,e.y=150,this.buttonGroup.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.getInstance().backByName("pkmodel")},this)},e.prototype.accepted=function(){var t=this,i=0,n=new XButton("接受邀请");n.width=450,n.x=150,this.buttonGroup.addChild(n);var a=DataManager.getInstance().getPkData().pkCode;n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SocketX.getInstance().addEventListener(NetEvent.PK_ACCEPT,function(t){var i=new e(InviteStatus.MATCHEND);ViewManager.getInstance().changeScene(i)}),SocketX.getInstance().sendMsg(NetEvent.PK_ACCEPT,{pkCode:a,accept:!0})},this),i+=130;var r=new XButton("拒绝对战");r.width=450,r.x=150,r.y=i,this.buttonGroup.addChild(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("quit ");var e=new Confirm("您确定拒绝对战吗？");t.addChild(e),e.addEventListener(ConfirmEvent.CONFIRM_BUTTON_YES,function(){SocketX.getInstance().sendMsg(NetEvent.PK_ACCEPT,{pkCode:a,accept:!1});var t=new IndexScene;ViewManager.getInstance().changeScene(t)},t)},this)},e}(Scene);__reflect(PkInviteScene.prototype,"PkInviteScene");var PkListScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.config=[{icon:"person_pk_png",title:"个人挑战赛",iconWidth:127,type:1},{icon:"team_pk_png",title:"团队PK赛",iconWidth:211,type:2}],e}return __extends(e,t),e.prototype.onBack=function(){ViewManager.getInstance().jumpHome()},e.prototype.init=function(){this.nav="首页",this.name="pklist";for(var t=120,e=function(e){var n=new PkItem(e);i.addChild(n),n.y=t,t+=260,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Util.playMusic("model_select_mp3");var t=new PkModelScene(e.type);ViewManager.getInstance().changeScene(t)},i)},i=this,n=0,a=this.config;n<a.length;n++){var r=a[n];e(r)}},e}(Scene);__reflect(PkListScene.prototype,"PkListScene");var PkMatchScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){var t=this;setTimeout(function(){SocketX.getInstance().sendMsg(NetEvent.PK_MATCH,{robot:!1})},2e3),this.addEventListener(egret.Event.REMOVED,function(){t.timer.stop()},this);var e=new eui.Group;this.addChild(e),this.matchGroup=e;var i=30,n=new egret.TextField;n.text="00:"+i,n.width=200,n.size=36,n.textColor=Config.COLOR_YELLOW,n.textAlign=egret.HorizontalAlign.CENTER,n.anchorOffsetX=100,n.x=this.stage.stageWidth/2,n.y=100,e.addChild(n);var a=new egret.Timer(1e3,60);this.timer=a,a.addEventListener(egret.TimerEvent.TIMER,function(){0>=i?(SocketX.getInstance().sendMsg(NetEvent.PK_MATCH,{robot:!0}),a.stop()):i--,10>i?n.text="00:0"+i:n.text="00:"+i},this),a.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){n.text="00:00"},this),a.start();var r=this.stage.stageWidth/2,s=320,o=Util.createBitmapByName("icon_2_jpg");o.width=125,o.height=125,o.x=r,o.y=s,o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2;var h=new egret.Shape;h.graphics.beginFill(255),h.graphics.drawCircle(r,s,63),h.graphics.endFill(),e.addChild(h),o.mask=h,e.addChild(o);var l=Util.createBitmapByName("pk_circle_bg_png");l.width=326,l.height=326,l.anchorOffsetX=l.width/2,l.anchorOffsetY=l.height/2,l.x=r,l.y=s,e.addChild(l),egret.Tween.get(l,{loop:!0}).to({rotation:360},3e3);var d=new egret.TextField;d.text="匹配中....",d.width=200,d.size=36,d.textColor=Config.COLOR_YELLOW,d.textAlign=egret.HorizontalAlign.CENTER,d.anchorOffsetX=100,d.x=this.stage.stageWidth/2,d.y=550,e.addChild(d);var c=DataManager.getInstance().getUser();s=650,Util.setUserImg(c.avatar,o);var g=new LineInfo("用户名:"+c.nickName);g.y=s,e.addChild(g),s+=100;var u=new LineInfo("来自:"+c.teamName);u.y=s,e.addChild(u),s+=100;var p=new LineInfo("等级:"+c.lvName+c.lvShow);p.y=s,e.addChild(p);var v=this.stage.stageHeight-200,T=new XButton("取消匹配");T.width=500,T.y=v,T.anchorOffsetX=250,T.x=this.stage.stageWidth/2,e.addChild(T),T.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SocketX.getInstance().sendMsg(NetEvent.CACEL_MATCH,{}),ViewManager.getInstance().back()},this)},e}(Scene);__reflect(PkMatchScene.prototype,"PkMatchScene");var PkMatchSuccessScene=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.width=750,this.anchorOffsetX=375,this.x=this.stage.stageWidth/2;var t=DataManager.getInstance().getUser();console.log(t,"useringo");var e=new PkUser(t);e.y=100,this.addChild(e);var i=new PkUser(t,"right");i.y=100,i.anchorOffsetX=243,i.x=750,this.addChild(i);var n=Util.createBitmapByName("pk_vs_png");n.anchorOffsetX=128,n.anchorOffsetY=86,n.x=375,n.y=240,this.addChild(n);var a=new egret.TextField;a.text="VS",a.width=100,a.height=100,a.anchorOffsetX=50,a.anchorOffsetY=50,a.y=240,a.x=375,a.textAlign=egret.HorizontalAlign.CENTER,a.verticalAlign=egret.VerticalAlign.MIDDLE,a.size=40,this.addChild(a);var r=new egret.TextField;r.width=750,r.textAlign=egret.HorizontalAlign.CENTER,r.text="匹配成功",r.textColor=Config.COLOR_YELLOW,r.size=40,r.y=600,this.addChild(r);var s=new LineInfo("5s后开始游戏");s.y=700,this.addChild(s)},e}(Scene);__reflect(PkMatchSuccessScene.prototype,"PkMatchSuccessScene");var PkModelScene=function(t){function e(e){var i=t.call(this)||this;return i.config={1:{title:"PK模式",items:[{icon:"pk_auto_png",title:"自动匹配",iconWidth:122,type:PkModel.AUTO},{icon:"pk_friend_png",title:"邀请好友",iconWidth:144,type:PkModel.FRIEND}]},2:{title:"对战形式",items:[{icon:"team_answer_png",title:"抢答赛",iconWidth:107,type:PkModel.ANSWER},{icon:"team_know_png",title:"知识赛",iconWidth:200,type:PkModel.KNOW}]}},i.type=e,i.data=i.config[e],i}return __extends(e,t),e.prototype.init=function(){var t=this;this.nav="返回";var e=100;this.name="pkmodel";var i=new Title(this.data.title);this.addChild(i),i.y=e,this.type==PKTYPE.PERSON?SocketX.getInstance().connectPersonPk():SocketX.getInstance().connectTeamPk(),e+=120;for(var n=function(i){var n=new PkItem(i);a.addChild(n),n.y=e,e+=260,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(console.log(i.type),Util.playMusic("model_select_mp3"),DataManager.getInstance().setPkModel(i.type),i.type){case PkModel.ANSWER:var e=new PkRoomScene(i.type);ViewManager.getInstance().changeScene(e);break;case PkModel.KNOW:var n=new PkRoomScene(i.type);ViewManager.getInstance().changeScene(n);break;case PkModel.AUTO:var a=new PkMatchScene;
ViewManager.getInstance().changeScene(a);break;case PkModel.FRIEND:var r=new SharePanel;t.addChild(r);var s=DataManager.getInstance().getUser();SocketX.getInstance().addEventListener(NetEvent.PK_INVITE,function(t){var e=new PkInviteScene(InviteStatus.INVITING);ViewManager.getInstance().changeScene(e)}),Util.registerShare(null,ShareType.PK_INVITE_FRIEND,s.nickName,null,function(e){t.removeChild(r),SocketX.getInstance().sendMsg(NetEvent.PK_INVITE,{pkCode:e})})}},a)},a=this,r=0,s=this.data.items;r<s.length;r++){var o=s[r];n(o)}if(1==this.type){var h=new egret.TextField;h.text="挑战记录",h.size=28,h.textColor=Config.COLOR_YELLOW,h.width=this.stage.stageWidth,h.textAlign=egret.HorizontalAlign.CENTER,h.y=this.stage.stageHeight-100,this.addChild(h),h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=new PkRecordScene;ViewManager.getInstance().changeScene(t)},this)}},e.prototype.onBack=function(){SocketX.getInstance().close(),ViewManager.getInstance().back()},e}(Scene);__reflect(PkModelScene.prototype,"PkModelScene");var PkRecordScene=function(t){function e(){var e=t.call(this)||this;return e.itemY=10,e.page=1,e.pageSize=20,e.end=!1,e}return __extends(e,t),e.prototype.init=function(){var t=this;SocketX.getInstance().addEventListener(NetEvent.PK_RECORDS,function(e){ViewManager.getInstance().hideLoading(),t.updateGroup(e.data||[])}),SocketX.getInstance().sendMsg(NetEvent.PK_RECORDS,{page:this.page,pageSize:this.pageSize});var e=new Title("挑战记录");e.y=100,this.addChild(e);var i=new eui.Group;this.groupView=i,i.width=720;var n=new eui.Scroller;n.width=this.stage.stageWidth,n.height=800,n.y=220,n.viewport=i,this.addChild(n),this.scrollView=n,n.addEventListener(eui.UIEvent.CHANGE_END,function(){n.viewport.scrollV+800>=n.viewport.contentHeight&&(t.end||SocketX.getInstance().sendMsg(NetEvent.PK_RECORDS,{page:t.page,pageSize:t.pageSize}))},this);var a=new XButton("返回PK模式目录");this.addChild(a),a.width=350,a.anchorOffsetX=175,a.x=this.stage.stageWidth/2,a.y=this.stage.stageHeight-200,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){ViewManager.getInstance().back()},this),ViewManager.getInstance().showLoading("数据加载中...")},e.prototype.updateGroup=function(t){if(t.length<20&&(this.end=!0),0==t.length&&1==this.page){var e=new egret.TextField;e.size=35,e.height=100,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.textAlign=egret.HorizontalAlign.CENTER,e.width=600,e.x=this.stage.stageWidth/2-300,e.text="暂无挑战数据",this.groupView.addChild(e)}this.page+=1;for(var i=0,n=t;i<n.length;i++){var a=n[i],r=new RecordItem(a);r.x=this.stage.stageWidth/2,r.y=this.itemY,this.groupView.addChild(r),this.itemY+=r.height}},e}(Scene);__reflect(PkRecordScene.prototype,"PkRecordScene");var RecordItem=function(t){function e(e){var i=t.call(this)||this;return i.status={1:{text:"胜利",style:{textColor:16177771}},2:{text:"失败",style:{textColor:13778272}},3:{text:"进行中"},4:{text:"平局"},5:{text:"无效局"}},i.data=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){var t=this;this.width=720,this.anchorOffsetX=360;var e=new egret.TextField,i=1==this.data.pkWay?"匹配":"邀请";e.textFlow=[{text:this.data.sendName},{text:" "+i+"\n",style:{textColor:Config.COLOR_YELLOW}},{text:this.data.acceptName},{text:"  对战",style:{textColor:Config.COLOR_YELLOW}}],e.lineSpacing=20,e.x=20,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.width=520,this.height=150,this.addChild(e);var n=(DataManager.getInstance().getUser().userId,new egret.TextField),a=this.data.pkResult;n.size=35,n.textFlow=[a],n.height=100,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.textAlign=egret.HorizontalAlign.CENTER,n.width=150,n.x=285,this.addChild(n);var r=new egret.TextField;r.text=this.data.createTime,r.width=200,r.textAlign=egret.HorizontalAlign.RIGHT,r.height=100,r.verticalAlign=egret.VerticalAlign.MIDDLE,r.x=e.width,this.addChild(r);var s=Util.createBitmapByName("dialog_line_png");s.width=this.width,s.y=e.textHeight+10,this.addChild(s),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SocketX.getInstance().addEventListener(NetEvent.PK_INFO,function(t){var e=t.data;if(e.tipsCode==InviteStatus.WATTING){var i=new PkInviteScene(InviteStatus.WATTING);ViewManager.getInstance().changeScene(i)}else{e=DataManager.getInstance().convertPkResult(e);var n=new PkResultScene(e,PkResultBackModel.BACK);ViewManager.getInstance().changeScene(n)}}),SocketX.getInstance().sendMsg(NetEvent.PK_INFO,{pkCode:t.data.pkCode})},this)},e}(eui.Group);__reflect(RecordItem.prototype,"RecordItem");var PkResultScene=function(t){function e(e,i){void 0===i&&(i=PkResultBackModel.BACK);var n=t.call(this)||this;return n.result=e,n.back=i,n}return __extends(e,t),e.prototype.init=function(){var t=this;this.width=750,this.anchorOffsetX=375,this.x=this.stage.stageWidth/2,this.nav="返回",this.back==PkResultBackModel.BACK_HOME&&(this.nav="首页");var e=new eui.Group;this.shareGroup=e,e.width=750;var i=Util.createBitmapByName("bg_jpg");e.addChildAt(i,-2);var n=this.stage.stageWidth,a=this.stage.stageHeight;i.width=n,i.height=a,this.addChild(e);var r=this.result,s=r.sender,o=(DataManager.getInstance().getUser(),0);s&&s.pkResult&&(o=s.pkResult.userAddScore);var h=new PkUser(s?s.pkUser:null,"left",o+"分");h.y=100;var l=0;s&&s.pkResult&&(l=s.pkResult.userAnswerUseTimeTotal);var d=Util.converTimer(l);h.addPkTime(d),e.addChild(h);var c=r.receiver,g=0;c&&c.pkResult&&(g=c.pkResult.userAddScore);var u=new PkUser(c?c.pkUser:null,"right",g+"分");u.y=100,u.anchorOffsetX=243,u.x=750;var p=0;c&&c.pkResult&&(p=c.pkResult.userAnswerUseTimeTotal);var v=Util.converTimer(p);u.addPkTime(v),e.addChild(u);var T=Util.createBitmapByName("pk_vs_png");T.anchorOffsetX=128,T.anchorOffsetY=86,T.x=375,T.y=240,e.addChild(T);var f=new egret.TextField;if(f.text="VS",f.width=100,f.height=100,f.anchorOffsetX=50,f.anchorOffsetY=50,f.y=240,f.x=375,f.textAlign=egret.HorizontalAlign.CENTER,f.verticalAlign=egret.VerticalAlign.MIDDLE,f.size=40,e.addChild(f),r.status==PkResult.INVALID){var m=new LineInfo(r.tipsMsg);return m.y=600,void e.addChild(m)}var y=Util.grayFliter(),_=Util.createBitmapByName("result_bg_png");_.width=560,_.height=315,_.anchorOffsetX=280,_.x=375,_.y=450,e.addChild(_);var E="挑战成功！",w="pass_mp3";switch(r.status){case PkResult.SUCCESS:break;case PkResult.DRAW:E="平局";break;case PkResult.FAIL:E="挑战失败！",w="nopass_mp3"}Util.playMusic(w);var x=new egret.TextField;x.text=E,x.width=210,x.anchorOffsetX=105,x.height=90,x.size=40,x.textAlign=egret.HorizontalAlign.CENTER,x.verticalAlign=egret.VerticalAlign.MIDDLE,x.x=_.x,x.y=_.y+110,e.addChild(x);var C=new eui.Group;e.addChild(C),C.y=800;var I=0;if(s){var S=s.pkUser.nickName+":+"+s.pkResult.userAddScore+"积分",R=new LineInfo(S);if(0==s.pkResult.userAddScore){var N=void 0;N=s.pkResult.scoretips?[{text:S},{text:"\n("+s.pkResult.scoretips+")",style:{size:22}}]:[{text:S}],R.setTextFlow(N),I+=R.height+25}else I+=80;console.log("y:",I),C.addChild(R)}if(c){var A=c.pkUser.nickName+":+"+c.pkResult.userAddScore+"积分",k=new LineInfo(A);if(k.y=I,0==c.pkResult.userAddScore){var N=[{text:A},{text:"\n("+c.pkResult.scoretips+")",style:{size:22}}];k.setTextFlow(N),I+=k.height+25}else I+=80;C.addChild(k)}r.status==PkResult.FAIL&&(_.filters=[y],x.filters=[y],C.filters=[y]);var U=new XButton("保存图片");U.width=325,U.x=30,U.y=this.stage.stageHeight-150,this.addChild(U),U.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new AlertPanel("提示:请自行截图保存图片");t.addChild(e)},this);var P=new XButton("分享");P.width=325,P.anchorOffsetX=325,P.x=720,P.y=this.stage.stageHeight-150,P.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new SharePanel;t.addChild(e)},this),this.addChild(P),Util.registerShare(this.shareGroup,ShareType.PK_BATTLE)},e.prototype.onBack=function(){switch(DataManager.getInstance().removePkData(),this.back){case PkResultBackModel.BACK:ViewManager.getInstance().back();break;case PkResultBackModel.BACK_HOME:ViewManager.getInstance().jumpHome();break;case PkResultBackModel.BACK_PK:ViewManager.getInstance().backByName("pkmodel")}},e}(Scene);__reflect(PkResultScene.prototype,"PkResultScene");var TeamKnowPkResultScene=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_KNOW_RESULT,function(t){DataManager.getInstance().updateTeamKonwResult(t.data);var e=new TeamKnowResultScene;ViewManager.getInstance().changeScene(e)},this);var t=DataManager.getInstance().getRoomData();this.pkData=t.pkData,this.width=750,this.anchorOffsetX=375,this.x=this.stage.stageWidth/2,this.nav="首页";var e=new eui.Group;this.shareGroup=e,e.width=750;var i=Util.createBitmapByName("bg_jpg");e.addChildAt(i,-2);var n=this.stage.stageWidth,a=this.stage.stageHeight;i.width=n,i.height=a,this.addChild(e);var r=this.pkData.result,s=new PkUser(this.pkData.users[TeamType.GREEN],"left",r.score[TeamType.GREEN]+"分");s.y=100,e.addChild(s);var o=new PkUser(this.pkData.users[TeamType.BLUE],"right",r.score[TeamType.BLUE]+"分");o.y=100,o.anchorOffsetX=243,o.x=750,e.addChild(o);var h=Util.createBitmapByName("pk_vs_png");h.anchorOffsetX=128,h.anchorOffsetY=86,h.x=375,h.y=240,e.addChild(h);var l=new egret.TextField;l.text="VS",l.width=100,l.height=100,l.anchorOffsetX=50,l.anchorOffsetY=50,l.y=240,l.x=375,l.textAlign=egret.HorizontalAlign.CENTER,l.verticalAlign=egret.VerticalAlign.MIDDLE,l.size=40,e.addChild(l);var d=new egret.Timer(1e3,15);d.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){SocketX.getInstance().sendMsg(NetEvent.TEAM_PK_KNOW_RESULT,{tableNo:t.tableNo,groupId:t.pkData.groupId})},this),d.start();var c=new XButton("查看比赛结果");if(c.width=400,c.y=this.stage.stageHeight-200,c.x=this.stage.stageWidth/2-200,c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.stop(),SocketX.getInstance().sendMsg(NetEvent.TEAM_PK_KNOW_RESULT,{tableNo:t.tableNo,groupId:t.pkData.groupId})},this),this.addChild(c),r.status==PkResult.INVALID){var g=new LineInfo(r.tipsMsg);return g.y=600,void e.addChild(g)}var u=(Util.grayFliter(),Util.createBitmapByName("result_bg_png"));u.width=560,u.height=315,u.anchorOffsetX=280,u.x=375,u.y=450,e.addChild(u);var p={0:"平局",1:"绿方代表获胜",2:"蓝方代表获胜"},v=p[r.winner],T="pass_mp3";Util.playMusic(T);var f=new egret.TextField;f.text=v,f.width=210,f.anchorOffsetX=105,f.height=90,f.size=30,f.textAlign=egret.HorizontalAlign.CENTER,f.verticalAlign=egret.VerticalAlign.MIDDLE,f.x=u.x,f.y=u.y+110,e.addChild(f);var m=new eui.Group;e.addChild(m),m.y=800;var y=0,_=r.score[TeamType.GREEN];r.score[TeamType.GREEN]>0&&(_="+"+_);var E=this.pkData.users[TeamType.GREEN].nickName+":"+_+"积分",w=new LineInfo(E);m.addChild(w),y+=80;var x=r.score[TeamType.BLUE];r.score[TeamType.BLUE]>0&&(x="+"+x);var C=this.pkData.users[TeamType.BLUE].nickName+":"+x+"积分",I=new LineInfo(C);I.y=y,m.addChild(I)},e.prototype.onBack=function(){DataManager.getInstance().removePkData(),ViewManager.getInstance().jumpHome()},e}(Scene);__reflect(TeamKnowPkResultScene.prototype,"TeamKnowPkResultScene");var PkRoomScene=function(t){function e(e){var i=t.call(this)||this;return i.titles={6:[{text:"10人房",style:{size:28,bold:!0,textColor:16777215}},{text:" | ",style:{size:30,textColor:16777215}},{text:"6",style:{size:38,bold:!0,textColor:Config.COLOR_YELLOW}},{text:"人房",style:{size:34,bold:!0,textColor:Config.COLOR_YELLOW}}],10:[{text:"10",style:{size:38,bold:!0,textColor:Config.COLOR_YELLOW}},{text:"人房",style:{size:34,textColor:Config.COLOR_YELLOW}},{text:" | ",style:{size:28}},{text:"6人房",style:{size:30,bold:!0}}]},i.roomList={6:[],10:[]},i.canJump=!1,i.name="room",i.model=e,i.roomNumber=RoomNumber.TEN,i}return __extends(e,t),e.prototype.getTableType=function(){switch(this.model){case PkModel.ANSWER:return"1"+(this.roomNumber==RoomNumber.SIX?"06":this.roomNumber);case PkModel.KNOW:return"2"+(this.roomNumber==RoomNumber.SIX?"06":this.roomNumber)}},e.prototype.initEvent=function(){function t(t){return function(e,i){var n=e[t],a=i[t];return a>n?-1:n>a?1:0}}var e=this;SocketX.getInstance().addEventListener(NetEvent.TEAM_ROOM_LIST,function(i){var n=i.data;n.sort(t("tableNo")),e.roomList[e.roomNumber]=n,e.updateRoomList()},this),SocketX.getInstance().sendMsg(NetEvent.TEAM_ROOM_LIST,{tableType:this.getTableType()}),SocketX.getInstance().addEventListener(NetEvent.TEAM_ROOMLIST_USER_UPDATE,function(t){var i=t.data;if(i){if(e.roomListViews&&e.roomListViews[t.data.tableNo]&&e.roomListViews[t.data.tableNo].update(t.data),e.roomList[6].length>0)for(var n in e.roomList[6]){var a=e.roomList[6][n];if(a.tableNo==t.data.tableNo)return void(e.roomList[6][n]=t.data)}if(e.roomList[10].length>0)for(var r in e.roomList[10]){var a=e.roomList[10][r];if(a.tableNo==t.data.tableNo)return void(e.roomList[10][r]=t.data)}}},this,"room"),SocketX.getInstance().addEventListener(NetEvent.TEAM_JOIN_IN,function(t){if(t.data.errCode&&t.data.errCode>0){var i=new Confirm(t.data.errMsg,"重新选择","进入旁观");e.addChild(i),i.addEventListener(ConfirmEvent.CONFIRM_BUTTON_NO,function(){e.joinType=JoinType.OBSEVER,SocketX.getInstance().sendMsg(NetEvent.TEAM_JOIN_IN,{tableNo:e.tableNo,joinType:JoinType.OBSEVER})},e)}else{var n=t.data;if(DataManager.getInstance().setRoomData(n.tableNo,e.model,n.maxJoin,e.joinType,n.users),0==n.status){var a=new TeamMatchScene(n.showTimeout);ViewManager.getInstance().changeScene(a)}else DataManager.getInstance().updateTeamPkData(t.data),e.GoBattle()}},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_KNOW_RESULT,function(t){if(e.canJump){DataManager.getInstance().updateTeamKonwResult(t.data);var i=new TeamKnowResultScene;ViewManager.getInstance().changeScene(i)}},this)},e.prototype.GoBattle=function(){var t,e=DataManager.getInstance().getRoomData();switch(e.roomType){case PkModel.ANSWER:t=new TeamBattleScene(!0);break;case PkModel.KNOW:e.joinType==JoinType.JOIN?t=new TeamKnowBattleScene:(this.canJump=!0,SocketX.getInstance().sendMsg(NetEvent.TEAM_PK_KNOW_RESULT,{tableNo:e.tableNo}))}t&&ViewManager.getInstance().changeScene(t)},e.prototype.init=function(){var t=this;this.initEvent(),this.nav="返回";var e=80,i=new Title("");this.addChild(i),i.y=e;var n=this.titles[this.roomNumber];i.updateTitle(n),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.roomNumber=t.roomNumber==RoomNumber.SIX?RoomNumber.TEN:RoomNumber.SIX;var e=t.titles[t.roomNumber];i.updateTitle(e),t.roomList[t.roomNumber].length>0?t.updateRoomList():SocketX.getInstance().sendMsg(NetEvent.TEAM_ROOM_LIST,{tableType:t.getTableType()})},this);var a=new eui.Group;a.width=this.stage.stageWidth;var r=new eui.Scroller;r.width=this.stage.stageWidth,r.height=this.stage.stageHeight-300,r.y=200,r.viewport=a,this.addChild(r),this.scrollView=r,this.roomView=a},e.prototype.updateScene=function(){this.updateRoomList()},e.prototype.updateRoomList=function(){var t=this,e=this.roomList[this.roomNumber];if(e&&e.length>0){this.scrollView.viewport.scrollV=0,this.roomView.removeChildren(),this.roomListViews={};for(var i=0,n=function(e){e.model=a.model,e.roomNumber=a.roomNumber;var n=new RoomItem(e);n.y=i,a.roomView.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(console.log(e),t.tableNo=e.tableNo,e.status==RoomStatus.PK){var i=new Confirm("比赛进行中 \n是否进入观战模式");t.addChild(i),i.addEventListener(ConfirmEvent.CONFIRM_BUTTON_YES,function(){t.joinType=JoinType.OBSEVER,SocketX.getInstance().sendMsg(NetEvent.TEAM_JOIN_IN,{tableNo:e.tableNo,joinType:JoinType.OBSEVER})},t)}else{var n=new Confirm("请选择您进入房间的角色身份","我是参赛者","我是旁观者");t.addChild(n),n.addEventListener(ConfirmEvent.CONFIRM_BUTTON_YES,function(){t.joinType=JoinType.JOIN,SocketX.getInstance().sendMsg(NetEvent.TEAM_JOIN_IN,{tableNo:e.tableNo,joinType:JoinType.JOIN})},t),n.addEventListener(ConfirmEvent.CONFIRM_BUTTON_NO,function(){t.joinType=JoinType.OBSEVER,SocketX.getInstance().sendMsg(NetEvent.TEAM_JOIN_IN,{tableNo:e.tableNo,joinType:JoinType.OBSEVER})},t)}},a),i+=200,a.roomListViews[e.tableNo]=n},a=this,r=0,s=e;r<s.length;r++){var o=s[r];n(o)}}},e}(Scene);__reflect(PkRoomScene.prototype,"PkRoomScene");var RoomItem=function(t){function e(e){var i=t.call(this)||this;return i.models={3:"抢答题",4:"知识题"},i.data=e,i.init(),i}return __extends(e,t),e.prototype.init=function(){this.width=750,this.height=160;var t=ViewManager.getInstance().stage;this.x=t.stageWidth/2-375;var e=Util.createBitmapByName("bg_level_pass_png");e.width=700,e.x=25,e.height=160,this.addChild(e);var i=new egret.TextField;i.x=65,i.y=30,i.textColor=Config.COLOR_YELLOW,i.verticalAlign=egret.VerticalAlign.MIDDLE;var n=this.models[this.data.model];i.textFlow=[{text:n,style:{size:28}},{text:"  房间号: ",style:{size:28}},{text:""+this.data.tableNo,style:{size:38,bold:!0}}],this.addChild(i);var a=new egret.TextField;a.x=65,a.y=90,a.size=32;var r=this.data.watchNum<0?0:this.data.watchNum,s=this.data.joinNum<0?0:this.data.joinNum;a.textFlow=[{text:"观 战: "},{text:r+"人    ",style:{size:34}},{text:s+"/"+this.data.maxJoin,style:{size:32}}],this.numberText=a,this.addChild(a);var o="战场等待中";this.data.status==RoomStatus.PK&&(o="团队pk中");var h=new egret.TextField;h.height=160,h.verticalAlign=egret.VerticalAlign.MIDDLE,h.width=300,h.textAlign=egret.HorizontalAlign.RIGHT,h.x=350,h.text=o,h.size=42,this.addChild(h),this.statusText=h},e.prototype.update=function(t){this.data=t;var e=this.data.watchNum<0?0:this.data.watchNum,i=this.data.joinNum<0?0:this.data.joinNum;this.numberText.textFlow=[{text:"观 战: "},{text:e+"人    ",style:{size:34}},{text:i+"/"+this.data.maxJoin,style:{size:32}}];var n=this.data.status==RoomStatus.PK?"团队pk中":"战场等待中";this.statusText=n},e}(eui.Group);__reflect(RoomItem.prototype,"RoomItem");var TeamBattleScene=function(t){function e(e){void 0===e&&(e=!1);var i=t.call(this)||this;return i.index=0,i.users={},i.team={},i.waitting=e,i}return __extends(e,t),e.prototype.init=function(){this.roomData=DataManager.getInstance().getRoomData(),this.initEvent(),this.initHead(),this.initUserList(),this.waitting?ViewManager.getInstance().showLoading("等待数据同步中..."):(this.initTopic(),this.timer=(new Date).getTime(),this.updateTimer())},e.prototype.onBack=function(){this.roomData.joinType===JoinType.OBSEVER&&(ViewManager.getInstance().hideLoading(),ViewManager.getInstance().backByName("room"))},e.prototype.updateTimer=function(){var t=this;if(this.timeNumber=30,this.timeText.text=this.timeNumber,this.cutTimer)this.cutTimer.reset(),this.cutTimer.start();else{var e=new egret.Timer(1e3,this.timeNumber+10);this.cutTimer=e,e.addEventListener(egret.TimerEvent.TIMER,function(){t.timeNumber--,t.timeText.text=t.timeNumber,0==t.timeNumber&&e.stop()},this),e.start()}},e.prototype.initEvent=function(){var t=this;SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_SUBMIT,function(t){t.data.isOver},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_COUNT_DOWN_BROADCAST,function(e){0==e.data.type&&t.cutTimer&&t.cutTimer.stop()},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_SUBMIT_BROADCAST,function(e){var i=e.data;if(t.waitting&&(t.index=i.seriaNo-1,t.initTopic(),ViewManager.getInstance().hideLoading(),t.waitting=!1),i.errCode>0){var n=new NoScoreAlert(i.errMsg);t.addChild(n)}else{var a=DataManager.getInstance().getRoomData(),r=5;a.roomNumber==RoomNumber.SIX&&(r=3),a.self&&(i.userTeam==a.self.team?t.submitButton.visible=!1:i.replyIsCorrect&&(t.submitButton.visible=!1));var s=UserPositionType.LEFT,o=0,h=105;i.userIndex>r&&(s=UserPositionType.RIGHT,o=t.stage.stageWidth,h=t.stage.stageWidth-345);var l=new ResultAlert(s,i.replyIsCorrect,i.answerIndex,i.addScore);l.x=o,l.y=t.users[i.userIndex].y+450,t.alertGroup.addChild(l),egret.Tween.get(l).to({x:h},300,egret.Ease.sineIn),t.team[UserPositionType.LEFT].setScore(i.teamScore[UserPositionType.LEFT]+"分"),t.team[UserPositionType.RIGHT].setScore(i.teamScore[UserPositionType.RIGHT]+"分")}},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_NEXT_BROADCAST,function(e){t.index=e.data.seriaNo-1,t.updateTopic(),t.updateTimer()},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_END_PK,function(e){DataManager.getInstance().updateTeamPkResult(e.data),t.clearEventListeners();var i=new TeamResultScene;ViewManager.getInstance().changeScene(i)},this)},e.prototype.clearEventListeners=function(){SocketX.getInstance().removeEventListener(NetEvent.TEAM_PK_NEXT_BROADCAST),SocketX.getInstance().removeEventListener(NetEvent.TEAM_END_PK),SocketX.getInstance().removeEventListener(NetEvent.TEAM_PK_SUBMIT_BROADCAST),SocketX.getInstance().removeEventListener(NetEvent.TEAM_COUNT_DOWN_BROADCAST)},e.prototype.initHead=function(){if(this.roomData.joinType===JoinType.OBSEVER){this.nav="离开";var t=new egret.TextField;t.text="观战模式",t.width=200,t.textAlign=egret.HorizontalAlign.CENTER,t.x=this.stage.stageWidth/2-100,t.y=50,this.addChild(t)}var e=DataManager.getInstance().getUser();this.userInfo=e;var i=new PkUser({nickName:"绿队"},"left","0分");i.y=85,this.addChild(i),this.team[UserPositionType.LEFT]=i;var n=new PkUser({nickName:"蓝队"},"right","0分");n.y=85,n.anchorOffsetX=243,n.x=this.stage.stageWidth,this.addChild(n),this.team[UserPositionType.RIGHT]=n;var a=Util.createBitmapByName("pk_vs_png");a.anchorOffsetX=128,a.anchorOffsetY=86,a.x=this.stage.stageWidth/2,a.y=240,this.addChild(a);var r=new egret.TextField;r.text="VS",r.width=300,r.height=100,r.anchorOffsetX=150,r.anchorOffsetY=50,r.y=240,r.size=35,r.x=this.stage.stageWidth/2,r.textAlign=egret.HorizontalAlign.CENTER,r.verticalAlign=egret.VerticalAlign.MIDDLE,this.addChild(r),this.timeText=r},e.prototype.initUserList=function(){var t=new eui.Group;t.y=450,this.addChildAt(t,110),this.userGroup=t,t.touchEnabled=!1;var e=DataManager.getInstance().getRoomData(),i=e.users,n=5;e.roomNumber==RoomNumber.SIX&&(n=3);for(var a in i){var r=i[a];if(!(r.position>e.roomNumber||r.position<1)){var s=140*(r.position-1),o=UserPositionType.LEFT;r.position>n&&(s=140*(r.position-n-1),o=UserPositionType.RIGHT);var h=new LiteTeamUser(r.userInfo,o);h.y=s,t.addChild(h),o==UserPositionType.RIGHT&&(h.anchorOffsetX=105,h.x=this.stage.stageWidth),this.users[r.position]=h}}},e.prototype.initTopic=function(){var t=this,e=DataManager.getInstance().getTeamPkData();if(console.log(e,"pkData"),!e)return void console.error("没有团队pk数据");var i=e.questions[this.index].id,n=this.stage.stageWidth-230;n>700&&(n=700);var a=Util.getTrain(i);if(a){console.log("subject-"+i,a);var r=new eui.Group;r.width=n;var s=new egret.TextField;s.width=n,s.text="Q"+(this.index+1),s.textColor=Config.COLOR_YELLOW,s.textAlign=egret.HorizontalAlign.CENTER,r.addChild(s),this.numberText=s;var o=new Topic(a,r.width);this.topic=o,o.y=50,r.addChild(o),this.topicGroup=r;var h=new eui.Scroller;h.width=n,h.height=this.stage.stageHeight-500,h.y=400,h.x=(this.stage.stageWidth-n)/2,h.viewport=r,this.scroller=h,this.addChildAt(h,-1),this.canSubmit=!0;var l=new XButton("提交");l.width=450,l.x=(this.stage.stageWidth-l.width)/2,this.submitButton=l,l.y=this.stage.stageHeight-100,this.addChild(l),l.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.canSubmit){var e=t.topic.getSelect();if(!e){var i=new AlertPanel("请选择答案！");return void t.addChild(i)}var n=t.topic.getSelectResult();t.submitResult(n,e),t.topic.setDisableSeleced()}},this),this.roomData.joinType===JoinType.OBSEVER&&(l.visible=!1,this.topic.setCorrectItem());var d=new eui.Group;d.touchEnabled=!1,this.alertGroup=d,this.addChildAt(d,100)}},e.prototype.submitResult=function(t,e){var i=DataManager.getInstance().getRoomData(),n=DataManager.getInstance().getTeamPkData(),a=n.questions[this.index].id,r=Util.getTrain(a);if(r){var s=(new Date).getTime()-this.timer;SocketX.getInstance().sendMsg(NetEvent.TEAM_PK_SUBMIT,{tableNo:i.tableNo,qid:r.id,qattrId:r.qattrid,reply:e,isCorrect:t,useTime:s})}},e.prototype.updateTopic=function(){this.canSubmit=!0,this.topic&&(this.topicGroup.removeChild(this.topic),this.topic=null);var t=DataManager.getInstance().getTeamPkData();if(!t)return void console.error("没有团队pk数据");this.submitButton.visible=!0,this.alertGroup&&this.alertGroup.removeChildren(),this.numberText.text="Q"+(this.index+1);var e=t.questions[this.index].id;this.timer=(new Date).getTime();var i=Util.getTrain(e);if(i){var n=new Topic(i,this.topicGroup.width);n.y=50,this.topic=n,this.topicGroup.touchEnabled=!0,this.topicGroup.addChild(n),this.scroller.viewport.scrollV=0,this.roomData.joinType===JoinType.OBSEVER&&(this.submitButton.visible=!1,this.topic.setCorrectItem())}},e}(Scene);__reflect(TeamBattleScene.prototype,"TeamBattleScene");var TeamKnowBattleScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.index=0,e.progress={},e.TIMER=15,e}return __extends(e,t),e.prototype.initData=function(){var t=this;this.timeNumber=this.TIMER,SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_SUBMIT_BROADCAST,this.updateProgress,this),SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_SUBMIT,function(e){var i=e.data;t.progress[i.userTeam].setRate(i.seriaNo),i.seriaNo>=10?i.isEnd||t.showWait():t.next()},this),SocketX.getInstance().addEventListener(NetEvent.PK_END,function(e){DataManager.getInstance().updateTeamPersonPkResult(e.data),t.clearEventListener();var i=new TeamKnowPkResultScene;ViewManager.getInstance().changeScene(i)},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_KNOW_RESULT,function(e){DataManager.getInstance().updateTeamKonwResult(e.data),t.clearEventListener();var i=new TeamKnowResultScene;ViewManager.getInstance().changeScene(i)},this);var e=new egret.Timer(1e3,this.TIMER+10);this.timer=e,e.addEventListener(egret.TimerEvent.TIMER,function(){if(t.timeNumber--,t.timeText.text=t.timeNumber,0==t.timeNumber){if(e.stop(),!t.canSubmit)return;t.submitResult(!1,null)}},this),e.start()},e.prototype.clearEventListener=function(){SocketX.getInstance().removeEventListener(NetEvent.PK_END),SocketX.getInstance().removeEventListener(NetEvent.TEAM_PK_SUBMIT_BROADCAST),SocketX.getInstance().removeEventListener(NetEvent.TEAM_PK_KNOW_RESULT)},e.prototype.init=function(){var t=this;this.startTime=(new Date).getTime(),this.width=750,this.anchorOffsetX=375,this.x=this.stage.stageWidth/2,this.initData();var e=DataManager.getInstance().getRoomData();this.roomData=e;var i=e.pkData;this.pkData=i;var n=i.users,a=new PkUser(n[TeamType.GREEN]);a.y=100,this.addChild(a);var r=new PkUser(n[TeamType.BLUE],"right");r.y=100,r.anchorOffsetX=243,r.x=this.stage.stageWidth,this.addChild(r);var s=Util.createBitmapByName("pk_vs_png");s.anchorOffsetX=128,s.anchorOffsetY=86,s.x=375,s.y=240,this.addChild(s);var o=new egret.TextField;o.text=""+this.TIMER,o.width=100,o.height=100,o.anchorOffsetX=50,o.anchorOffsetY=50,o.y=240,o.x=375,o.textAlign=egret.HorizontalAlign.CENTER,o.verticalAlign=egret.VerticalAlign.MIDDLE,o.size=40,this.addChild(o),this.timeText=o;var h=new eui.Group;h.y=450,this.bottomGroup=h,this.addChild(h);var l=new VProgress(1,this.pkData.questions.length);l.x=30,l.y=50,this.bottomGroup.addChild(l),l.setRate(0),this.progress[UserPositionType.LEFT]=l;var d=new VProgress(2,this.pkData.questions.length);d.x=690,d.y=50,this.bottomGroup.addChild(d),d.setRate(0),this.progress[UserPositionType.RIGHT]=d;var c=this.pkData.questions[this.index].id,g=Util.getTrain(c);if(g){var u=new eui.Group;u.width=600;var p=new egret.TextField;p.width=600,p.text="Q"+(this.index+1),p.textColor=Config.COLOR_YELLOW,p.textAlign=egret.HorizontalAlign.CENTER,u.addChild(p),this.numberText=p;var v=new Topic(g);this.topic=v,v.y=50,u.addChild(v),this.topicGroup=u;var T=new eui.Scroller;T.width=600,T.height=this.stage.stageHeight-650,T.x=75,T.viewport=u,this.scroller=T,this.bottomGroup.addChild(T),this.canSubmit=!0;var f=new XButton("提交");f.width=450,f.x=this.stage.stageWidth/2-225,this.submitButton=f,f.y=this.stage.stageHeight-600,this.bottomGroup.addChild(f),f.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.canSubmit){var e=t.topic.getSelect();if(!e){var i=new AlertPanel("请选择答案！");return void t.addChild(i)}var n=t.topic.getSelectResult();t.submitResult(n,e),t.topic.setDisableSeleced()}},this)}},e.prototype.submitResult=function(t,e){this.canSubmit=!1;var i=this.topic.getQAttrId(),n=(new Date).getTime(),a=n-this.startTime,r={tableNo:this.roomData.tableNo,groupId:this.pkData.groupId,qid:this.pkData.questions[this.index].id,qattrId:i,reply:e,isCorrect:t?1:0,useTime:a};SocketX.getInstance().sendMsg(NetEvent.TEAM_PK_SUBMIT,r),e&&(t?(Util.playMusic("answer_ok_mp3"),this.topic.setSelectedStatus(TopicItem.STATUS_OK)):(this.topic.setSelectedStatus(TopicItem.STATUS_ERROR),Util.playMusic("answer_err3_mp3"))),this.submitButton.visible=!1},e.prototype.next=function(){this.startTime=(new Date).getTime(),this.canSubmit=!0,this.submitButton.visible=!0,this.index++,this.numberText.text="Q"+(this.index+1),this.timeNumber=this.TIMER,this.timer.reset(),this.timeText.text=this.timeNumber,this.timer.start(),this.topicGroup.removeChild(this.topic);var t=this.pkData.questions[this.index].id,e=Util.getTrain(t);if(e){var i=new Topic(e);i.y=50,this.topic=i,this.topicGroup.addChild(i),this.scroller.viewport.scrollV=0}},e.prototype.updateProgress=function(t){var e=t.data;this.progress[e.userTeam].setRate(t.data.seriaNo)},e.prototype.showWait=function(){this.bottomGroup.removeChildren();var t=DataManager.getInstance().getRoomData(),e=new egret.TextField;this.timer&&this.timer.stop(),this.timeText.text="VS",e.size=35,e.text="请稍后\n对手还在努力答辩中。",e.width=500,e.lineSpacing=10,e.textAlign=egret.HorizontalAlign.CENTER,e.y=200,e.x=this.stage.stageWidth/2-250,this.bottomGroup.addChild(e);var i=new XButton("查看比赛结果");i.width=450,i.x=this.stage.stageWidth/2-225,i.y=this.stage.stageHeight-600,this.bottomGroup.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){SocketX.getInstance().sendMsg(NetEvent.TEAM_PK_KNOW_RESULT,{tableNo:t.tableNo,groupId:t.pkData.groupId})},this)},e}(Scene);__reflect(TeamKnowBattleScene.prototype,"TeamKnowBattleScene");var TeamMatchScene=function(t){function e(e){var i=t.call(this)||this;return i.userViews={},i.showCountText=!1,i.userPositions={},i.isShowLoading=!1,i.showConfirm=!1,i.showCountText=e,i}return __extends(e,t),e.prototype.initEvent=function(){var t=this;SocketX.getInstance().addEventListener(NetEvent.TEAM_JOIN_BROADCAST,function(e){DataManager.getInstance().updateTeamUser(e.data.joinUser),t.updateUserStatus(e.data.joinUser.index)},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_READY,function(e){DataManager.getInstance().setRoomSelfData(e.data),DataManager.getInstance().updateTeamUserStatus(e.data.index,e.data.ok),e.data.ok&&t.userViews[e.data.index].setReady(),t.readyButton.visible=!1},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_READY_BROADCAST,function(e){DataManager.getInstance().updateTeamUserStatus(e.data.index,e.data.ok),e.data.ok&&t.userViews[e.data.index].setReady()},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_LEAVE_ROOM,function(){t.clearListeners(),t.hideLoading(),DataManager.getInstance().clearRoomData(),ViewManager.getInstance().back()},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_LEAVE_ROOM_BROADCAST,function(e){DataManager.getInstance().updateUserLeave(e.data),t.updateUserStatus(e.data.index)},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_CHANGE_POSITION,function(e){t.showConfirm&&t.confirm&&t.removeChild(t.confirm);var i=e.data,n=i.sendUserInfo.nickName,a=DataManager.getInstance().getRoomData(),r=new Confirm(n+"发起位置交换","拒绝","同意");t.addChild(r),t.showConfirm=!0,t.confirm=r,r.addEventListener(ConfirmEvent.CONFIRM_BUTTON_YES,function(){SocketX.getInstance().sendMsg(NetEvent.TEAM_CHANGE_POSITION_REPLY,{tableNo:a.tableNo,sendUserId:i.sendUserId,isDo:!1}),t.showConfirm=!1},t),r.addEventListener(ConfirmEvent.CONFIRM_BUTTON_NO,function(){SocketX.getInstance().sendMsg(NetEvent.TEAM_CHANGE_POSITION_REPLY,{tableNo:a.tableNo,sendUserId:i.sendUserId,isDo:!0}),t.showConfirm=!1},t)},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_CHANGE_POSITION_REPLY,function(e){var i=e.data.isDo;if(t.hideLoading(),!i){var n=t.userPositions[e.data.acceptUserId];t.userViews[n].setDisableClick();var a=new AlertPanel("对方拒绝了您的位置请求！",!0);t.addChild(a)}},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_CHANGE_POSITION_BROADCAST,function(e){for(var i in e.data){var n=e.data[i];
n||(n={}),n.index=i,DataManager.getInstance().updateTeamUser(n),t.updateUserStatus(i)}},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_COUNT_DOWN_BROADCAST,function(e){1==e.data.type?t.showTimer(e.data.timeout):(t.countText.visible=!1,t.showCountText=!1,t.timer&&t.timer.stop())},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_START,function(e){DataManager.getInstance().updateTeamPkData(e.data),t.GoBattle()},this),SocketX.getInstance().addEventListener(NetEvent.TEAM_PK_KNOW_RESULT,function(e){DataManager.getInstance().updateTeamKonwResult(e.data),t.clearListeners();var i=new TeamKnowResultScene;ViewManager.getInstance().changeScene(i)},this)},e.prototype.clearListeners=function(){SocketX.getInstance().removeEventListener(NetEvent.TEAM_JOIN_BROADCAST),SocketX.getInstance().removeEventListener(NetEvent.TEAM_READY_BROADCAST),SocketX.getInstance().removeEventListener(NetEvent.TEAM_CHANGE_POSITION_BROADCAST),SocketX.getInstance().removeEventListener(NetEvent.TEAM_LEAVE_ROOM_BROADCAST),SocketX.getInstance().removeEventListener(NetEvent.TEAM_COUNT_DOWN_BROADCAST)},e.prototype.showLoading=function(){var t=this;this.isShowLoading=!0,console.log(this.isShowLoading,"显示等待狂");var e="等待对方回应",i=10;if(!this.loadingView){var n=new AlertLoading(i+"\n"+e);this.loadingView=n,this.addChild(n)}if(this.loadingView.visible=!0,this.loadingTimer)this.loadingTimer.reset();else{var a=new egret.Timer(1e3,12);this.loadingTimer=a,a.addEventListener(egret.TimerEvent.TIMER,function(){return i--,0>=i?(a.stop(),void t.hideLoading()):void(t.showLoading&&t.loadingView?t.loadingView.setText(i+"\n"+e):t.loadingTimer.stop())},this)}this.loadingTimer.start()},e.prototype.hideLoading=function(){this.isShowLoading=!1,this.loadingTimer&&this.loadingTimer.stop(),this.loadingView&&(this.loadingView.visible=!1)},e.prototype.showTimer=function(t){var e=this;if(this.showCountText=!0,this.countText.visible=!0,this.count=t,this.countText.text=t,this.timer)this.timer.reset(),this.timer.start();else{var i=new egret.Timer(1e3,60);this.timer=i,i.addEventListener(egret.TimerEvent.TIMER,function(){return e.count--,0==e.count?void i.stop():void(e.countText.text=e.count)},this),i.start()}},e.prototype.GoBattle=function(){var t,e=DataManager.getInstance().getRoomData();switch(this.clearListeners(),e.roomType){case PkModel.ANSWER:t=new TeamBattleScene;break;case PkModel.KNOW:e.joinType==JoinType.JOIN?t=new TeamKnowBattleScene:SocketX.getInstance().sendMsg(NetEvent.TEAM_PK_KNOW_RESULT,{tableNo:e.tableNo})}t&&ViewManager.getInstance().changeScene(t)},e.prototype.updateUserStatus=function(t){var e=DataManager.getInstance().getRoomUser(t);e&&this.userViews[t]&&(this.userViews[t].updateUser(e.userInfo),e.userInfo&&e.userInfo.userId&&(this.userPositions[e.userInfo.userId]=t),e.status==ReadyType.READYED&&this.userViews[t].setReady())},e.prototype.init=function(){var t=this;this.initEvent();var e=70,i=30,n=new egret.TextField;n.text="绿队",n.size=40,n.textColor=Config.COLOR_YELLOW,n.x=i,n.y=e,this.addChild(n);var a=new egret.TextField;a.textColor=Config.COLOR_BLUE,a.size=40,a.text="蓝队",a.x=this.stage.stageWidth-i,a.width=100,a.anchorOffsetX=100,a.textAlign=egret.HorizontalAlign.RIGHT,a.y=e,this.addChild(a);var r=new egret.TextField;r.size=40,r.x=this.stage.stageWidth/2,r.width=100,r.anchorOffsetX=50,r.textAlign=egret.HorizontalAlign.CENTER,r.y=e,this.addChild(r),this.countText=r,this.countText.visible=!1,this.showCountText&&this.showTimer(30);var s=DataManager.getInstance().getRoomData(),o=5;if(s.roomNumber==RoomNumber.SIX&&(o=3),s.joinType===JoinType.OBSEVER){var h=new egret.TextField;h.size=25,h.text="旁观模式",h.x=this.stage.stageWidth/2,h.width=200,h.anchorOffsetX=100,h.textAlign=egret.HorizontalAlign.CENTER,h.y=30,this.addChild(h)}if(s.roomType===PkModel.ANSWER){var l=95*o+150,d=new egret.TextField;d.textColor=8554395,d.size=30,d.text="点击头像\n交换位置",d.x=this.stage.stageWidth/2,d.width=250,d.anchorOffsetX=125,d.textAlign=egret.HorizontalAlign.CENTER,d.y=l,this.addChild(d)}this.initUser();var c=this.stage.stageHeight-200;if(s.joinType===JoinType.JOIN){var g=new XButton("准备");g.width=500,g.y=c,g.anchorOffsetX=250,g.x=this.stage.stageWidth/2,this.addChild(g),this.readyButton=g,g.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("点击准备"),t.isShowLoading||SocketX.getInstance().sendMsg(NetEvent.TEAM_PK_READY,{tableNo:s.tableNo})},this)}var u=new XButton("离开");u.width=500,u.anchorOffsetX=250,u.y=this.stage.stageHeight-100,u.x=this.stage.stageWidth/2,this.addChild(u),u.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=DataManager.getInstance().getRoomData();SocketX.getInstance().sendMsg(NetEvent.TEAM_LEAVE_ROOM,{tableNo:t.tableNo,joinType:t.joinType})},this)},e.prototype.updateUser=function(){var t=this,e=DataManager.getInstance().getRoomData(),i=e.users,n=5;e.roomNumber==RoomNumber.SIX&&(n=3);var a=function(a){var s=i[a];if(s.position>e.roomNumber||s.position<1)return"continue";var o=190*(s.position-1),h=UserPositionType.LEFT;s.position>n&&(o=190*(s.position-n-1),h=UserPositionType.RIGHT);var l=s.status==ReadyType.UNJOIN?null:s.userInfo,d=new TeamUser(l,h);d.y=o,r.userViews[s.position]=d,l&&l.userId&&(r.userPositions[l.userId]=s.position),r.userGroup.addChild(d),s.status==ReadyType.READYED&&d.setReady(),h==UserPositionType.RIGHT&&(d.anchorOffsetX=243,d.x=r.stage.stageWidth),d.addUserEventListener(function(){if(console.log("点击用户",s),console.log("this.isShowLoading",t.isShowLoading),!t.isShowLoading&&e.joinType!=JoinType.OBSEVER){var i=DataManager.getInstance().getRoomSelfData();if(!i||i.status!=ReadyType.READYED){var n=DataManager.getInstance().getRoomUser(s.position);if(console.log("positionUser",n,"self",i),!(n&&n.userInfo&&i&&n.userInfo.userId==i.userId))switch(n.status){case ReadyType.UNJOIN:console.log("处理未加入事件"),Util.playMusic("model_select_mp3"),SocketX.getInstance().sendMsg(NetEvent.TEAM_CHANGE_POSITION,{tableNo:e.tableNo,acceptUserId:n.userInfo?n.userInfo.userId:0,acceptIndex:s.position});break;case ReadyType.UNREADY:console.log("处理未准备 交换"),Util.playMusic("model_select_mp3"),t.showLoading(),SocketX.getInstance().sendMsg(NetEvent.TEAM_CHANGE_POSITION,{tableNo:e.tableNo,acceptUserId:n.userInfo?n.userInfo.userId:0,acceptIndex:s.position});break;case ReadyType.READYED:}}}},r)},r=this;for(var s in i)a(s)},e.prototype.initUser=function(){var t=DataManager.getInstance().getRoomData(),e=new eui.Group;e.y=150,this.addChild(e),this.userGroup=e;var i=5;t.roomNumber==RoomNumber.SIX&&(i=3),this.updateUser();var n=150;if(t.roomType===PkModel.KNOW)for(var a=0;i>a;a++){var r=Util.createBitmapByName("pk_vs_png");r.width=246,r.height=166,r.anchorOffsetX=123,r.anchorOffsetY=83,r.x=this.stage.stageWidth/2,r.y=n+190*a+95,this.addChild(r);var s=new egret.TextField;s.text="VS",s.size=40,s.width=100,s.textAlign=egret.HorizontalAlign.CENTER,s.height=s.textHeight,s.anchorOffsetX=50,s.anchorOffsetY=s.height/2,s.x=this.stage.stageWidth/2,s.y=n+190*a+95,this.addChild(s)}},e}(Scene);__reflect(TeamMatchScene.prototype,"TeamMatchScene");var TeamResultScene=function(t){function e(){var e=t.call(this)||this;return e.users={},e}return __extends(e,t),e.prototype.init=function(){this.nav="竞技场",this.shareGroup=new eui.Group,this.addChild(this.shareGroup),this.roomData=DataManager.getInstance().getRoomData(),this.initHead(),this.initUserList(),this.initResult()},e.prototype.onBack=function(){DataManager.getInstance().clearRoomData(),ViewManager.getInstance().backByName("pklist")},e.prototype.initHead=function(){var t=this.roomData.pkResult,e=new PkUser({nickName:"绿队"},"left",t.score[UserPositionType.LEFT]+"分");e.y=85,this.shareGroup.addChild(e);var i=new PkUser({nickName:"蓝队"},"right",t.score[UserPositionType.RIGHT]+"分");i.y=85,i.anchorOffsetX=243,i.x=this.stage.stageWidth,this.shareGroup.addChild(i);var n=Util.createBitmapByName("pk_vs_png");n.anchorOffsetX=128,n.anchorOffsetY=86,n.x=this.stage.stageWidth/2,n.y=240,this.shareGroup.addChild(n);var a=new egret.TextField;if(a.text="VS",a.width=300,a.height=100,a.anchorOffsetX=150,a.anchorOffsetY=50,a.y=240,a.size=30,a.x=this.stage.stageWidth/2,a.textAlign=egret.HorizontalAlign.CENTER,a.verticalAlign=egret.VerticalAlign.MIDDLE,this.shareGroup.addChild(a),this.roomData.joinType===JoinType.OBSEVER){var r=new egret.TextField;r.size=25,r.text="旁观模式",r.x=this.stage.stageWidth/2,r.width=200,r.anchorOffsetX=100,r.textAlign=egret.HorizontalAlign.CENTER,r.y=30,this.addChild(r)}},e.prototype.initUserList=function(){var t=new eui.Group;t.y=450,this.shareGroup.addChildAt(t,100);var e=DataManager.getInstance().getRoomData(),i=e.users,n=5;e.roomNumber==RoomNumber.SIX&&(n=3);for(var a in i){var r=i[a];if(!(r.position>e.roomNumber||r.position<1)){var s=140*(r.position-1),o=UserPositionType.LEFT;r.position>n&&(s=140*(r.position-n-1),o=UserPositionType.RIGHT);var h=new LiteTeamUser(r.userInfo,o);h.y=s,t.addChild(h),o==UserPositionType.RIGHT&&(h.anchorOffsetX=105,h.x=this.stage.stageWidth),this.users[r.position]=h}}if(this.roomData.pkResult&&this.roomData.pkResult.mvps)for(var l=0,d=this.roomData.pkResult.mvps;l<d.length;l++){var c=d[l],g=105,u=TeamType.GREEN;c.index>n&&(g=this.stage.stageWidth-225,u=TeamType.BLUE);var p=new MvpAlert(u);p.x=g,p.y=this.users[c.index].y,t.addChildAt(p,-1)}},e.prototype.initResult=function(){var t=this,e=(Util.grayFliter(),Util.createBitmapByName("result_bg_png"));e.width=500,e.height=281,e.anchorOffsetX=250,e.x=this.stage.stageWidth/2,e.y=450,this.shareGroup.addChildAt(e,0);var i={0:"平局",1:"绿队获胜",2:"蓝队获胜"},n=this.roomData.pkResult,a=i[n.winner],r="pass_mp3";Util.playMusic(r);var s=new egret.TextField;s.text=a,s.width=210,s.anchorOffsetX=105,s.height=90,s.size=40,s.textAlign=egret.HorizontalAlign.CENTER,s.verticalAlign=egret.VerticalAlign.MIDDLE,s.x=e.x,s.y=e.y+95,this.shareGroup.addChild(s);var o=new XButton("分享",ButtonType.YELLOW);o.width=400,o.y=this.stage.stageHeight-300,o.anchorOffsetX=200,o.x=this.stage.stageWidth/2,o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new SharePanel;t.addChild(e)},this),this.addChild(o),Util.registerShare(this.shareGroup,ShareType.PK_ANSWER);var h=new XButton("保存图片");h.width=400,h.y=this.stage.stageHeight-200,h.anchorOffsetX=200,h.x=this.stage.stageWidth/2,this.addChild(h),h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new AlertPanel("提示:请自行截图保存图片");t.addChild(e)},this)},e}(Scene);__reflect(TeamResultScene.prototype,"TeamResultScene");var TeamKnowResultScene=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.userViews={},e.scoresText={},e}return __extends(e,t),e.prototype.init=function(){this.nav="竞技场",this.shareGroup=new eui.Group,this.addChild(this.shareGroup),this.initEvent(),this.initTop(),this.initUser(),this.initBottomButton()},e.prototype.initEvent=function(){var t=this;SocketX.getInstance().addEventListener(NetEvent.TEAM_END_PK,function(e){DataManager.getInstance().updateTeamKonwResult(e.data),t.update()},this)},e.prototype.onBack=function(){SocketX.getInstance().removeEventListener(NetEvent.TEAM_END_PK),DataManager.getInstance().clearRoomData(),ViewManager.getInstance().backByName("pklist")},e.prototype.initBottomButton=function(){var t=this,e=new XButton("保存图片");e.width=325,e.x=30,e.y=this.stage.stageHeight-150,this.addChild(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new AlertPanel("提示:请自行截图保存图片");t.addChild(e)},this);var i=new XButton("分享",ButtonType.YELLOW);i.width=325,i.anchorOffsetX=325,i.x=720,i.y=this.stage.stageHeight-150,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new SharePanel;t.addChild(e)},this),this.addChild(i),Util.registerShare(this.shareGroup,ShareType.PK_BATTLE)},e.prototype.initUser=function(){var t=new eui.Group;t.y=200,this.shareGroup.addChildAt(t,100);var e=DataManager.getInstance().getRoomData(),i=e.pkResult,n=e.users,a=5;e.roomNumber==RoomNumber.SIX&&(a=3);for(var r in n){var s=n[r];if(!(s.position>e.roomNumber||s.position<1)){var o=190*(s.position-1),h=UserPositionType.LEFT;s.position>a&&(o=190*(s.position-a-1),h=UserPositionType.RIGHT);var l=new TeamUser(s.userInfo,h);this.userViews[s.position]=l;var d=i.result[s.position];d&&d!==WinnerStatus.PKING&&l.setWinnerStatus(d),l.y=o,t.addChild(l),h==UserPositionType.RIGHT&&(l.anchorOffsetX=243,l.x=this.stage.stageWidth)}}for(var c=0;a>c;c++){var g=Util.createBitmapByName("pk_vs_png");g.width=246,g.height=166,g.anchorOffsetX=123,g.anchorOffsetY=83,g.x=this.stage.stageWidth/2,g.y=190*c+93,t.addChild(g);var u=new egret.TextField;u.text="VS",u.size=40,u.width=100,u.textAlign=egret.HorizontalAlign.CENTER,u.height=u.textHeight,u.anchorOffsetX=50,u.anchorOffsetY=u.height/2,u.x=this.stage.stageWidth/2,u.y=190*c+93,t.addChild(u)}},e.prototype.update=function(){var t=DataManager.getInstance().getRoomData().pkResult;t.end&&(this.pkingText.visible=!1,this.winView||this.initWinView()),this.scoresText[TeamType.GREEN].text="总分:"+t.score[TeamType.GREEN],this.scoresText[TeamType.BLUE].text="总分:"+t.score[TeamType.BLUE];for(var e in t.result){var i=t.result[e];i&&i!==WinnerStatus.PKING&&this.userViews[e].setWinnerStatus(i)}},e.prototype.initTop=function(){var t=70,e=30,i=DataManager.getInstance().getRoomData(),n=i.pkResult,a=new egret.TextField;a.text="绿队",a.size=40,a.textColor=Config.COLOR_YELLOW,a.x=e,a.y=t,this.shareGroup.addChild(a);var r=new egret.TextField;r.text="总分:"+n.score[TeamType.GREEN],r.textColor=Config.COLOR_YELLOW,r.x=e,r.y=t+70,this.shareGroup.addChild(r),this.scoresText[TeamType.GREEN]=r;var s=new egret.TextField;s.textColor=Config.COLOR_BLUE,s.size=40,s.text="蓝队",s.x=this.stage.stageWidth-e,s.width=100,s.anchorOffsetX=100,s.textAlign=egret.HorizontalAlign.RIGHT,s.y=t,this.shareGroup.addChild(s);var o=new egret.TextField;o.text="总分:"+n.score[TeamType.BLUE],o.textColor=Config.COLOR_BLUE,o.textAlign=egret.HorizontalAlign.RIGHT,o.x=this.stage.stageWidth-e,o.width=150,o.anchorOffsetX=150,o.y=t+70,this.shareGroup.addChild(o),this.scoresText[TeamType.BLUE]=o;var h=new eui.Group;if(this.shareGroup.addChild(h),n.end)this.initWinView();else{var l=new egret.TextField;if(l.text="比赛进行中，请稍后",l.width=300,l.y=t,l.x=this.stage.stageWidth/2-150,l.textAlign=egret.HorizontalAlign.CENTER,l.height=55,l.verticalAlign=egret.VerticalAlign.MIDDLE,l.size=32,h.addChild(l),this.pkingText=l,i.joinType===JoinType.OBSEVER){var d=new egret.TextField;d.size=25,d.text="旁观模式",d.x=this.stage.stageWidth/2,d.width=200,d.anchorOffsetX=100,d.textAlign=egret.HorizontalAlign.CENTER,d.y=30,this.addChild(d)}}},e.prototype.initWinView=function(){var t=DataManager.getInstance().getRoomData(),e=t.pkResult,i=70,n=new eui.Group;this.shareGroup.addChild(n);var a={1:"green_win_bg_png",2:"blue_win_bg_png",0:"green_win_bg_png"},r={1:"绿队获胜",2:"蓝队获胜",0:"平局"},s=Util.createBitmapByName(a[e.winner]);s.width=365,s.height=65,s.y=i,s.x=(this.stage.stageWidth-s.width)/2,n.addChild(s);var o=new egret.TextField;if(o.text=r[e.winner],o.height=55,o.width=140,o.textAlign=egret.HorizontalAlign.CENTER,o.anchorOffsetX=70,o.x=this.stage.stageWidth/2,o.y=i+5,o.verticalAlign=egret.VerticalAlign.MIDDLE,o.size=32,n.addChild(o),0==e.winner){var h=Util.grayFliter();s.filters=[h]}this.winView=n},e}(Scene);__reflect(TeamKnowResultScene.prototype,"TeamKnowResultScene");var Base64=function(){function t(){this._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}return t.prototype.encode=function(t){var e,i,n,a,r,s,o,h="",l=0;for(t=this._utf8_encode(t);l<t.length;)e=t.charCodeAt(l++),i=t.charCodeAt(l++),n=t.charCodeAt(l++),a=e>>2,r=(3&e)<<4|i>>4,s=(15&i)<<2|n>>6,o=63&n,isNaN(i)?s=o=64:isNaN(n)&&(o=64),h=h+this._keyStr.charAt(a)+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(o);return h},t.prototype.decode=function(t){var e,i,n,a,r,s,o,h="",l=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)a=this._keyStr.indexOf(t.charAt(l++)),r=this._keyStr.indexOf(t.charAt(l++)),s=this._keyStr.indexOf(t.charAt(l++)),o=this._keyStr.indexOf(t.charAt(l++)),e=a<<2|r>>4,i=(15&r)<<4|s>>2,n=(3&s)<<6|o,h+=String.fromCharCode(e),64!=s&&(h+=String.fromCharCode(i)),64!=o&&(h+=String.fromCharCode(n));return h=this._utf8_decode(h)},t.prototype._utf8_encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);128>n?e+=String.fromCharCode(n):n>127&&2048>n?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},t.prototype._utf8_decode=function(t){for(var e="",i=0,n=0,a=0,r=0;i<t.length;)n=t.charCodeAt(i),128>n?(e+=String.fromCharCode(n),i++):n>191&&224>n?(a=t.charCodeAt(i+1),e+=String.fromCharCode((31&n)<<6|63&a),i+=2):(a=t.charCodeAt(i+1),r=t.charCodeAt(i+2),e+=String.fromCharCode((15&n)<<12|(63&a)<<6|63&r),i+=3);return e},t}();__reflect(Base64.prototype,"Base64");var Util=function(){function t(){}return t.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];console.log(t)},t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t.setUserImg=function(e,i){if(e){var n=t.avatarTextures[e];if(n)return void(i.texture=n);var a=new egret.ImageLoader;a.crossOrigin="anonymous",a.load(e),a.once(egret.Event.COMPLETE,function(n){if(n.currentTarget.data){egret.log("加载头像成功: ",n.currentTarget.data);var a=new egret.Texture;a._setBitmapData(n.currentTarget.data),t.avatarTextures[e]=a,i.texture=a}},this)}},t.getConfig=function(t){var e=RES.getRes("config_json");return e[t]},t.inArray=function(t,e){for(var i in e)if(e[i]==t)return!0;return!1},t.formatDate=function(t){var e=new Date(t),i=e.getFullYear(),n=e.getMonth()+1,a=e.getDate(),r=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),h=i+"-"+n+"-"+a+" "+r+":"+s+":"+o;return h},t.converTimer=function(t){var e=Math.floor(t/60),i=t%60,n="";return n+=10>e?"0"+e:e,n+=":",n+=10>i?"0"+i:i},t.getTrain=function(t){var e=RES.getRes("tiku_json"),i=e[t];if(i){var n=new Subject;return n.id=i.id,n.title=i.title,n.content=i.content,n.options=i.options,n.result=i.result,n.qattrid=i.qattrid,n.type=i.type,n}return showAlertButton("该题已被管理员删除,请联系后台管理员！","返回游戏首页",function(){SocketX.getInstance().close(),ViewManager.getInstance().jumpHome()}),null},t.getURLVar=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?decodeURI(i[2]):null},t.setCache=function(t,e){},t.getCache=function(t){},t.getLightFliter=function(t){void 0===t&&(t=255);var e=.5,i=35,n=35,a=2,r=3,s=!1,o=!1,h=new egret.GlowFilter(t,e,i,n,a,r,s,o);return h},t.grayFliter=function(){var t=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],e=new egret.ColorMatrixFilter(t);return e},t.setImageColor=function(t,e){var i=function(t){var e={r:-1,g:-1,b:-1};return e.b=t%256,e.g=Math.floor(t/256)%256,e.r=Math.floor(t/256/256),e},n=i(e),a=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];a[0]=n.r/255,a[6]=n.g/255,a[12]=n.b/255;var r=new egret.ColorMatrixFilter(a);t.filters=[r]},t.setTitle=function(t){document.title=t},t.getWaterShader=function(){var t=["precision lowp float;\nvarying vec2 vTextureCoord;","varying vec4 vColor;\n","uniform sampler2D uSampler;","uniform vec2 center;","uniform vec3 params;","uniform float time;","void main()","{","vec2 uv = vTextureCoord.xy;","vec2 texCoord = uv;","float dist = distance(uv, center);","if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )","{","float diff = (dist - time);","float powDiff = 1.0 - pow(abs(diff*params.x), params.y);","float diffTime = diff  * powDiff;","vec2 diffUV = normalize(uv - center);","texCoord = uv + (diffUV * diffTime);","}","gl_FragColor = texture2D(uSampler, texCoord);","}"].join("\n"),e="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nconst vec2 center = vec2(-1.0, 1.0);\nvoid main(void) {\n   gl_Position = vec4( (aVertexPosition / projectionVector) + center , 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.x, aColor.x, aColor.x, aColor.x);\n}",i=new egret.CustomFilter(e,t,{center:{x:.5,y:.5},params:{x:10,y:.8,z:.1},time:0});return i},t.playMusic=function(t,e){void 0===e&&(e=!1);var i=RES.getRes(t);i&&(e?(this.bgSoundPlaying=!0,this.bgSoundChannel=i.play()):i.play(0,1))},t.onStopMusic=function(){this.bgSoundPlaying=!1,this.bgSoundChannel.stop(),this.isShowIframe=!0},t.onHideIframe=function(){this.isShowIframe=!1,this.bgSoundPlaying||this.playMusic("bg_mp3",!0)},t.changeLandscape=function(){this.isShowIframe||showAlert("请竖屏模式查看！")},t.randomString=function(t){t=t||32;for(var e="abcdefhijklmnoprstuvwxyz0123456789",i=e.length,n="",a=0;t>a;a++)n+=e.charAt(Math.floor(Math.random()*i));return n},t.getHost=function(){var t="https:"==document.location.protocol?!0:!1,e=window.location.host;return e=t?"https://"+e:"http://"+e},t.urlEncode=function(t,e){if(null==t)return"";var i="",n=typeof t;if("string"==n||"number"==n||"boolean"==n)i+="&"+e+"="+t;else for(var a in t){var r=null==e?a:e+(t instanceof Array?"["+a+"]":"."+a);i+=this.urlEncode(t[a],r)}return i},t.formatString=function(t,e){if(!e)return t;var i=typeof e;switch(console.log("formatString type is ",i),i){case"object":for(var n in e)t=t.replace(new RegExp("\\{"+n+"\\}","g"),e[n])}return t},t.registerShare=function(e,i,n,a,r){void 0===n&&(n=""),void 0===a&&(a=""),void 0===r&&(r=null);var s=t.getConfig("share")[i];if(s){var o=s.title,h=s.desc;console.log("注册分享：",i,n,a);var l=t.randomString(32),d=t.getHost(),c=d+"/static/default/default_avatar.jpg",g=d;switch(i){case ShareType.PK_INVITE_FRIEND:h=this.formatString(h,[n]),g=d+"/game/rooms/personalsports/joinpk?pkcode="+l;break;case ShareType.NORMAL:break;default:g=d+"/game/index/share?code="+l,h=this.formatString(h,[n,a])}var u=function(){r&&"function"==typeof r&&r(l),console.log("分享回调");try{if(i==ShareType.NORMAL||i==ShareType.PK_INVITE_FRIEND)return;console.log("进入截图模式！");var t=new egret.RenderTexture;t.drawToTexture(e);var n=t.toDataURL("image/png");n=encodeURIComponent(n),console.log("保存数据对象",n.length),Http.getInstance().post(Url.HTTP_SHARE_UPLOAD,{code:l,type:i,imgdata:n},function(){})}catch(a){console.log("错误提示",a)}};console.log("注册分享1：",o,h,g,c),onMenuShareAppMessage(o,h,g,c,u),onMenuShareTimeline(o,g,c,u)}},t.saveImg=function(e){var i=new egret.RenderTexture,n=ViewManager.getInstance().stage.stageWidth,a=ViewManager.getInstance().stage.stageHeight,r=new eui.Group;r.width=750,r.anchorOffsetX=375,r.x=n/2,r.y=a-200,e.addChild(r);var s=t.createBitmapByName("share_mask_png");s.height=90,s.anchorOffsetY=45,s.y=100,s.width=n,r.addChild(s);var o=new egret.TextField;o.text="长按识别二维码加入答题游戏",o.height=90,o.verticalAlign=egret.VerticalAlign.MIDDLE,o.x=300,o.y=100,o.anchorOffsetY=45,r.addChild(o);var h=t.createBitmapByName("share_qrcode_bg_png");h.width=204,h.height=186,h.anchorOffsetX=102,h.anchorOffsetY=93,h.x=110,h.y=100,r.addChild(h);var l=t.createBitmapByName("share_qrcode_png");l.width=150,l.height=150,l.anchorOffsetX=75,l.anchorOffsetY=75,l.x=110,l.y=100,r.addChild(l),i.drawToTexture(e,new egret.Rectangle(0,0,n,a));var d=i.toDataURL("image/png");e.removeChild(r);var c=new eui.Group;c.width=750,c.anchorOffsetX=375,c.x=n/2,c.y=a-200,e.addChild(c),c.addChild(s),o.text="长按保存图片",c.addChild(o),i.drawToTexture(e,new egret.Rectangle(0,0,n,a));var g=i.toDataURL("image/png");e.removeChild(c),showIFrame("<div style='position:relative;'><img  style='width:100%;width:100%;position:absolute;top:0;left:0;' src='"+g+"'></img><img  style='width:100%;position:absolute;top:0;left:0;opacity:0.01' src='"+d+"'></img></div>","返回")},t.avatarTextures={},t.bgSoundPlaying=!1,t.isShowIframe=!1,t}();__reflect(Util.prototype,"Util");